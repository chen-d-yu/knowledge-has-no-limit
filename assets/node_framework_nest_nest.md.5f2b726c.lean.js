import{_ as n}from"./chunks/reqFlow.fe01f0bc.js";import{_ as a,a as l}from"./chunks/image-20230806215510355.6f01896e.js";import{_ as p,a as o,b as e,c as r,d as c,e as t}from"./chunks/20230731001012.a14ea1b6.js";import{_ as y}from"./chunks/20230731214456.c770d4e0.js";import{_ as D,o as F,c as i,L as B}from"./chunks/framework.a932675b.js";const A="/knowledge-has-no-limit/assets/20230730115254.9117facf.png",b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHoAAADGCAYAAAAdUZTqAAANMklEQVR4nO2dfbBXRRnHn583EbjApcwrKoMwGgkVlEhWjo0pQ0oqNKE5A+NYgUPTZC9YaC+jxqvgxGSMTBHQ4JWpmcpR+ANRRCTKQF4upJJgwwQlNJaQF3QY4OkPOLB3eXb32d3fuffs3eczc+d3ztm35+yzu7/zO/ud50JrayuezQlc8/QQbFxwL7a8sR3/9tZruG7jJBz0wBj8+cGTOQ5suxM/OGMM/uCVLdi6bzVOX3oFNv1qEe45VcPuP92CvWeNw4de3Yw73tyAi39/DTbOm4YvHuOl7/rjGGyccxvO2bkV/7r/JVy+chQ2PTwV1x7j2Oe2384hfHJCM3YbMhEXrnoZd7Sux+Xf/TT2brwef7kXEXET3juwhgO+OB9Xb9mBW59fht8c+2HsB8Nx9i6lmr/PxSthBH722p54+X0vt2vh9Uc+hec2j8KZT2/EHdvXY8s3rsQeF07GNUdPpm/90RCsXTAKZ67YhK2bnsIff2kwng9X4/y9HPvP8NZvxuP7e16PQDsaEQ9vwFnLR+HAmf3xvAcuxYt+egveveVVfO90hn/jCy98DT8570PYd8ZwHPHELHzm4LEz5Y//E1et+QqOnDcY+04fikMXT8Vf72/zSl+xegIOnzMQe08fih9ZMhWXvnmYb5/TfgcHN+MvptyAV1zUB7v3PB8HXX0Hzn7+X6eTD/3lUfzyiP7Yp3sjXvixcfjIH2biNbqjcQ/OuQoQYBDev1mr/9g/8Kn7voBDm3vieY0X4ODrJuPibcr9t23DxyZehZf06YFNl4/GGUum4XBfRx9Zh18f0IAf/8l2rLW2tuKwYcNA6Nqc09kGCB2DODoTxNGZII7OBHF0JoijM0EcnQni6EwQR2eCODoT3mdLrNVq7IoQkSxPXXelufJ1VFkdRDRerzpWRwPwbsJnQHDgOqNsVBvUezRdrzLOpbtWqzn/uHDzUjNHb49rA5Uecw8+HNq8AMYN7Aa1Wne4a2UpTbBxOhoRWX8mQjtRr1Nvy9V+sSros89Uh8l210ChOQ67WibCyGsfgv/ePhk+14171+XBfhjzmdH6Mqeem2alqc1YCuf6fh2YBrPpuD3vwIvPHoCJK7bD2rk3wcUVWN2d39EF1MwIKVscux7Uirz6IKGObQ9c+mcMer3me2iCu5ashoaGCnj4FGxHU8tXQegTsAnfJ3hTeb0M9x5c3/nUeXvbatDQwDK1w2A7GoDuQO7PjdAZxZtB/vXZ7sH1k6wqvwp88HK0aekMKa+eUx3LraOgjI432ad+paTi8A75jvatwzSjOmpmcZyorwZVd7jR0a7l2bXc1QvqCd53GQ95eKR+DfDfjJ2Ag3tfh/2HAQD2wf8QoWHfTti5E+DcD1wKlzX3YNtSN0xy35P2n32snuuftjp80kzt+JQt8pnuQ62bqs91z3Zb3saFN8DputW/S761nmV7vSFntGkGxH5Hc7F9d+Op367cJVNNp/K6yofRF6Y8hzClhJpDIR1tunmq47kO57xYsbWvD77i2ObwWCeW+SKno2E9jHEdb0uP6XRb2dB6fWyvR3udjexHZ4I4OhPE0Zkgjs4EcXQmiKMzQRydCeLoTBC5r6WsjvrqVb9edUTua0G1IUSNUiVE7ut5D2yOvAYt94yGIRf3gca+/WHYzd+DJ3cfrX87TETua7HfNBDcA+Q9WPv9MfDVZ5rhO8vWwZ+ffQxuO/o43D52OrR21kJlDD+FZ+/fmv5M5ahPbh1qfptdLtv1T586OPXTbMT7P9qMd/7uyJlLu2bjcPgEPvxGVLPBiNzXA77cdyTM2nGg/aW2Nmg7pwmaekWbEYTIfYk24+W+ukF7YfEPF8LhCUvhjma3/WUgcl8oW+77H1h9z03w7T0TYcUTt0JTuOlRiNzXQrzc9xCsmzYaxq8cBkvXz4fr+tbdRDYi9yWoj9y3DV568Ea4tWUALFi/DMb379yXkCL3JSjqD5f7HodXfnYz3Dj3Xbj7tzPhMyf2wO7dJ1N69bsM+vXqhJcsIvctQ+77Di76PP0zcuzj77Jsrzci9y1lJeoFk1YhTCqh5lBE7mtB5L6O61R6TKfbyobW62N7PdrrbGQ/OhPE0Zkgjs4EcXQmiKMzQRydCeLoTBBHZ4JX5MB6ESsorNfbOFdZSkDYIcLCEmA7Wn2/zCGmA6rSecV7df1tmOl6lSEdbZP1ciW/vgPDVTY5uS8kEN1XHbHFqNWvUXmoegpsjnKV1ds32ajSuXLfhKP7+mCa4T6dbKonxJZihfBZak2D2XTcnoSj+/oQ0rEq6tajaQ/cpkLVZblUnlC71PrM99iFovsWlLGdx9mP5pTvPLlvwtF9XYoTCnXZdJV1DZjYVUKvz6aJs60Q1HkKlLJ06/h2UteR+1YHp6NDR2/MqDfNqLTkvtWiQ2Z0QYij0pT7JhTdF09ab0yzpVPXffLqaXoel11qPjUvdaznMbXhZ0si0X0B6rssqi9JOG2lL/dNJLqvy8muTtavuzqT8wQuct84vHTd3HRfYtoLtSW0zXJWgPKR/ehMEEdngjg6E8TRmSCOzgRxdCaIozNBHJ0JIve1lBW5LwOR+1YLkfuWNStTiO6rjthi1OrXqDxUPQV5yX0Ti+5bAMz9X25+bn3A3Cu2taF/+trgqp8m4ei+PmCkkC99uW8Xiu5bYOrAmI6lyqYl99UNSii6r6nzbYjcFyDJ6L6h+HZS15H7JhTdV+S+dhvNeROJ7lsG+ch9E4ruixj+M4m67pNXT9PzuOxS86l5qWM9j6kNP1sSie4LIHLfOBKJ7ityX9ou1/UqI3Jfz/RyVoDykf3oTBBHZ4I4OhPE0Zkgjs4EcXQmiKMzQRydCSxHl6Ho7CjJbkzZrOS+ptehIXvGMQ7qDIr36tQrXep6lbE62jWKbSIASnLD7RhT+aTkvpBAdN8CfeSq55xND9Onms/U0a5Z5LKlc+W+iUT35X4/qddUbMtdUUbvcJMdsYQIFVR7TQNMP25PItF9qVmgw9nKVDvYVxFS2KE623Rs2rdW0+rxfarXa76nxKL7Ujeib/5zB4EuFrA5PmRgUeVNggbq3JbPVEY9b29bItF9KeOpayalh6mjQ2YVbwb516fW5RI+UAMmpSduAMfSbRvxtiWRu8SaCPnpVkbHm9QrPlKmqmBdukOXUM6s8WnX9D1f1sziOJEjZaoSLLkvZ2bbylBwl2K97dCHO98nbtOvCc5PwaSi+4IiUTWlcbDlddVRpOv5Qtumjm33GG5LQtF9kVg+TWkmbE/ZtplpWg71J36OLWo6lZd7L34kFN1Xx6dDbE/ounMpZ1NtmfLYHB7rRNPXT1mvTMskSO7rwlReda5Pe7b0UFtD2yxnBSgf2Y/OBHF0JoijM0EcnQni6EwQR2eCODoTxNGZIHJfS1mOnCqVt2Qi97VQvFen3uRR16uMyH3LmpUpRPct0Eeuem5zmj4QTAPD1tGuWeSyRd3pMl1z3YvJPvcASSS6LxD7qK4/ClO6em4qq5anrrso8uifPnVw6qdJJLovMlQkrqVY35L0VYQUdpj0Z7b9cUrTxm3bZZdan/meEovuaxIFIIrcVz+32lbV6L6U8TYxAXW9KENd94E3g/zrswkXbSsEdW6nwtF9qQ4w3ahp9lHHvku3T1o9lmZTW67VyUwi0X1Dl1DOrPFp1/Q9X48ZTsFxon5fZ+dNMLovZ2bbylBwl2K97dCHO58BUdRPLemcn4JJRfcFy08n03VbPaY0V1kqX2jb1LHtHsNtSSi6LxLLpynNhO0p2zYzTcuh/sTPsUVNp/Jy78WPhKL76vh0iO0JXXcu5WyqLVMem8NjnRj7zr5KiNzXM72cFaB8ZD86E8TRmSCOzgRxdCaIozNBHJ0J4uhMEEdngte/LAzZLbKJF8ouq6O+OtWvd3VYKlDf9Kq8Iizei1Nv4qjrXRmnCtTmTNtrwuTlulCt6LyxOIO+quem464n161edN5YSEdTTqA+OR0dS4jQgLJPt1s/bk/1ovPGEvSPwl0dn75ct3rReWPxlvsW2DqKs59sQ91r1pduvU6qzXi5bvWi88bClvuazl0O5M0gPtQgKFeu2zXwEh6YlnEqn4m05LpdB7aUyJVmkwKlKdftWrBndOjTb5py3QpG543FJPdVgQi5bWx5NS91rOdx2cyzpXrReWNxPnUD+H/HpS/XrV503li8nrpVijSTtJeqk8ojct2OIVruy8nLGTC++KwE9WgvdWQ/OhPE0Zkgjs4EcXQmiKMzQRydCeLoTBBHZ4LIfSGPlygi980EkfuaqFh03lhE7ktSwei8sfjsR+ufnHJUXk55V5tcG1z101QvOm8sIvcl661edN5YRO7LEUBUIDpvLCL3dVKN6LyxiNzX2m51ovPGInJfY95qReeNReS+QN1vBaPzxiJyX8qW6kXnjUXkviTVi84bi8h9M0HkvpmQ9qOkwEYcnQni6EwQR2eCODoTxNGZII7OBHF0JiTq6P3w3KMPwqINb3e2IQaqZ9//AZDlSH48zuZ2AAAAAElFTkSuQmCC",E="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOIAAAAdCAYAAAC31LAbAAAInUlEQVR4nO2bXUyb1xnHf00wWW02uwpOKQxhETtpX03AFIMG02QlJVPCJJAatgFSzCJCVDqFTAM0uIALM81UkIsGdUiJvAkyFaaRSVgaZAtZhaaCFpwFIs1VwctgGQ6Lg2Rnw2kg+7gwTmxjG0zsQLvzu3vPx3Oe9/j9n4/nHL+Ulpb2XwQ7nEKaLedQjVXQ3LfdvggSwUtCiALB9rNrux0QCARCiALBjkAIUSDYASTFWkF7vJm68jwyFMtMvVdDx0Qi3BIIPi/4Am15ihXcsyO83doftlSMM2IxVeV5qOY/oMtkFiKMxoESDl86GZCQQ9qxbfMmLsj1pdTX11Oql2+3K58hJugzmzD12kFXRocxfKkYZ8R05Apwzlqx2Z/fxc8aKbVnOXLwL1gbh4PStV2tSMpnz/eutDN5J7huWksZBdm5WK9eDmM5h/xLZby2oQdzWGvD1Y/uX7xQqTWo09OR69Kx2hyRCxY2YzmnYzbOK6Zo77cr7whfO/V1UuVu7J3dOGYCMvfuJ/tMCW9kq9gN/Nvj4Nb7/Tj/6stOa2mlIDvEoOfmuna22r9Ohx2nQ8lceR6qCGViXpoCyGRbqfX5xdHYjv+z1Ha18kpogWMnKciOJqLbTNbeTpyDccI5coHWke32Yj173jrJkeOp3L/yR+6dOLguP6uxiq/Ipvmos49/PUph3/eq0De9hfWdXwNw/+IFfuuf5JNSyTz1HbJXF+PspYrkKLqJUYizuJeJqOrw+NbIutlrTGcYKFInw/ICU4M9dIysfb7a4zTXlZOXofA9uxcYGzTRM+pZG10zcM0p0Wi8TPWOo6osQcMC1843YJkG5Hpq2k5j0KhIBlheYLLfxPlRT4AfudR3t1CkdjP53tuc3+pIvfppTMXTDpTwxgkV9s7uLTYYIzH6tymMHQyUaJ4+zg2HXCyQG6hvN1KUoQDcTA3P4V1nJHH9v8vzCTdaL7O0mEN+qBBfziFV/gD7z60szQB4uPvLP6Nt2o/2ADhm4D9LHh4vAUkZaNur0D38DSPmP226/c2hRp4cOTcmIcolCbVsBa87djdkUh6qwQuYHAoMNTUYKqupHGul3ws1ddVIjNPbNcq8V462/DRVxkYWxlux+lrGO95Br7eByrJ0Bjt68TZUk1+sxzJto7ixjqMqJ8M9F7C5/PVbMNqb6XMGdITcZ0uljt1/gNVHT+Dhg3Xpz5ambuyd7UzOAAf8uX/n485hFmfWVYs7kfx7boZ6MNkUgJbyhipCd4ilLTUUqV2M9ZxnzKXGUFmJbp2RxPX/o+s3eBSp0qPb3DwXstpQJiHjCauBlZIy0LYb0SxdYaQr/L7r+frXiXcZ1CoJWG9/E0L0R318T+7JHhqsW/DDMYzJagPA3q8nt1EiKxeYAEtDBZaAovZrxZRJOqRc1oToYs5qZ0TlolruxGofQeWqJksmAwrRZylYGDfTN+Ybh+0miaKBYnR6/AaAUTpqRtFmKXHMb8F/4PEvegj/6sH7ksA9R0GTBih7VjTM3gPwBXeaDvHFiK1H3x9G9+858cxj9wAoWYEQIRYipSfjslnoGfN9YPbRQiy6UCkmsv9jY6/hIF94cJP5uwGJ2blkpiYhTz3BcXMu0xef7SHj0/4oXX0S79a0MTAAEHzqsAkhTtBn9mBNBrJKqa820lw4FvMmfHUlYBq1uQicVOWGetqNRfhXpj6WY7KfcfRnDBwNTpsLs4Z2zHvWJz43KqSmViTAPytaKeFw014+rv0dKV3fxNEYXUTMDPNhbWKCLC+CZXfAKL8SuVxi+n/zvPzdUxQc/BR75++DM2aG+YPpI3bj30N+G+s7v4pjy7mcLi9C7ujFNDgPrGAP6LJNLU2dDjtOAPta5EcHxC0aVkpLTREqxwd0DTp8ewttOQ1VWTFZWRgzYRkLTlteiJeP0QkO1pwNylvkH6Qtacg/BpNXX4w/gvB8qbaObxTAJ+//NDiqusaTux6e4OGu+TppPd/i0Jtw83q8Ws8lXQ2uyZEgAfqJMVijQ6XYuFRMFEqkJy8zey3gSEQdZUiNgEIuw26f3rCcb2mUqFE5h1eU7pA9IizemqOguASubu+MV1jTTpluldlBExZbfG0rAvc+UYISie3/yGS2NpGTusjtn1zmbtCSM4usxiIY7Wd+KpEeuFldgUiB0+2/4jZhx7miQHe0FL0kIRmMtJeu3+pHMYBtfhlVrpE6g4Qk6Slt7qZv4Dw16YHlimm2DPDjd7tpL43zO2zE1cvcWDrE4dpXX3DDgegpytehUcN8jCJUZklIkoQkqUkGZIq15ywlMIHduYJaX7PW/wbqjuvCfHCJ6/9de5XsyVSyJzOF3SSxJ9X37Cfb3EqOco5bF63cf+Iv68+f57FMQ+6pStLzlOzJzCCz5U1eW3Xwt8l4eulieTVybowzok/VqgiRn61hpbc/j3OVVTS2AcsLjPeNI6sr2rSF0a4estpOY6hrw4DPxlRvDxZnYCkXXi+g8OJ2xcn1UA58mRTPUkCChtJLrXBnCKt5iMxLZyhNHcJqDojibRikCSXMgfVmSM9HowL35BCjMVYtq2sj4PQCDG20GYC5YSqa+7CaLWjajWv972Z2yIZTow+xkrj+33emPuhAft+pevYD/7xxkQ8vvcreVNjN6+h/8HpQvXtX2pm8CotmM7bGs3z1+/XsBlYfOLB19uN6GD8ffScOEEmLMf8fsbC+m7oiNcmIu6aBPD3CuOMTWkrtWY4UqJ7+2D58N2gISntBGDsYKJFx7YcNIQOUILE8O3VYcY1j+dEFxtYfsm79j8FaSYvDHuWak2BHcbytj0rZCMYIl44FiSNdKyH3zuFwhlHgGuIf+gLBDmD7gzUCgWDjYM2A7xpARCoqKuLmjEDw/4qYEQWCHYAQokCwAxBCFAh2AEKIAsEOQAhRINgBCCEKBDsAIUSBYAfwP/q+JJ9I2SSUAAAAAElFTkSuQmCC",d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANMAAAAuCAYAAACyCyweAAANvElEQVR4nO2df2wb133AP7UjuyC1iV1Cz6PhmdjEGrsVMYM6Wc/ZwNaTkYbALCAzPDporxvIFFG76DY4wc5/SBiUP3xD3Q6UkWpIcg3KFs4hbTpIA+QB0Vrwj+XWWIXpriXgUstOcMx2pbPSWSk3kr3tjyMl/jiSxx+yI/s+gAGZ79573/fufb/v+77v3t2Hdu/e/X844kEefinCL750lqWf1KYMn5lg7+UX+d5L/2V77a9/4a/55MeKXHzxO/z83UHu/8xxDu59h7kvfAuAj8jP8Uf7r62n7/qzJ/jYfsjZ5v8wg58+yiOP3OTSyVfI747yqefu53tPfQM+/VmOPnSJudM/ZPepCX7vmiVTu/rbyV9NdblO2Tc1gTDwA9565V/55Q3YGXmCRyMfJjs1w/KVun58+xxv/tM14CbvXykB+wl/9Tgfufwa//adn/G/9+9j/5/8Mbt++yZmWb7Bp57h8P7/YO7Z+ZZy2JcP2+4fYsADsJth+Ti/dmGai28CK7/k/Xdvte+f3z/Moc8/ygMegF9xdeESAyP7uWbTf91wR8fXe+3lq/Tffb03tT3vffXvWXx2jANfHGcAuHXd5OIL31pP/8UL57h06jgPfnGc7WtFTP0HXNv/8eb5V97h8iuvWQ3d3Xv9m81y8nUG5cf4xHMfZztwa+0aV19/rUaRAMy5H7M39iSPPQRQJPulsyz95DI/+uYlPvGZ4xyZtNr+oxfT7PyrRzuWw7582PX5cR75naoLR8Z5bAR4e5a50z9sX/CPv8ub8ne5b6+Xm1dK8NEonxrpWLyu2dTx5YBK/32os5lplN8q/++nrz/PhX92lvNuYPjMBMKQ9ff/vNXZzHQvsG33EAMDAIPs+vMneeiBy8zJc3darNtKB8oE9+0dYnv57/evXN8kkT6YbAyWe6/tTqg2NreuL3HxhVfJ/+edlel205Eyubi4NGfbnRbAxeVuwVUmF5c+4SqTi0uf2MLKJCJJ4p0WwsVlHWfKJCpouo5e+acpiEio1b/pOrquobQZ36KioesqUo+Ci0qCaHS053JAQnUgt31WFV2V1vtH66IQSdVRe2+Eo3o25BNRtHKbRQVNUxCti6z2bI4EKFX9UyvP3YHzTdtShmRcxRAVtARAjmKpROblOKoB1qAUyBstyhAVEmEv4CWq60Trks35GEqqSV5JRY8G636sK6ciY0NWnfqspUySuNpK2A4wVOKGhKonUESD2mIlJClFqrpdkoSUStGsqZtBajZDRB5Fwrit9a4jCYTDUTSF9X4vtBwsVVlt7l/NvfYcJD6ZIBL0sQOgeJX0qxPMpFesa3tNd8hteQLCQkKVwxRME28Q5mNK+aZKqHoUfybZXJEqmPPEml0kqegR+6SUEutxAFky1t9PiyC6XmUWEgqiUavQQlRHr7EcJvO3e0QbKvGubYeIosmEvW0ua2LMAEgpxHIKmiyjSlD0O699dmaKxUrdA/s4mjiBsFqgsts38uwYRwJF0jPTpAt+REniSPwUVy9MMLfSe7pTnCuTN4ys68gApUxNkqhoyGEvmPModnnLs0plNhAVDVlXIZZFKCtS32YJp9TPdLKObjWOTDJOozhmlQEoU56lX242gABIocRSWAoZoZiMoxoiiqajVwZIsErZWg3Irmg0BOZ8DCWOJQMZki9DQteRWxkrHHgOTYzZOusKLaJEShRzzlpwfTlrKY4nwsmvfA6h+AbqlEYWq6yD+7wUjAlm0nkAslPDCF+L8PAIzM31mu5MRujJzdvAUOOtb35KIVZ1Eww1DoqGrEcx52PEnVrpYLR2FrCRsQFb99C6NhmLYdQMcgeualMkVC3ArCNFMFDjBhWL70uXB6mTAdkxKZRkDtEwrHsn+8jmFDQ9jKXLYWS5fGkwiq5HmhiTHmh2D9YNWBXNFNoT4eRXxhAKs0gTrzYkl0p5hPGzTAomZ54usMYOBnz9S3dCj26el3Bdh7Rai9T4vuY8sRhWEGNdP2ysfzVtLKctFUUuD6S0bfkFBwoUrFmfWe3MU5AFQoAhCQS9QUYlMDoSsc5CF/J9nJUARJREAjAwQj68ZpaUkSJVqURS0YVs5/3aCXXG1DIaxYYZWFQ05GYD+ICI4AOvb5TUPxwg/fIU2mKtDzbk8cDAAANNiug1vR3OQ+NlN0+XKxYNoEQmY5YVI8a8abeo3Ij6RbGui8WSZPxRVCmFEott/FayBqxdQEkMdOBk2yBGQtZAaiwYf6lIe4/DZL4sazJTKv+Wo1jyExBFlEiwtRtkSwif14ki94JBvuAlFBERA35Kdb6VGPBjZm/vAk4SgpRyaVCUmmhsyOdtkG8dQ+X01BRTUzMYpQBHxk9x1HNbxHWMs5kp5MNbmRXq3bx0FlMWkJAQgibZhkWTtWawZqU6N61+YW7OE2vi81kdHUDV9SaBAGg+s4lEQpB5uX7tUm5bIWtZSDGAE5UN+bxQBGugykQSCbxkSHY6JusUuVeD0YxU1iQqhAjhpZA1yrN0lVEMd+Ad9IqoEAmWyCUNQqOyNdtXeRytInxLWWuVlJ0YZvhrRzh0DOaqBL2+sgJra6w1yd9rejscKZOdRdsgRdbUEVQImln7AAR1ETUbl0tUNBJN5weRgB8K2TyEQ/Y+fblMW6RRwoU0McOSdzYTQS77Yw1ts5ulbJSsctNTWZNoNIg572SttOEWm/MxskIYcsmafM37uQdSCjFEFM0kmwJELMM1G0AbzRPPCmVXD1Rd6H/964goiTBkktb9M2KkRAVNjqCIOewt2Qjj6ggsKEwvNC/Z6w2QnX6GGIAnzglWWSn2L90JjpQp5CtbtCakZjNocoiMI9O80aHVV29Ye7ssEUJek3QKhBbxB/u8Clo0SEMImwiKCL4w5JKt1UCMhPCWcmUlsxTbQkKtW1hLqgqKUmc4rFmglEkSq1gBUUGLlmrqbt4H5YhcD5E+SbVC22FdR8jYBGpuA5IqEyZDstoSrkf4JFTZLsK3QBGJ6AmV0loKo+AnEo+wZ9VkfgHAYHE5QVg8yVhWK4e2D7FndZlzfUl3jgNlkhCCJYqzzdLLymGahGQNhVaRoKpBUXNRZeZpErgYrShfCNUm6LGB2fhT0/0VK5LmzyRRKukhH96G0SwSCXkp5dIYlahUKUOyHBEjkySWH0WPaii5NL5gECRY1ybb+q09t3UL7aAPuqYsszkfI1ZxG0QFbbTS3rzjooIN+2V12EVTrQrL+1Qm87EmxkAM4KeAXfNTU9MMTCY4MjbJEWC1aPLG9BSpsugLZ2bYN5kgMjZJBKBo8sb06fU9ol7TndJemSSBYClH0tjYTyplLNckgpewLG9E2UQFzUahqqN4Nda5ZjOwRMbOw5FUokGT+ZgBhGi6D9TKzWsstFap62aP2ghTwhoEll9CLGXJLMvV+y4GyYCGLEdpuyFbt+dW0z+lZuuuFEoy0LAl4Yj6SFp9WvnPmFgOl5cyNLOb3e0zVfW1jSKt71FaFdiv1VYW0ZRFtCZVb3q6Q9zDgVuCuv0olw8krjK5uPSJLXwEw8Xlg4WrTC4ufcJVJheXPtHxs3nDjyuMHQuzx9vs6WqXWioRy1WKufM8bfOQpsvdwfbBwcG/dX75CH95Ksru5XNMz/wjr138744q8xw8ytixx/jNW//O5Xy3D21sNd7h7WyW71/5Df7g8Cf5Q8+3Wbh0p2Vy2Qw6dPMCeLyQz82xmF3quDKfP4g/EEAIBVpfKCpo3R4lb8HgU89w9Iz9ruO28GEOJSc4+tIzDH+08/ytyC9lyZ5PY5baX+uydenqCMZAl8+o589PM3G+u7ybyc4nPsvhxx/g569/n5/+6f5NqsXHjm6f7XfZEnSoTDmKJejwzFTD4bCGnXRPhPHnJQ7t8QJFMvMmjU9yHGD87CkO+YtcSD7Nl7tdq639quGnbdcv89bEN3j3Zw/ycDtlssnvDD+eHV1mddkSdKRMHkHAP9D507TMzjC16AWGOXbySeqPoRw9FeeQv0B65sukC34iJ04QaijEj8cD4MHX5UmFtRs34b1rDb/f+Je3uNFDfmfkWSmB3ydA+cC1y92FA2WqfZlG8cIMJzv9uMH1ZbLXAYZYhTplEhECOygsasyky+dVFkS0UL06LaDGFxjeN8TScof1l3n/mzP08l2G3vIvcCYl8HfxSXQdmr9rwmWr4kCZDFKnrzO3A9h3lPHPSShiuu+DoFSsstarza9bWt6qX6A4QOLYITxLX2fq28vAKll3grqrcOTm5Zey1oP62SHMY2F8IejziwruAQ5YRywunHeV6C6lw9B4CF+7d6d1iddXdcKzxUJ9eN/Q5giw6RRZazHjumx9bstLKIf2CezxAvjZAQx4BQQBKF0lu2yQzY8RPhhnLGKddIw8HrJ5Q8wIipYg7F0ld05ioo8fpdv4pusg27mPnQ8MsfNGvz9qVqC01kUk1GXL0KEyWdbV12FEanRssvb1tpFJJiOsHyqcO60RfF4qn3QskptdJB88WFdKgZUVwLtCsdCZ1O2o/6brrr8Y53fp7+c2rUgoXb+sw+WDT8fnmcTxs4wd8rPDjUY5ZCMaulp4E+1vpunwFdYuW4SuDwcOC8MsdfFI0b1IYFjAs2KylHe16G7GPWnr4tIn3PNMLi59om0AQre265sSi8Vapru43Cs4iuY1U5h2iubici/hunkuLn3CVSYXlz7x//HGGt31yEoPAAAAAElFTkSuQmCC",u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVMAAAAyCAYAAADhlDg/AAAOaklEQVR4nO3ce3BUVZ7A8S/icIOM7SB0L2zZJakEd0iPOLRG7FYwaPEYy6adENrFVOICUivCaMZYO1mcJb54zIwZRo2ySKCohMgQUUxwqGQsSSzdZFYmHUUDI+lIpDOG7UbcNALdS/TsH+n0I++QNgnw+1R1Ve4999z7O6dP/3L6npuMUkophBBCDMoVwx2AEEJcCiSZCiFEDEgyFUKIGJBkKoQQMSDJVAghYkCSqRBCxMCVsThJU1MTjY2NnDt3jtOnT8filEIIcVEZNdjnTOvq6lBKMW3aNMaOHRuruIQQ4qIyqJlpU1MTSilmzJjBqFGjYhWTEEJcdAZ1z7SxsZFp06ZJIhVCXPYGlUzPnTsnX+2FEIJBJlNZbBJCiHbyaJQQQsSAJFMhhIgBSaZCCBEDkkwvUy0tLcMdghCXFEmmQggRA5JMhRAiBiSZCiFEDEgyFUKIGJBkKka+gA9fIGK7LYAvaoeIuZHexyMwPkmmYoCcFNgLcPZUfMZHoC1iOwaDvn57GvmfROw4WkDaK/V9xzJI3v055Oz3AuB81UZBXWzPH/B16qvO5UfLWP+wDZvdxsqNZbjORJf76orIyrRhs69k/bvu6MI2N1UbV2Kz20jPLsLpG0BdiOjjEapTfO59uaR/j2OhPySZigHzfOLpscz50k/J+yhix8lSsrJK8V7w1Vw4yy1Yb4zYc7Acy22mPmMZtLMePGeDP5+qx/NtLE/upTQri9KTPRSfKGPl49X85PE97HtjD9lT3iLt6QpCOfHwy6T9m4v71u9hz47VGP9oI2t/R6mPimwbhZNXU1yyh433uMhZ9DL1bf2p2y6yj0eiUHxn6inInEdOk4bu+xwL/RCTfw49UP4TH7BtfxFv/u9pGBNP6qzHWXXThPbCUwd4YkcBnScBM25/ieenftxtGQD6hyjOuItJ33Psol3gRA1Fu6rxjJvKgn9eiEkH7oo8Cg9CszePvM/msMIGpVvKaXRB/iY31tRs5o93UlSjxxFfR9GfGmg1WMm834I+OBIDXzipx4T5eq19h6+R2ilW7FrHlX00OhOw/lzrGlSbF+dbpVS6WzFMt2O/MxFdxwhv8+F6r5TSQx6uMc7Bfp85dE289ZT9uZwGzzUYZ9lx3KLvvtF+LzXFhVR7rmHqfAcLk3ThshNOSsoqcZ8xcPNCOykJ4TLvX0sofd9Nq+FmHPelYBznw1mcT7mrEbbk4b7NQfZ8Y1TbAySw4vcpWG5ob2di2gocaypx/XY+ZsBZlo/lyY9IuU4DTGTkZFOyrhzvPQ70J8rZ3ZTNmhdM6ADd3WtYU/VTSj9ahemWPup26WM3FcVeLPMClO6Mfr+D7xjuD0qpONjePrsthUQdoXpJyc1U/KkV8/IMzDrwHi6jvKIBzzgjcxY6MAc/sO6KIrzmBQT+XEj1meA1zgbHWKcxEhXf35vR5eyhOMnF+k3lPQ/YITDkM1P/kU3c9Z+P8typiVjib8cSd4zn9s7F+voh/ADf+Tjm+xtfXzWde+JvD72m/WgMjJnItOC25arTHPCdZtLk4DH/OJG4oW7MEPvqq6+GO4SgCvJ2uTGnOpgzrppfLirABVwTb+Unk0FvsmJN0qNpekzmRHTjE7k52UqCDjjrovLVHH71JqQscTCHUpY9WISrDSCAc0c66UVOOm4MBJzV+GaZCX92nVSftmLWdQqpzU3JymWUBMw4ltgxHsoh/fmO8wRwPp9OziEj9iUOzN585q4sa58tnyhj2YJcGibZyVxigaL0LrO0UKtfLMQ93YFjlkb1Y2kUHA0WNJew7KESAmYHmQuN1P57Ouv/2n5l3/4slpWAZckKHJMqWZ5ZhBsNfdLNJI7XkWi2Yo2/pkvbtUkmLDdEJOR3y6l6cA7tc0U3rk8smH4c8QslwYSlytXej8dcVFlMJIYKNUw3Wah3ufuu26WPvdRuWU/Wi/WYUjOxJzSQuyCXmjPBft1kY3lZAHPqChzXV0fMgL3UbskhZ0crickm9Bp49y5j7lMNGBdmkmmBwowsKr4Otq+ugNznSgjc5mCB7gCPLE0jq8CLJdXOVFcuaZsjbjlExnfDfBxJnQfDMFGD8Nprrw2swrdH1PMbZqhJm/eqz78N7/68/EFF7i9UsVcp5d2rUnNnqNSqk72eqqXqF+E6l5C1a9eqo0ePdtl/9OhRtWrVKnXyZO/90l9ffvnlBdasVevi16nq8x3bx9XuB5aq3S3B0g3xat3BiMNbdqulS3crT+T2rHz1aai+X1U/dZNa+76/+6ttmKvy6yN2HFyn5r7yaVQstUop//tr1U1PVavwWY6rwtRFqrBJKdVUqBalFqrjoTK/On6wVh0PHuyPvHT1OhW/oVYppZTn9aVq6euecLuqw4cd3/VAsKyb+COuV/v7H6tflbeGy0Lt9qjdS8P91hPP60tVfHy8unXx86o61InhdkccGTpfZNwhBzva1XvdjmOj+/hhVXoqou07F6lFO4O9ed6v/N2Ohc7jpPOxSlU/Gx4r0f1bq9bFr1WVHV3aeQxFxddbnwytoZ2ZHvsviv2w/Pb7iI+4cvz8HainXuSBiUMazYj06KOPsnPnThoaGkL7GhoaeOGFF3jssceYMGHCMEYXpoW+csVBN9+4e3WnicRQfY1Ekxn3ie5mg/XUvJuC5YaIPQerSEnuei/Pd8KN2ZQYEYoRU7ITtxfwunEmmzCGo8d4ixmjBhDA80ER67PTsdlt2LJLeo77B+Ef467suJIP9xdmTIkRnXC9CXOdGy9gXvwHeGk2M+9dSe6rZdSfZUD0adv5/PPPeec/DGxdmoczAKDDeKOL5qgb0W7cHxoxjAfdRCM17uhFJa/bhWmyrs+60E0f32glaXx40/hPZpzu4Am+rqd0ey4r7TZs9y4n7+Po+LXIG4kBDzW717cvfN1rI2tvp8b+IKomuh7GVU9jYLgNbTL9Px91JJP0D8Htbw6xbe/L5AVf+78MH/pm5VxGPWUOvdYdGdJIh82ECROiEmpkIp06depwhxcbf/cQmTpbz3hhdDfHNTopv82KKfSB7LoYFSnQ5u+0raGNBkZraG3dP1Hgq8hleZWBjNzt7Cvdx74XHQNsDEAAOj3BwFXBTHDdfDa+/RH/vfsZMhI+JdeaS01/Hm44E/04mO5GB5lJBVQeBjBgmNKI+0TE8V8347rWgF4DzWDA0Ngc1cee5kYS9IY+63bbx5+4o84V+CaAFjy24IF8fJbV/OGNfex7u5jsW3tqkI+Kp5dTOTGDZ7buY9/b+9i8uB/90EXvY2A4DW0yvWIMkzjIsc63/vyfUfzxNupaw7tSLa/x9RPvhV7Zl0ge6Y/IhHrRJVJNw9cakQVGx8FXPlojk01VOZXNwZ/POCnZqTHH3L70EfjCifOL9vreukoSLObwbPOEk8opVszdzFj0yXMIbCvC2fH4UHMJW/c6sCYBSVYce7dSErpmFbk3tye1wGkPelMSxuA0qL6maoAN1mO5O0DBzvB9XvdbWylZbMWED+eruZQ0AuP0JN7pYEGCG28wM8WN9uKLyFKRbfe9txbb72rwdfSbz0n1X1KYOgVAR8riFLa+WIK7417zlny8/7qw/Z5q0kIeasknP3jfluYS8nakcP/dur7rdtvHFZR3/AZoc1NaXIoj2QT48DQmYpqmb5+Bemuo/rCnfgrQelKPyWRsn3G21VPz7gC7usf4RoahXc2Pv5XlV2zjjU8PkT1tOnE/nM7yn0+Hhm0Uf3aMuDERx8bp+dEPrx7S8EaSjoR66tSpiyeRAuaFa8hzzGTmPb/hnWfno9OnkJmcTtrsclYX7OGhawFLIu7f2bA1QcAL5l+/Qsb10LEIs2z0dj76tZn6j8G6Kry4EPhbPcxaTbfLDddnsOmXOTwydx7oNTxeHSt2bMeiAVhYs6OeZY6ZFOkNBLyQkhcs+9lqzPenMW+XAe1bjZQ7zANus/H+TWSvfYTZc8GgefBcu4LizRY0wGQxkpfRfl3OBkhY/gq/0QPoSUm3kL5kJuWrtrNnWWJE2y3o5j3J04dWMnumD+N14G7Ws7pgMwuDX7e1O9ZQfHgZabOLMIzzQPIzvHJ/x40MIxkvZJPz8GzmjTbQGtUXvdftvo8t8Jd0bBsD4PWg+5ditt+hAWYy8raSNtuGQQ9MScFyU0+9pMf+iJk0xzyK9BpoKVhmDLirex8Dw20wN1wHvAClOhabZqp73tyvql1HVHV1gUp9doaatHm/alEqtAB11x/3q3cPfRh6Of8neoHiUl2AGioXvgA1SJGLCd+0Ri1IRDlfq9alFqqGiF21GxapQlcf5z/vV62nul/MUkop/6nur+lv7SWW/vK3qtZvBnbdPp33q9bWntujzvtVb8X+Adbt2scRCzv+HtrQV4ydj+3l/elLv8bAMBny50zj52/hcNwmnnj/SawfA4zhroS1HFj8s6hnRA8ceZIDEfdJU+e8wxuGETi3FxdunK7ntatv9SzYYI94vCeAfv5G7Al9nPNKDd34nou18d3PaTRdDOY6mq7HRZOertunKzV6De1KLfwsbbch9fKZ6VK3jz7Weni/+oqx87G9vD+96+cYGCajlFLqQivv2rWLJUuWXPDF/WdPQ9zVxMnfYQ25lpYWJk+ePPQXDrhxHgbTDOOAHwIQw8GH6wMPhjsSR+ZX6xFkWP4CqkPcVZfvPdHLlmbEfAH3ysRw0ZF4h6TR/pA5oRBCxIAkUyGEiAFJpkIIEQOSTIUQIgYkmQohRAxIMr1MDctjUUJcwiSZCiFEDEgyFUKIGJBkKoQQMTCoZHr11fIXTEIIAYNMpmPHjuXcuXOxikUIIS5ag0qmCQkJHDlyhEH8rxQhhLgkDCqZTpkyhVGjRlFXVyczVCHEZW1Q/4KvQ1NTE42NjZw8eZLvvvsuFnEJIcRFJSbJVAghLnf/DxqI0FDHpPWLAAAAAElFTkSuQmCC",m="/knowledge-has-no-limit/assets/20230730235506.e93589d2.png",C="/knowledge-has-no-limit/assets/20230730235933.36fa5c02.png",g="/knowledge-has-no-limit/assets/20230731001005.777dcc48.png",h="/knowledge-has-no-limit/assets/20230731133050.3f401747.png",f="/knowledge-has-no-limit/assets/20230731212506.3bdf7deb.png",v="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMwAAAAsCAYAAAApZldwAAAFsUlEQVR4nO3cP0hbWxzA8W8feQqpgfDuoAGJYDGgDpIhLYJdgouTd+nklq4lS8bOHbOErmZzcolTFslSQfoyXByiEGngXYQ0wy1CNLRpWt9wo94kN39OevNqX38f6JB74rnn3++e3z1KH33+3LxhgOnpPwcVC/Fb+eNnN0CIX4kEjBAKJGCEUCABI4QCCRghFEjACKFAAkYIBRIwQiiQgBFCgQSMEAokYIRQ4PO0NjNPvFa9+6jPJkiG+5WHSMe2iLpUY5SypJrL7EXXCbndxzrmVeWMU/8GhdVIR1H1fJ+d5lrPdVVGKUuq4bjgcq//o+r5Pm+I83ZJu784bF5/Ix7uMBa5epC9WIJCLEFhcZlybZ+cdVt8zKvaFclFu3wveEXKOKbaU80xu43uiy58AVYaJ/f1e6ZMppglxYbdj/a/NB8wPLqDUcry6ty7hntTn93vnct61/Uh8/qb8TBgNPRVx46grfPSX+fwkz2y1U8XnPrX0NsPrtDSGnrrgvddA298PCPid91XOrVm2AxCxnQJurFZ5IwjysHtnt0kuuq+G/4/lMkUj2A2QdrfXTZ4Xn833qZkHSz+aUIkoAEW76/q6JpzEUZ47j9i95OFrrWjyMzbqZh2OdITbGEpTtI44M15pDOF6GpHzjgg07r9HCC5+OIucDu/WuawFeJl37pu2Qssd/fZmV6WyRRPCM/Oc1g747Sj3NGWxgHxoqMtHWmPs41j1qckQjJmz41RGvZd57y6MPPErSDpmQtSl/X7vlw7+teR3naO5Upwe8Bc/nyTCxjzbzKtEOmRc90ymdoVycUtQtf5EX9GQw8vc1gpkLPcFkp7QU1tUIi2J8jME6/kWdBcdozrS059QeaGtbPY3oXaE1s932fHOHa8c9XJWLAXSxBqtyFVKlNYjaBHEyyUsuxOORaGmSdeg3QsYbfJzBM3j3mmjVnfJI0yr60zdtmmENPssalkyfg3KMS22u+fJ+SsCLoGRsk5lhaGOfku/IjJnJKZeeLtxT9qGmMPXFz96ait8zoImY/l3rL2jpF2plfhpyR9Vd6NOzHmB3K+ZV47FmdvehkgGb5d7Bq6FoKm1Td1NOpVVoJP78cq/JQk49c3MaPOq2N8Qn/Ns0KA5Fx7DrQIm7465vX910+btx3ViIYf7u4CE9hh7k64YlvuJ1xdItP2UyjVXGZvdbzBCi2toRePyJgRXjgLXHcMjYUpOPxiAV33exxkpXbJR+jb9uqXK5h60lWuEb5dBMpdsFOc08YB8WJniT5WfZOhOq93NI1I5ZKFPv2IriZIl7LEi0fgG3Ay+kB4GjBGOzUo9Cx8t0Va5l0jQHjO4r1Vh9YZO8Uzx89U2SlejJiTR0jOfiBeyxMOOi4PCIDItEulWoRN84B3JkT7pByh6Rm4sp/unXUGCD8e1k439tjo2sM9qu0/r96IriYo4JbaPjzepWTWMbuN/i/M0blluCzcvcxXz0/I+eZ5pmno0UTHEW5hNmQ/bWIKL7DhLdL+KhnnsagWYdNXJVVypGtmnlQjxHPXxWmnO7la7zGtUcrbx8rhJ+itM944yqvnBTLM82zM9RQNhMjV8p4dW3tqyLz+YOXkSvennKHpmQncw1sep2RVUsVs1x3a26y2ztvrPPFKlkyFiWy/0dUN9I7TKw09ug3Ggb3lA4N+YQpAeItCuEym2JkirQS3eQvYJ0p0liv2JTq3DBXHqVZ4i70v++w4x06hzp76PF/bA+b1h+rVWMCZWYRIxx7u7gLwSP7XGCFGJ39LJoQCCRghFEjACKFAAkYIBRIwQiiQgBFCgQSMEAokYIRQIAEjhAIJGCEUDA2Y79+//xftEOKXMDRgWi0JGCFuDQ2Ym5sbms2W7DRCMOKf99/c3PD16zfg24SbI8TDJi/9QiiQgBFCgQSMEAokYIRQIAEjhAIJGCEUSMAIoeBfFAl98tExuKgAAAAASUVORK5CYII=",k="/knowledge-has-no-limit/assets/20230731224600.c081470c.png",x="/knowledge-has-no-limit/assets/20230801220717.bb49d750.png",T="/knowledge-has-no-limit/assets/20230724231007.21ae9701.png",P="/knowledge-has-no-limit/assets/20230724232546.14141d56.png",w="/knowledge-has-no-limit/assets/20230724234132.bcf6bd89.png",q="/knowledge-has-no-limit/assets/20230802130122.b483092c.png",S="/knowledge-has-no-limit/assets/20230802131025.1041bea8.png",M="/knowledge-has-no-limit/assets/20230802131831.da12d2f7.png",O="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAA3CAYAAAD6+O8NAAAIPklEQVR4nO2ae0xUVx7HPxUGLNCiEQhCKSyCJGMjYwWWxyYT67C+0iFRa5Csr8WaxUZIV0wwG8gGN8FE2q2YSiKLBDRCWrXpbCpLHDXTrbACVjB6rTJLoSMPgYkMCgoD7v4xMxTkNYNMuUnv5x/mnO+55/7ufOd3Hvfwmr+///9wmJVEFyWx1FrquHCEun853ouzCMvPRu5t+fyk9hTXih7Nb0AO4Dr7S5/y35LT6A0waJi7gOaC5vwCDDLw251O2HwH4yCvYMgwgz2mCWaE5Wcj9/gBzf4vrTUriS5S8vjYCfQPZn+38VgylCky80WniUHAPDy73hco3iN2TwI+Hr0I08W9/PcoD0XQ9dkJ7t21VPkfziYm9KV2pptoMi/Zpb+CIVPz3PwWsZvd+c/FQWd071TcN+/gvQ0+dF24QceWiGnbhu37LbJbZaNmAHSdKqDKw1pw9SFozzZCzZ12604x5LHhIT7RCXDx6qR6QGYakRE+yICRgYfcKymjuWHEIi5ZRth+NRFve+ECjJh7MFSUcfvbfli+kTWHVvOGraMt2ai3WD7O1Ty2wHSf2uwzGDtXEj2NIe5/SLOMBCdbx9W/MJoYNAKugYQdSSG87xsq8763T399pXMM4c5dOtRrCVt+dUK6v7n/Y6L8H1L7+TkeGxfi9f42EvalMJB1hs4+WLJnG3Lv+1w/doWnz8BduZmEHSmYfiyi9cEl/p17HRdWsCpnLWgLuFVt6Xeu5rFnV2p5NlOjoPeIVnrx05nCyXXXQMKO7CTEeIHKfMF+/dltFsw28OkRaL7jSogqeILiF+pFh/ZLOhtMDBoeYTypo0P2Fv4Kiy6TufLc0IjxgYlBg4m+syVUflhEq/ULHzaYGDQ8ZQQYMVnaDBpMznmMKQj6MIE3mr+h4Vtg/Q7URTvGNwiNJMjHFY+ILWzI207Ab7Bbd06GAH3/bMR8OAZf1/sTtKVjhhobHdZxtatWj0tyCptO9mBs7uVJ5/fcPTuxj/nCdf0O3vFp4Vb2JL98G6OZ7IXf7hSiDn0wZpEzve40QzBcxWDKZpm6lZGXpK4xQ40N25Dz4ko5VQ2BLFZG4B8ayOLobajjfxj/QPNIiCoE863TdBqnbzdsMDGMCUPeFfwLN7F6Ldy8MrPuPEOAlrqHvKNYQddL9e6vuzJomPqJXhjbMF5swwjwZgyxnySwQgF3G5wZrf14xPwRdczYmhbr32CCM+NBW07rpLHOpDvZkBeaG/yk2oSf+Tk91rqu5qfIY9QENVyky7gQr/VqYmKGaTxYQnsfBOdmI5fdpLbkunVSX8FintMxzr/bPDYlERS6DPegHmCYQUP/nMS8YIk3Mg8AL1xwxd3HG/dnjM5Ttk3nKPGbWaeyFVoZlKUQs2c75pJLGI1e+O1ey1Kznpo6e3QnG8KwgKE5ibfHrB77Tv6d+sw0Ij9KH1323i/5gvY+6yMdv4BXxjpiD60eXfa2XfhidFK30aK5S1ByCutWAcywgXMAv33p4zZufnvSWcbPr2Bsm85RTON3n515edRnHmDVR+m4AOYePfXHyunus0dfyWvSuyxxMUtDwDXIGxfr51962TkTC/y9kVmHFbHFNhOzNkTCOThpYygxWyRDRIZkiMiQDBEZkiEi41dqyE6OVlRwdOd8xzGRX6kh4sXxfUjYBrLStqII9LSUe9vQnc+lUGsC4sgqziC86TKNvvHEB3oCvQil+eRW6u3QZ3H/oV6aKvPJLrde7xFFas5elCGLcAPob6OuPJdPtCaIy6I4Q4HnJN22XEomq8yhb8IpuHh5ef3VkQtS//I3oqnn7KkSNNo62oJieX+NgqGqa9w3B/G7pFj8lyykt6qEU181MhT8LrHxy5BVXePOjPrM91d/nEOi74+cKyjkK60OYeG7rEmMJUio5EY3qA4f4QPfR1SVfE55ZR1tgbGsXxONxw0tjfe+QxAEvtNBmDKEJ7pcPivTodPpqK7rxiSCfwFw+OVi8cFkiseUhcsqkuThyCNBU2OtbNVyVFNv0QvkKD6NQ64CNHbq07BI5sZQax2aeusBkXAAXYFNjSMq2JO26jzKdAMWOVdOfIWK8ChL/3pBAKIwA/QLCNOcM80HDhvioUznyM54Asfl/fhX3+ah3p8L7f3044Zskf36dGiFFlQbd1FRlkRbey+m9moul2qoGfPKKjDxNBWJ469rsbP/+cZBQ9QcTo1nkf4c+ef1DACEbeVgysSzc2fRXpbFAZ0SpSoSRXgwAVEpZERF4/unbDSWpKBNl0uxbvx1/W2/WIivhGOGxMkJcOun6bIG24iB79CEZjK3MT/HAE88GaK31359JkytOjTFOssIF5DGiU+jUMSDRmvRPT1kCEKj/R2KCMcMqRFoT1MQnqgmyqRnwDeK7erwie2CVWSpu9HoPVGmxuE71Eq11gF9SuSkn8ghigbOl2rQD4CvSo43AzS1A9RQ37oXReRO0pTF6Lo9CFPvYqtiCN2fD1LcbutHoLt3I/KQDcjlrcAQgmDnKs/JODhkaSgtV5CxPYXMHKC/jeqyamRp8eNamZsEBhLTyUlxw7KsLaV8wH59agQKjn9NToaKlMwcS9VQLy2X/0GBNWO1+YUE5+xFmZaDEkuMDaWFY8wAqOdrXRPhSbvIyQHop+F4KkdrmHfm+DzEts84TuqkTzeTLiHt1EWGdGIoMqQMERkOTeoVFRXT6snJya8UjISUIaJDMkRkSIaIDMkQkSEZIjIkQ0SGZIjIkAwRGZIhIkMyRGRIhogMyRCRIRkiMiRDRIZkiMiQDBEZkiEiQzpTFxlShogMyRCR8X+Jg4/HyacywwAAAABJRU5ErkJggg==",R="/knowledge-has-no-limit/assets/image-20230907170013372.e2b85797.png",N="/knowledge-has-no-limit/assets/image-20230910124039852.28ae118c.png",j="/knowledge-has-no-limit/assets/20230803215748.c9018d16.png",I="/knowledge-has-no-limit/assets/20230803234617.ff1de44a.png",_="/knowledge-has-no-limit/assets/image-20230912225527276.7bce078b.png",L="/knowledge-has-no-limit/assets/image-20230912230126698.51140ec3.png",U="/knowledge-has-no-limit/assets/image-20230912233509676.b59b8306.png",H="/knowledge-has-no-limit/assets/image-20231026163210714.c62a6d70.png",G="/knowledge-has-no-limit/assets/image-20231026172523721.760c77b0.png",Q="/knowledge-has-no-limit/assets/image-20230918195427392.54160c8d.png",V="/knowledge-has-no-limit/assets/image-20230918195943084.66f68734.png",Y="/knowledge-has-no-limit/assets/image-20230920233953465.91d2e50e.png",K="/knowledge-has-no-limit/assets/image-20231004160721209.1f59adba.png",J="/knowledge-has-no-limit/assets/image-20231005160001756.d5d23881.png",X="/knowledge-has-no-limit/assets/image-20231027160831087.f235f55c.png",z="/knowledge-has-no-limit/assets/image-20231027161402389.d63b5229.png",W="/knowledge-has-no-limit/assets/image-20231014232241708.57b7a7e6.png",Z="/knowledge-has-no-limit/assets/image-20231018114148973.70f2446b.png",$="/knowledge-has-no-limit/assets/image-20231025120416451.5c3ea645.png",ss="/knowledge-has-no-limit/assets/image-20231018162032890.9d77b948.png",ns="/knowledge-has-no-limit/assets/image-20231018164333693.a7cefe87.png",as="/knowledge-has-no-limit/assets/image-20231018181527028.c9f086ae.png",ls="/knowledge-has-no-limit/assets/image-20231025221934828.2d377ee0.png",ps="/knowledge-has-no-limit/assets/image-20231025222131864.245a2b94.png",os="/knowledge-has-no-limit/assets/image-20231022171508939.e45c3425.png",es="/knowledge-has-no-limit/assets/image-20231026230137786.ac607d35.png",rs="/knowledge-has-no-limit/assets/image-20231025223655594.0c265fdb.png",cs="/knowledge-has-no-limit/assets/image-20231025223936193.03077481.png",ts="/knowledge-has-no-limit/assets/image-20231026230315788.d7a28379.png",ys="/knowledge-has-no-limit/assets/image-20231025235310505.0a7686a7.png",Ds="/knowledge-has-no-limit/assets/image-20231026111416896.e4a0779b.png",Fs="/knowledge-has-no-limit/assets/image-20231026113733722.6fb06d79.png",is="/knowledge-has-no-limit/assets/image-20231027000259329.e006b11d.png",Bs="/knowledge-has-no-limit/assets/watermark_type_ZmFuZ3poZW5naGVpdGk_shadow_10_text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjcxOTY1Ng___size_16_color_FFFFFF_t_70.2592eeeb.png",xs=JSON.parse('{"title":"nestjs","description":"","frontmatter":{"outline":[1,3],"typora-copy-images-to":"./assets","order":1},"headers":[],"relativePath":"node/framework/nest/nest.md","lastUpdated":1725964165000}'),As={name:"node/framework/nest/nest.md"};function bs(Es,s,ds,us,ms,Cs){return F(),i("div",null,s[0]||(s[0]=[B(`<h1 id="nestjs" tabindex="-1">nestjs <a class="header-anchor" href="#nestjs" aria-label="Permalink to &quot;nestjs&quot;">â€‹</a></h1><h2 id="_0-æ­å»ºå¼€å‘ç¯å¢ƒ" tabindex="-1">0. æ­å»ºå¼€å‘ç¯å¢ƒ <a class="header-anchor" href="#_0-æ­å»ºå¼€å‘ç¯å¢ƒ" aria-label="Permalink to &quot;0. æ­å»ºå¼€å‘ç¯å¢ƒ&quot;">â€‹</a></h2><h3 id="_0-1-å®‰è£…ä¾èµ–" tabindex="-1">0.1. å®‰è£…ä¾èµ– <a class="header-anchor" href="#_0-1-å®‰è£…ä¾èµ–" aria-label="Permalink to &quot;0.1. å®‰è£…ä¾èµ–&quot;">â€‹</a></h3><p>å¿…é¡»å®‰è£…çš„ä¾èµ–æœ‰ï¼š<code>Node.js(â‰¥12)</code>ã€<code>Nestjs CLI</code></p><p>åœ¨ä½ çš„ç”µè„‘å®‰è£…å¥½ <code>Node</code> ç¯å¢ƒåï¼Œä½¿ç”¨ <code>npm</code> æ¥ä¸‹è½½ <code>@nestjs/cli</code> æˆ–è€…ç›´æ¥ä½¿ç”¨å†…ç½®å‘½ä»¤ <code>npx</code> æ¥æ›¿ä»£ä¸‹è½½è¿™æ­¥éª¤ã€‚</p><blockquote><p>æ¨èä½¿ç”¨ <code>pnpm</code> æ¥ä»£æ›¿ <code>npm</code> è¿›è¡Œå¼€å‘ã€‚</p></blockquote><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">@nestjs/cli</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># or yarnã€pnpm</span></span>
<span class="line"><span style="color:#FFCB6B;">yarn</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">add</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">@nestjs/cli</span></span>
<span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">add</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">@nestjs/cli</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>ä»»ä½•ç¼–è¾‘å™¨</code>æ¥å¼€å‘ <code>nest</code> åº”ç”¨</p><h3 id="_0-2-åˆ›å»ºæ–°é¡¹ç›®" tabindex="-1">0.2. åˆ›å»ºæ–°é¡¹ç›® <a class="header-anchor" href="#_0-2-åˆ›å»ºæ–°é¡¹ç›®" aria-label="Permalink to &quot;0.2. åˆ›å»ºæ–°é¡¹ç›®&quot;">â€‹</a></h3><p>ä½¿ç”¨ <code>nest</code> è„šæ‰‹æ¶å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªåä¸º <code>nest-demo-project</code> çš„æ–°é¡¹ç›®</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">nest</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">new</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">project-name</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">â„¹ï¸TypeScript æ¨¡æ¿</p><p>è¦åˆ›å»º <code>TypeScript</code> æ¨¡æ¿çš„ â€‹ æ–°é¡¹ç›®ï¼Œå°† <code>--strict</code> ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>nest new</code> å‘½ä»¤</p></div><p>å¦‚æœä½ åœ¨ä¸Šä¸€æ­¥ä¸æƒ³å…¨å±€å®‰è£…è„šæ‰‹æ¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å†…ç½®å‘½ä»¤ <code>npx</code> ä»£æ›¿è„šæ‰‹æ¶ä½¿ç”¨</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">nest</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">new</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">project-name</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>è„šæ‰‹æ¶å°†ä¼šåˆ›å»º <code>project-name</code> ç›®å½•ï¼Œå®‰è£… <code>node_modules</code> å’Œä¸€äº›å…¶ä»–æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶åˆ›å»º <code>src</code> ç›®å½•ï¼Œç›®å½•ä¸­åŒ…å«äº†å‡ ä¸ªæ ¸å¿ƒæ–‡ä»¶ã€‚</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">src</span></span>
<span class="line"><span style="color:#BABED8;"> â”œâ”€â”€ app</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">controller</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">spec</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ts</span></span>
<span class="line"><span style="color:#BABED8;"> â”œâ”€â”€ app</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">controller</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ts</span></span>
<span class="line"><span style="color:#BABED8;"> â”œâ”€â”€ app</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">module</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ts</span></span>
<span class="line"><span style="color:#BABED8;"> â”œâ”€â”€ app</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">service</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ts</span></span>
<span class="line"><span style="color:#BABED8;"> â””â”€â”€ main</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ts</span></span>
<span class="line"></span></code></pre></div><p><code>main.ts</code> åŒ…å«ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œæ˜¯æ•´ä¸ªåº”ç”¨çš„ä¸»å…¥å£</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-h1AGc" id="tab-g6G5Cm4" checked="checked"><label for="tab-g6G5Cm4">main.ts</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">NestFactory</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/core</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">AppModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./app.module</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">bootstrap</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">NestFactory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">AppModule</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">bootstrap</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div></div><h2 id="_1-åŸºæœ¬æ¦‚å¿µ" tabindex="-1">1. åŸºæœ¬æ¦‚å¿µ <a class="header-anchor" href="#_1-åŸºæœ¬æ¦‚å¿µ" aria-label="Permalink to &quot;1. åŸºæœ¬æ¦‚å¿µ&quot;">â€‹</a></h2><h3 id="_1-1-mvc-ä¸‰å±‚æ¶æ„" tabindex="-1">1.1. MVC ä¸‰å±‚æ¶æ„ <a class="header-anchor" href="#_1-1-mvc-ä¸‰å±‚æ¶æ„" aria-label="Permalink to &quot;1.1. MVC ä¸‰å±‚æ¶æ„&quot;">â€‹</a></h3><p><code>MVC</code> æ˜¯ä¸€ç§æ¶æ„çš„æ€æƒ³ï¼Œä¸æ˜¯å…·ä½“çš„å®ç°ã€‚</p><ul><li>Mï¼š<code>Modal</code>ï¼Œæ•°æ®/ä¸šåŠ¡/é€»è¾‘ï¼Œè´Ÿè´£å¤„ç†æ•°æ®é€»è¾‘æˆ–ä¸šåŠ¡é€»è¾‘çš„å·¥ä½œï¼Œå…¶ä¸­æ•´ä¸ª <code>Modal</code> åˆæ‹†åˆ†ä¸ºä¸šåŠ¡ <code>service</code> å¤„ç†å±‚å’Œæ¨¡å‹ <code>DAO</code> å±‚</li><li>Vï¼š<code>View</code>ï¼Œè§†å›¾ï¼Œå‰åç«¯æœªåˆ†ç¦»å‰ï¼Œä»£è¡¨ç€ <code>Jsp</code> è§†å›¾ï¼›åˆ†ç¦»åç”±å‰ç«¯è¿›è¡Œå¤„ç†æ¸²æŸ“</li><li>Cï¼š<code>Controller</code>ï¼Œæ§åˆ¶å™¨ï¼Œå®¢æˆ·ç«¯çš„ <code>HTTP</code> è¯·æ±‚æœ€å…ˆç»è¿‡æ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨è´Ÿè´£åˆ†å‘è°ƒåº¦å¤„ç†è¯·æ±‚</li></ul><p>ä¸€æ¬¡å®Œæˆçš„è¯·æ±‚æµç¨‹ï¼š</p><p><img src="`+n+'" alt="è¯·æ±‚æµç¨‹å›¾"></p><ol><li>å®¢æˆ·ç«¯å‘é€ <code>HTTP</code> è¯·æ±‚</li><li>æ§åˆ¶å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚çš„å†…å®¹ä¸åŒï¼Œè°ƒç”¨ <code>Modal</code> å¤„ç†ä¸šåŠ¡</li><li>ä¸šåŠ¡ <code>service</code> å±‚ï¼Œè¿›è¡Œä¸šåŠ¡é€»è¾‘çš„å¤„ç†ï¼Œè°ƒç”¨æ¨¡å‹ <code>DAO</code> å±‚ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ</li><li>æ¨¡å‹ <code>DAO</code> å±‚å¤„ç†å®Œæ•°æ®åº“ä¹‹åï¼ŒæŠŠç»“æœä¾æ¬¡å“åº”è¿”å› <code>DAO -&gt; service -&gt; controller</code></li><li>æ­¤æ—¶ï¼Œæ§åˆ¶å™¨è¿˜æœªèƒ½å“åº”ç»“æœï¼Œéœ€è¦æ ¹æ®æ¨¡å‹å“åº”çš„æ•°æ®åˆ¤æ–­æ˜¯å¦éœ€è¦å“åº”è§†å›¾ã€‚éœ€è¦å±•ç¤ºè§†å›¾ï¼Œæ§åˆ¶å™¨è°ƒåº¦è§†å›¾ç»„ä»¶ï¼ˆæ¯”å¦‚<code>Jsp</code>ï¼‰å±•ç¤ºå¹¶åé¦ˆå› <code>controller</code>ï¼›ä¸éœ€è¦å±•ç¤ºè§†å›¾ï¼Œæ§åˆ¶å™¨ç›´æ¥å°†æ•°æ®ç»è¿‡å“åº”ä½“è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><h3 id="_1-2-åè¯è§£é‡Š" tabindex="-1">1.2. åè¯è§£é‡Š <a class="header-anchor" href="#_1-2-åè¯è§£é‡Š" aria-label="Permalink to &quot;1.2. åè¯è§£é‡Š&quot;">â€‹</a></h3><table><thead><tr><th>åç§°</th><th>ç®€è¦æ¦‚æ‹¬</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>PO</td><td>æŒä¹…åŒ–å¯¹è±¡</td><td>æ•°æ®åº“ä¸­çš„è¡¨æ˜ å°„çš„å¯¹è±¡ç±»ï¼Œè¡¨çš„å­—æ®µä¸ PO å¯¹è±¡çš„å±æ€§ä¸€ä¸€å¯¹åº”</td></tr><tr><td>VO</td><td>å€¼å¯¹è±¡</td><td>ç”¨äºä¸šåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œæ¯”å¦‚å“åº”ç»™å®¢æˆ·ç«¯çš„æ•°æ®å¯¹è±¡ï¼Œä¸»è¦å¯¹åº”ç•Œé¢çš„æ˜¾å¼æ•°æ®</td></tr><tr><td>DTO</td><td>æ•°æ®ä¼ è¾“å¯¹è±¡</td><td>ç»è¿‡å¤„ç†åï¼ˆå¢åŠ /å‡å°‘å±æ€§ï¼‰çš„ POJO å¯¹è±¡ï¼Œç”¨äºè·¨è¿›ç¨‹æˆ–ç½‘ç»œä¼ è¾“çš„å¯¹è±¡è½½ä½“ï¼Œæ¯”å¦‚å‰ç«¯ä¼ é€’çš„è¯·æ±‚ä½“å‚æ•°ï¼Œç”¨ DTO æ‰¿è½½ã€‚DTOã€VOã€POJO ä¹‹é—´çš„å…³ç³»å¯ä»¥è¿›è¡Œè½¬æ¢ï¼Œæ¯”å¦‚å±•ç¤ºåœ¨è§†å›¾å±‚æ—¶ï¼ŒPOJO çš„èº«ä»½å°±æ˜¯ VOï¼›æ‰¿è½½è¯·æ±‚å“åº”ä½“å‚æ•°ã€è·¨è¿›ç¨‹å‚æ•°ä¼ é€’æ—¶ï¼ŒPOJO çš„èº«ä»½å°±æ˜¯ DTO</td></tr><tr><td>DAO</td><td>æ•°æ®è®¿é—®å¯¹è±¡</td><td>ä¸ºä¸šåŠ¡å±‚æä¾›æ¥å£ï¼Œè´Ÿè´£å’Œåº•å±‚æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œå°è£…ç®€å•çš„ CRUD æ–¹æ³•</td></tr><tr><td>BO</td><td>ä¸šåŠ¡å¯¹è±¡</td><td>ç”± service å±‚è¾“å‡ºçš„å°è£…ä¸šåŠ¡çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥åŒ…æ‹¬æˆ–å¤šä¸ªå…¶ä»–å¯¹è±¡ï¼Œæ¯”å¦‚ä¸€ä¸ªå­¦ç”Ÿå¯¹è±¡æœ‰ç­çº§ã€è¯¾ç¨‹è¡¨ç­‰ä¿¡æ¯ï¼Œé‚£ä¹ˆç­çº§å°±æ˜¯ä¸€ä¸ª POï¼Œè¯¾ç¨‹è¡¨æ˜¯ä¸€ä¸ª POï¼Œå»ºç«‹ä¸€ä¸ªå­¦ç”Ÿå¯¹åº”çš„ BO å¯¹è±¡å°±æ˜¯å¤„ç†è¿™äº›å°è£…çš„ä¿¡æ¯</td></tr><tr><td>POJO</td><td>ç®€å•çš„å¯¹è±¡</td><td>å¯ä»¥è½¬åŒ–ä¸º POã€DTOã€VOï¼Œæ¯”å¦‚ POJO åœ¨ä¼ è¾“æ—¶å°±æ˜¯ DTOï¼Œå“åº”å›ç»™è§†å›¾å±‚å±•ç¤ºæ—¶å°±æ˜¯ VO</td></tr></tbody></table><p>åˆ†å±‚ä¹‹é—´å’Œåè¯çš„å¯¹åº”å…³ç³»ï¼š</p><ul><li>ä¸šåŠ¡å±‚ï¼šã€æ‹†åˆ† service å’Œæ•°æ®æ¨¡å‹ã€‘ï¼ŒPOJOã€POã€DTOã€BO</li><li>è§†å›¾å±‚ï¼šå‰ç«¯è´Ÿè´£ï¼ŒåŒ…å« VOã€DTO</li><li>æ§åˆ¶å±‚ï¼šåŒ…å« DTOã€POJOã€VO</li></ul><hr><p>åœ¨ä¸Šé¢èŠ±äº†å¤§é‡çš„ç¯‡å¹…ä»‹ç»äº† <code>MVCä¸‰å±‚æ¶æ„</code> çš„æ¦‚å¿µï¼Œé‚£ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿ</p><p>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œä¸€ä¸ªåº”ç”¨å‘å±•åˆ°åºå¤§çš„ä½“é‡æ—¶ï¼Œå¦‚æœä¸è¿›è¡Œè§£è€¦åˆ†å±‚è®¾è®¡ï¼Œé‚£ä¹ˆå¸¦æ¥çš„ç»´æŠ¤éš¾åº¦å°†æ˜¯ä¸å¯ä¼°é‡çš„ï¼Œè€¦åˆåº¦ä¹Ÿå¾ˆé«˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªç—›ç‚¹ï¼Œ<code>MVCæ¶æ„</code> å‡ºç°äº†ï¼Œè€Œä¸”æ™®éåº”ç”¨äºå¸‚åœºä¸Šçš„å¾ˆå¤šäº’è”ç½‘åº”ç”¨ç¨‹åºã€‚</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>ä¸€ä¸ªæ¶æ„æˆ–æŠ€æœ¯çš„å‡ºç°ï¼Œå¿…å®šä¼´éšç€å®ƒçš„åˆ©ä¸å¼Šï¼Œ<code>MVCæ¶æ„</code> æ‰€å¸¦æ¥çš„é™ä½é¡¹ç›®å¤æ‚åº¦ã€è§£è€¦åˆçš„ä¼˜ç‚¹ï¼Œæ˜¯å»ºç«‹åœ¨æ¶æ„å¤æ‚çš„åŸºç¡€ä¸Šï¼Œéœ€è¦èŠ±è´¹ä¸€å®šæ—¶é—´å»æ€è€ƒè®¾è®¡åº”ç”¨æ¶æ„ï¼Œä¸åˆ©äºä¸­å°å‹è½¯ä»¶çš„å¿«é€Ÿå¼€å‘ï¼Œè°ƒè¯•èµ·æ¥ä¹Ÿå¢åŠ äº†å¤æ‚åº¦ï¼Œä½†è¿™ä¸å½±å“å®ƒæ˜¯æœ€å¸¸ç”¨çš„æ¶æ„è®¾è®¡ã€‚</p></div><p>åœ¨ <code>nest</code> åº”ç”¨ä¸­ï¼Œ<code>MVCæ¶æ„</code> æ˜¯æ€ä¹ˆä½“ç°çš„å‘¢ï¼Ÿ</p><p>å¯ä»¥ç®€å•ç†è§£ä¸ºï¼š</p><ul><li><code>*.controller.ts</code>ï¼šå¯¹æ ‡æ§åˆ¶ <code>controller</code> å±‚ï¼Œç”¨æˆ·è®¿é—®æ—¶æœ€å…ˆç»è¿‡æ§åˆ¶å™¨ï¼Œç”±æ§åˆ¶å™¨è°ƒåº¦åˆ†å‘ç»™å…¶ä»–ä»»åŠ¡å¤„ç†ï¼Œç®€å•å¯¹æ ‡ä¸ºå‰ç«¯é¡¹ç›®çš„è·¯ç”±ã€‚</li><li><code>*.service.ts</code>ï¼šå¯¹æ ‡æœåŠ¡ <code>service</code> å±‚ï¼Œå°è£…å¯¹æ•°æ®åº“çš„ <code>CRUD</code> çš„æ–¹æ³•ï¼Œä¸ <code>*.entity.ts</code> å±äºåŒä¸€ä¸ªå±‚ã€‚</li><li><code>*.entity.ts</code>ï¼šå¯¹æ ‡æŒä¹…åŒ–å¯¹è±¡ <code>PO</code> ï¼Œæ˜ å°„æ•°æ®åº“è¡¨ï¼Œè¡¨çš„å­—æ®µä¸è¯¥å¯¹è±¡çš„å±æ€§ä¸€ä¸€å¯¹åº”ã€‚</li><li><code>*.dto.ts</code>ï¼šå¯¹æ ‡æ•°æ®ä¼ è¾“å¯¹è±¡ <code>DTO</code>ã€‚</li><li><code>*.module.ts</code>ï¼šæ¨¡å—ï¼Œå¯¹åº”ç”¨ç¨‹åºçš„æ‹†åˆ†ä¸ºæ¯ä¸ªå°çš„æ¨¡å—ï¼Œè¿™äº›æ¨¡å—ä¼šæˆä¸º <code>nest</code> åº”ç”¨çš„åŸºåº§ï¼Œç®€å•å¯¹æ ‡å‰ç«¯çš„é¡µé¢ã€åŠŸèƒ½æ¨¡å—ã€‚</li></ul><h2 id="ioc-di" tabindex="-1">2. <code>nest</code> è®¾è®¡æ¨¡å¼ <a class="header-anchor" href="#ioc-di" aria-label="Permalink to &quot;2. `nest` è®¾è®¡æ¨¡å¼ {#ioc-di}&quot;">â€‹</a></h2><p><code>nest</code> åº”ç”¨ä¸­é»˜è®¤ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼â€”â€”<code>IoCæ§åˆ¶åè½¬</code>å’Œ<code>DIä¾èµ–æ³¨å…¥</code>ã€‚</p><ul><li><code> IoCæ§åˆ¶åè½¬</code> ä¸æ˜¯ä¸€ç§å®ç°çš„æ–¹æ³•æˆ–æŠ€å·§ï¼Œè€Œæ˜¯ä¸€ç§ç¬¼ç»Ÿçš„è½¯ä»¶è®¾è®¡æ€æƒ³ï¼Œå®ƒæ›´å¤šè¡¨è¿°çš„æ˜¯ä¸ºä»€ä¹ˆè¦æ§åˆ¶åè½¬ã€æ§åˆ¶åè½¬çš„ç›®çš„æ˜¯ä»€ä¹ˆã€‚</li><li><code>DIä¾èµ–æ³¨å…¥</code> åˆ™æ˜¯ æ§åˆ¶åè½¬ çš„ä¸€ç§å®ç°æ–¹æ³•ï¼Œæ€ä¹ˆå»å®ç° æ§åˆ¶åè½¬ï¼Œä¾èµ–æ³¨å…¥ åªæ˜¯å…¶ä¸­çš„ä¸€ç§æ–¹æ³•ã€‚</li></ul><h3 id="_2-1-iocå’Œdi" tabindex="-1">2.1. <code>IoC</code>å’Œ<code>DI</code> <a class="header-anchor" href="#_2-1-iocå’Œdi" aria-label="Permalink to &quot;2.1. `IoC`å’Œ`DI`&quot;">â€‹</a></h3><p>å¦‚æœæˆ‘ä»¬éœ€è¦å®ç°ä¸€æ®µä»£ç é€»è¾‘ï¼Œå¸¸è§„æƒ…å†µä¸‹æ˜¯é€’è¿›å®ç°ï¼Œè·Ÿæ­ç§¯æœ¨ä¸€æ ·çš„ã€‚</p><p>æ¯”å¦‚å®é™…ç”Ÿæ´»ä¸­ä»¥æ±½è½¦æ¥ä¸¾ä¾‹å­ï¼š</p><p><img src="'+a+`" alt="image-20230806212007557"></p><p>æ±½è½¦æŠ½è±¡ä¸ºä¸€ä¸ªç±»ï¼Œå…¶ä¸­åŒ…å«å¼•æ“ã€å“ç‰Œç­‰ç­‰åŸºç¡€ä¾èµ–ç±»ï¼Œå½“å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ±½è½¦ï¼Œç”¨ä»£ç æ¥è§£é‡Šå°±æ˜¯ä¸‹é¢çš„ä¾‹å­ï¼š</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-jHxPH" id="tab-LPaDE2n" checked="checked"><label for="tab-LPaDE2n">Brand å“ç‰Œ</label><input type="radio" name="group-jHxPH" id="tab-oKBYu0o"><label for="tab-oKBYu0o">Engine å¼•æ“</label><input type="radio" name="group-jHxPH" id="tab-AyIKS7Y"><label for="tab-AyIKS7Y">Car ä¸Šå±‚ç±»</label><input type="radio" name="group-jHxPH" id="tab-5audNLz"><label for="tab-5audNLz">main åº”ç”¨å±‚</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ä¾èµ–1ï¼šBrand å“ç‰Œ</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Brand</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">belongsToNationality</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">belongsToNationality</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ åˆå§‹åŒ–å“ç‰Œ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">belongsToNationality</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">belongsToNationality</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ä¾èµ–2ï¼šEngine å¼•æ“</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Engine</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">brakeType</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">cylinder</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">brakeType</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">cylinder</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ åˆå§‹åŒ–å¼•æ“</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">brakeType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">brakeType</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">cylinder</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">cylinder</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Car</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è‡ªå±æ€§</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">color</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä¾èµ–å±æ€§</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">brandName</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">brandNBelongsToNationality</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">engineBrakeType</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">engineCylinder</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä¾èµ–ç±»</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">brand</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Brand</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">engine</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Engine</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">color</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">type</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">brandName</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">brandNBelongsToNationality</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">engineBrakeType</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">engineCylinder</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~æ±½è½¦ç±»åˆå§‹åŒ–</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">color</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">color</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">type</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">brand</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Brand</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">brandName</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">brandNBelongsToNationality</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">engine</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Engine</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">engineBrakeType</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">engineCylinder</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ èŠœæ¹–ï¼Œè·‘èµ·æ¥äº†</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> car </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Car</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">çº¢è‰²</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">è½¿è½¦</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å®é©¬</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¾·å›½</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ±½æ²¹å‘åŠ¨æœº</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">car</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">run</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div><p><img src="`+l+`" alt="image-20230806215510355"></p><p>ä¸Šé¢è¿™ç§å†™æ³•æš´éœ²äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å½“ <code>Car</code> çš„ä¾èµ–é¡¹ï¼Œåç»­å¦‚æœéœ€è¦å¯¹å®ƒä»¬è¿›è¡Œæ‰©å±•å¹¶è¿›è¡Œä¼ å‚ï¼Œå°±éœ€è¦åœ¨ä¾èµ–ç±»æ„é€ å‡½æ•°ä¸­è¿›è¡Œä¼ å‚ï¼Œä¸Šå±‚ç±»ä¹Ÿéœ€è¦è·Ÿç€æ”¹å˜è¿›è¡Œä¼ å‚ã€‚</p><p>å°†ä¸Šé¢çš„ä¾‹å­ï¼Œç¨ä½œä¿®æ”¹ï¼Œæ›´æ”¹å®ƒä»¬çš„å…¥å‚ä¼ å‚ï¼š</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-syvIj" id="tab-rz2_qet" checked="checked"><label for="tab-rz2_qet">Brand å“ç‰Œ</label><input type="radio" name="group-syvIj" id="tab-SZVA06a"><label for="tab-SZVA06a">Engine å¼•æ“</label><input type="radio" name="group-syvIj" id="tab-8_7tvcy"><label for="tab-8_7tvcy">Car ä¸Šå±‚ç±»</label><input type="radio" name="group-syvIj" id="tab-ZNiT03n"><label for="tab-ZNiT03n">main åº”ç”¨å±‚</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ä¾èµ–1ï¼šBrand å“ç‰Œ</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Brand</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">belongsToNationality</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">logo</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">belongsToNationality</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line diff add"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">logo</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ åˆå§‹åŒ–å“ç‰Œ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span></span>
<span class="line diff add"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">logo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">logo</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">belongsToNationality</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">belongsToNationality</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ä¾èµ–2ï¼šEngine å¼•æ“</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Engine</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">brakeType</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">cylinder</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">brakeType</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">cylinder</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ åˆå§‹åŒ–å¼•æ“</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">brakeType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">brakeType</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">cylinder</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">cylinder</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Car</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è‡ªå±æ€§</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">color</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä¾èµ–å±æ€§</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">brandName</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">brandNBelongsToNationality</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">brandLogo</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">engineBrakeType</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">engineCylinder</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä¾èµ–ç±»</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">brand</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Brand</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">engine</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Engine</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">color</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">type</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">brandName</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">brandNBelongsToNationality</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line diff add"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">brandLogo</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">engineBrakeType</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">engineCylinder</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~æ±½è½¦ç±»åˆå§‹åŒ–</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">color</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">color</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">type</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">brand</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Brand</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#BABED8;">brandName</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#BABED8;">brandNBelongsToNationality</span><span style="color:#89DDFF;">,</span></span>
<span class="line diff add"><span style="color:#F07178;">      </span><span style="color:#BABED8;">brandLogo</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">engine</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Engine</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">engineBrakeType</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">engineCylinder</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ èŠœæ¹–ï¼Œè·‘èµ·æ¥äº†</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> car </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Car</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">çº¢è‰²</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">è½¿è½¦</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å®é©¬</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¾·å›½</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://p8.itc.cn/images01/20210425/61183c2a47a649e88bc52821d2c8a5ef.jpeg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ±½æ²¹å‘åŠ¨æœº</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">car</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">run</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œä¾èµ–ç±»å¦‚æœåªæ˜¯æ‹“å±•ä¸€ä¸ªå±æ€§ï¼Œå°±éœ€è¦ä¿®æ”¹ä¾èµ–ç±»ã€ä¸Šå±‚ç±»ã€åº”ç”¨ç±»ä¸‰ä¸ªæ–‡ä»¶ã€‚å¯¹äºé¡¶å±‚çš„åº”ç”¨ç±»æ¥è¯´ï¼Œå…¶å®å¹¶ä¸å…³å¿ƒä¾èµ–ç±»éœ€è¦ä»€ä¹ˆå‚æ•°ï¼Œå‚æ•°ä¹Ÿä¸éœ€è¦ç»è¿‡åº”ç”¨ç±»ä¼ é€’ï¼Œå½“å‰çš„ä»£ç æ›´å¤šè€¦åˆåœ¨äº†åº”ç”¨ç±»ï¼Œä½¿å¾—ä¾èµ–ç±»å’Œåº”ç”¨ç±»ä¹‹é—´å‘ç”Ÿäº†å¼ºè€¦åˆã€‚</p><p>è¿™å°±æ˜¯æ²¡æœ‰ <code>IoCæ§åˆ¶åè½¬</code> ä»£ç æ‰€å¸¦æ¥çš„çš„é—®é¢˜ï¼Œç»™ç»´æŠ¤å’Œæ‹“å±•éƒ½å¸¦æ¥äº†ä¸å°çš„éº»çƒ¦ã€‚</p><p>æ¥ä¸‹æ¥ä½¿ç”¨ <code>IoCæ§åˆ¶åè½¬</code> çš„è®¾è®¡æ¨¡å¼æ¥æ”¹é€ ä¸€ä¸‹ä»£ç </p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-Ckak-" id="tab-QNmLw-J" checked="checked"><label for="tab-QNmLw-J">Brand å“ç‰Œ</label><input type="radio" name="group-Ckak-" id="tab-IUCan_T"><label for="tab-IUCan_T">Engine å¼•æ“</label><input type="radio" name="group-Ckak-" id="tab-eZb0HqY"><label for="tab-eZb0HqY">Car ä¸Šå±‚ç±»</label><input type="radio" name="group-Ckak-" id="tab-pWqCTqn"><label for="tab-pWqCTqn">main åº”ç”¨å±‚</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ä¾èµ–1ï¼šBrand å“ç‰Œ</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Brand</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">belongsToNationality</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">logo</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">belongsToNationality</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">logo</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ åˆå§‹åŒ–å“ç‰Œ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">belongsToNationality</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">belongsToNationality</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">logo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">logo</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ä¾èµ–2ï¼šEngine å¼•æ“</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Engine</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">brakeType</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">cylinder</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">brakeType</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">cylinder</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ åˆå§‹åŒ–å¼•æ“</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">brakeType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">brakeType</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">cylinder</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">cylinder</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Car</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è‡ªå±æ€§</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">color</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">color</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">type</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">brand</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Brand</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">engine</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Engine</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~æ±½è½¦ç±»åˆå§‹åŒ–</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">color</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">color</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">type</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ èŠœæ¹–ï¼Œè·‘èµ·æ¥äº†</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// å°†ä¾èµ–å¯¹è±¡çš„æ§åˆ¶æƒäº¤ç”±å¤–éƒ¨æ§åˆ¶ï¼Œä¸å†ä¸åº”ç”¨å±‚ä¹‹é—´å‘ç”Ÿå¼ºè€¦åˆï¼Œè¿™å°±æ˜¯ IoCæ§åˆ¶åè½¬</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> brand </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Brand</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å®é©¬</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¾·å›½</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://p8.itc.cn/images01/20210425/61183c2a47a649e88bc52821d2c8a5ef.jpeg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> engine </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Engine</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ±½æ²¹å‘åŠ¨æœº</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> car </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Car</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">çº¢è‰²</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">è½¿è½¦</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> brand</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> engine)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">car</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">run</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div></div><p>å°†ä¾èµ–å¯¹è±¡çš„æ§åˆ¶æƒäº¤ç”±å¤–éƒ¨æ§åˆ¶ï¼Œè¿™ä¸ªå¤–éƒ¨å¯ä»¥æ˜¯<code>IoCå®¹å™¨</code>ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„å…¨å±€å•ä¾‹å¯¹è±¡ï¼Œæ§åˆ¶å·²ç»å‘ç”Ÿäº†åè½¬ï¼Œä¾èµ–ç±»ä¸å†ä¸åº”ç”¨å±‚ä¹‹é—´å‘ç”Ÿå¼ºè€¦åˆï¼Œè¿™å°±æ˜¯ <code>IoCæ§åˆ¶åè½¬</code>ã€‚</p><h3 id="_2-2-æœ€å°è‡ªåŠ¨æŒ¡iocå®¹å™¨" tabindex="-1">2.2. æœ€å°è‡ªåŠ¨æŒ¡<code>IoCå®¹å™¨</code> <a class="header-anchor" href="#_2-2-æœ€å°è‡ªåŠ¨æŒ¡iocå®¹å™¨" aria-label="Permalink to &quot;2.2. æœ€å°è‡ªåŠ¨æŒ¡\`IoCå®¹å™¨\`&quot;">â€‹</a></h3><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-G8cu3" id="tab-cfK5t9F" checked="checked"><label for="tab-cfK5t9F">IoCå®¹å™¨</label><input type="radio" name="group-G8cu3" id="tab-J582O0s"><label for="tab-J582O0s">main è‡ªåŠ¨æŒ¡åº”ç”¨ç±»</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Container</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">dependencies</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> [</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;">]</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">register</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">dependency</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">dependencies</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">dependency</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getDependency</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">dependencies</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">dependencies</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">ä¾èµ– </span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">key</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">æœªè¢«æ³¨å†Œåˆ°IoCå®¹å™¨ä¸­</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> container </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Container</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">container</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">register</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">brand</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Brand</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å®é©¬</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¾·å›½</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://p8.itc.cn/images01/20210425/61183c2a47a649e88bc52821d2c8a5ef.jpeg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">container</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">register</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">engine</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Engine</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ±½æ²¹å‘åŠ¨æœº</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> car </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Car</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">çº¢è‰²</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">è½¿è½¦</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> container</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getDependency</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">brand</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> container</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getDependency</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">engine</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">))</span></span>
<span class="line"><span style="color:#BABED8;">car</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">run</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div></div><h2 id="_3-è£…é¥°å™¨" tabindex="-1">3. è£…é¥°å™¨ <a class="header-anchor" href="#_3-è£…é¥°å™¨" aria-label="Permalink to &quot;3. è£…é¥°å™¨&quot;">â€‹</a></h2><p>è£…é¥°å™¨æ˜¯<code>typeScript</code>çš„å®éªŒæ€§ç‰¹æ€§ï¼Œç›®çš„æ˜¯ç»™è£…é¥°çš„ç›®æ ‡æ·»åŠ ä¸ŠæŸäº›ç‰¹å®šçš„åŠŸèƒ½ï¼Œå°±å¥½æ¯”æ˜¯<code>java spring</code>çš„<code>AOPåˆ‡é¢ç¼–ç¨‹</code>ï¼Œå¯¹ç±»ã€æ–¹æ³•ã€å±æ€§ã€å‚æ•°è¿›è¡Œåˆ‡é¢å¢å¼ºã€‚</p><h3 id="_3-1-é…ç½®è£…é¥°å™¨ç¯å¢ƒ" tabindex="-1">3.1. é…ç½®è£…é¥°å™¨ç¯å¢ƒ <a class="header-anchor" href="#_3-1-é…ç½®è£…é¥°å™¨ç¯å¢ƒ" aria-label="Permalink to &quot;3.1. é…ç½®è£…é¥°å™¨ç¯å¢ƒ&quot;">â€‹</a></h3><p>è£…é¥°å™¨å±äº <code>typeScript</code> çš„å®éªŒæ€§ç‰¹æ€§ï¼Œæ‰€ä»¥éœ€è¦é…ç½®æ–‡ä»¶ <code>tsconfig.json</code> å¼€å¯æ”¯æŒ</p><p>é…ç½® <code>tsconfig.json</code> ï¼ˆå¦‚æœæ²¡æœ‰è¯¥æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ <code>tsc --init</code> åˆå§‹åŒ–ï¼‰</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">compilerOptions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">experimentalDecorators</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">true,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">emitDecoratorMetadata</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">true</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-2-ç±»è£…é¥°å™¨" tabindex="-1">3.2. ç±»è£…é¥°å™¨ <a class="header-anchor" href="#_3-2-ç±»è£…é¥°å™¨" aria-label="Permalink to &quot;3.2. ç±»è£…é¥°å™¨&quot;">â€‹</a></h3><p>ç±»è£…é¥°å™¨ä¼šåœ¨ç»‘å®šæ—¶æ³¨å…¥ä¸€ä¸ªå‚æ•°ï¼Œå³ä½¿è¿™ä¸ªç±»è¿˜æœªå®ä¾‹åŒ–ï¼Œè£…é¥°å™¨å‡½æ•°ä¹Ÿä¼šæ‰§è¡Œï¼š</p><ul><li>targetï¼šå½“å‰è£…é¥°å™¨è£…é¥°çš„ç±»</li></ul><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> AnimalDecorator</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ClassDecorator</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// target === å½“å‰éœ€è¦å¢å¼ºçš„ç±»</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">target</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// [class Animal]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#BABED8;">AnimalDecorator</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Animal</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>å¦‚æœç±»è£…é¥°å™¨è¿”å›ä¸€ä¸ªæ–°çš„ç±»ï¼Œå®ƒä¼šå°†æ–°çš„ç±»æ¥æ›¿æ¢åŸæœ‰ç±»çš„å®šä¹‰</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> AnimalDecorator </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(...</span><span style="color:#BABED8;font-style:italic;">args</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#BABED8;">[]</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}&gt;(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">class</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">extends</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">target</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">new class</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    age</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">18</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">((</span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Animal</span><span style="color:#BABED8;">() </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name) </span><span style="color:#676E95;font-style:italic;">// new class</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-3-è£…é¥°å™¨è¯­æ³•ç³–" tabindex="-1">3.3. è£…é¥°å™¨è¯­æ³•ç³– <a class="header-anchor" href="#_3-3-è£…é¥°å™¨è¯­æ³•ç³–" aria-label="Permalink to &quot;3.3. è£…é¥°å™¨è¯­æ³•ç³–&quot;">â€‹</a></h3><p>è£…é¥°å™¨ <code>@xxxDecorator</code> æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œè£…é¥°å™¨çš„è¯­æ³•ç›¸å½“äºå°†è¢«è£…é¥°çš„ç±»ä¼ é€’è¿›è¿™ä¸ªå‡½æ•°ä¸­ï¼Œç„¶ååœ¨å‡½æ•°å†…è¿›è¡Œå¢å¼ºæ“ä½œã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> AnimalDecorator</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ClassDecorator</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// target === å½“å‰éœ€è¦å¢å¼ºçš„ç±»</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">target</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// [class Animal]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 1. è£…é¥°å™¨è¯­æ³•</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#BABED8;">AnimalDecorator</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Animal</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 2. å®Œæ•´å†™æ³•</span></span>
<span class="line"><span style="color:#82AAFF;">AnimalDecorator</span><span style="color:#BABED8;">(Animal)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-4-è£…é¥°å™¨å åŠ ä½¿ç”¨" tabindex="-1">3.4. è£…é¥°å™¨å åŠ ä½¿ç”¨ <a class="header-anchor" href="#_3-4-è£…é¥°å™¨å åŠ ä½¿ç”¨" aria-label="Permalink to &quot;3.4. è£…é¥°å™¨å åŠ ä½¿ç”¨&quot;">â€‹</a></h3><p>å¤šä¸ªè£…é¥°å™¨å¯ä»¥å åŠ ä½¿ç”¨ï¼Œå®ƒä»¬çš„æ‰§è¡Œé¡ºåºä¸º<code>ä»ä¸‹åˆ°ä¸Š</code>ã€<code>ä»å°åˆ°å¤§ï¼ˆè£…é¥°çš„èŒƒå›´ï¼‰</code>æ‰§è¡Œã€‚</p><p>å¤šä¸ªåŒç±»å‹çš„è£…é¥°å™¨å åŠ ä½¿ç”¨ï¼Œä¼šä»æœ€åº•ä¸‹çš„è£…é¥°å™¨å¼€å§‹æ‰§è¡Œï¼Œå¯ä»¥çœ‹åšæ˜¯ <code>f(g(x))</code> çš„æ•°å­¦å¼å­ï¼ŒåŒæ ·ä¹Ÿæ˜¯å‡½æ•°ç»„åˆ <code>compose</code> çš„æ¦‚å¿µã€‚</p><p><strong>åŒç±»å‹è£…é¥°å™¨æ‰§è¡Œé¡ºåºï¼š</strong></p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> MessageDecorator</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ClassDecorator</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">MessageDecorator</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">target</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">success</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æˆåŠŸ~MessageDecorator</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> CallDecorator</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ClassDecorator</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">CallDecorator</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">target</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">success</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æˆåŠŸ~CallDecorator</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#BABED8;">CallDecorator</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#BABED8;">MessageDecorator</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">User</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">success</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">login</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ å¤„ç†ç™»å½•ä¸šåŠ¡é€»è¾‘</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">success</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç™»å½•æˆåŠŸ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><img src="`+A+`" alt="Pastedimage20230730115254"></p><p>å¤šä¸ªè£…é¥°å™¨å†…å¦‚æœå¯¹ç›®æ ‡è¿›è¡Œå¤šæ¬¡å¢å¼ºï¼Œå®ƒåªä¼šæ¥æ”¶ç¬¬ä¸€ä¸ªå¢å¼ºçš„è£…é¥°å™¨æ–¹æ³•ï¼Œåé¢çš„ä¸æ¥æ”¶å¤„ç†ã€‚</p><p><strong>ä¸åŒç±»å‹è£…é¥°å™¨æ‰§è¡Œé¡ºåºï¼š</strong></p><p>è£…é¥°å™¨å¯ä»¥å¯¹ä¸€ä¸ªç±»è¿›è¡Œå åŠ ä½¿ç”¨ï¼Œä¸åŒç±»å‹çš„è£…é¥°å™¨ï¼ˆç±»ã€æ–¹æ³•ã€å‚æ•°ï¼‰ã€‚</p><p>å®ƒä»¬çš„æ‰§è¡Œé¡ºåºä¸º ä»å°åˆ°å¤§ï¼Œä»ä¸‹å¾€ä¸Šçš„é¡ºåºæ‰§è¡Œï¼Œä»å±æ€§ã€æ–¹æ³•ã€å‚æ•°ã€ç±»ï¼Œä»è£…é¥°å™¨å®šä¹‰çš„ä¸Šä¸‹é¡ºåºã€‚</p><p>æ¯ä¸ªè£…é¥°å™¨åœ¨åˆå§‹åŒ–æ—¶ï¼ˆå³ä½¿ class æœªè¢«å®ä¾‹åŒ–ï¼‰è§¦å‘ä¸€æ¬¡ï¼Œåœ¨å…¨å±€ä»…æ­¤è§¦å‘ä¸€æ¬¡ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ç±»è£…é¥°å™¨</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> ClassDecorator1 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(...</span><span style="color:#BABED8;font-style:italic;">args</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#BABED8;">[]</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}&gt;(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç±»è£…é¥°å™¨1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> ClassDecorator2 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(...</span><span style="color:#BABED8;font-style:italic;">args</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#BABED8;">[]</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}&gt;(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç±»è£…é¥°å™¨2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ–¹æ³•è£…é¥°å™¨</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> MethodDecorator1</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MethodDecorator</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ–¹æ³•è£…é¥°å™¨1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> MethodDecorator2</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MethodDecorator</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ–¹æ³•è£…é¥°å™¨2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å±æ€§è£…é¥°å™¨</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> PropertyDecorator1</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PropertyDecorator</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">propertyKey</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å±æ€§è£…é¥°å™¨1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> PropertyDecorator2</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PropertyDecorator</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">propertyKey</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å±æ€§è£…é¥°å™¨2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å‚æ•°è£…é¥°å™¨</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> ParameterDecorator1 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">propertyKey</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">undefined</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">parameterIndex</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å‚æ•°è£…é¥°å™¨1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> ParameterDecorator2 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">propertyKey</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">undefined</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">parameterIndex</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å‚æ•°è£…é¥°å™¨2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#BABED8;">ClassDecorator2</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#BABED8;">ClassDecorator1</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">OverlayTest</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#BABED8;">PropertyDecorator2</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#BABED8;">PropertyDecorator1</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(@</span><span style="color:#BABED8;">ParameterDecorator2 </span><span style="color:#89DDFF;">@</span><span style="color:#BABED8;">ParameterDecorator1 </span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#BABED8;">MethodDecorator2</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#BABED8;">MethodDecorator1</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">test</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p><img src="`+b+`" alt="image-20231002213940053"></p><h3 id="_3-5-è£…é¥°å™¨å·¥å‚" tabindex="-1">3.5. è£…é¥°å™¨å·¥å‚ <a class="header-anchor" href="#_3-5-è£…é¥°å™¨å·¥å‚" aria-label="Permalink to &quot;3.5. è£…é¥°å™¨å·¥å‚&quot;">â€‹</a></h3><p>è£…é¥°å™¨å‡½æ•°å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œä¸ºçš„æ˜¯è®©è£…é¥°å™¨æ¥æ”¶å‚æ•°ï¼Œèƒ½å¤Ÿè¿›ä¸€æ­¥å¢å¼ºå¤„ç†ã€‚</p><p>æ¥æ”¶ä»»æ„ç±»å‹çš„å‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›çš„å‡½æ•°å°±æ˜¯è£…é¥°å™¨æ–¹æ³•ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> DecoratorFactory </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">type</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ClassDecorator</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">target</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">å½“å‰çš„è£…é¥°å™¨ç±»å‹æ˜¯ </span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">type</span><span style="color:#89DDFF;">}\`</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">DecoratorFactory</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">animal</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Animal</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ èŠœæ¹–ï¼Œçˆ·æ¥è¾£</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Animal</span><span style="color:#BABED8;">() </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_3-6-æ–¹æ³•è£…é¥°å™¨" tabindex="-1">3.6. æ–¹æ³•è£…é¥°å™¨ <a class="header-anchor" href="#_3-6-æ–¹æ³•è£…é¥°å™¨" aria-label="Permalink to &quot;3.6. æ–¹æ³•è£…é¥°å™¨&quot;">â€‹</a></h3><p>å¯¹æ–¹æ³•è¿›è¡Œå¢å¼ºçš„è£…é¥°å™¨ï¼Œå¯ä»¥å¯¹æ–¹æ³•è¿›è¡ŒåŸå‹ä¿®æ”¹ã€åˆ‡é¢å¢å¼ºã€æ›¿æ¢å®ç°ç­‰æ“ä½œæ–¹å¼ã€‚</p><p>æ–¹æ³•è£…é¥°å™¨ä¼šåœ¨è¿è¡Œæ—¶ï¼Œè¢«æ³¨å…¥ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li>targetï¼šå¯¹äºé™æ€æˆå‘˜æ¥è¯´å°±æ˜¯å½“å‰çš„ç±»çš„æ„é€ å‡½æ•° <code>target.prototype.constructor</code>ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ¥è¯´å°±æ˜¯å½“å‰å®ä¾‹çš„åŸå‹å¯¹è±¡ <code>target.prototype</code></li><li>propertyKeyï¼šè£…é¥°çš„æ–¹æ³•åç§°</li><li>descriptorï¼šè£…é¥°æ–¹æ³•çš„å±æ€§æè¿°ç¬¦</li></ul><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> axios </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> Get </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">url</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MethodDecorator</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">propertyKey</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">descriptor</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PropertyDescriptor</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ target</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">target</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ propertyKey</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">propertyKey</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">method</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">descriptor</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Function</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">axios</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">url</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">method</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Http</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://api.apiopen.top/api/getHaoKanVideo?page=0&amp;size=5</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">getList</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p>å¦‚æœå¯¹æ–¹æ³•çš„å®šä¹‰è¿›è¡Œé‡å†™ï¼Œé‚£ä¹ˆä¸ºäº†ä¸æ”¹å˜<code>this</code>çš„æŒ‡å‘ï¼Œæ–°çš„åˆ‡é¢å‡½æ•°å¿…é¡»æ€»æ˜¯ä½¿ç”¨å‡½æ•°è¡¨è¾¾å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç®­å¤´å‡½æ•°</p></blockquote><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> Get </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">url</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MethodDecorator</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">propertyKey</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">descriptor</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PropertyDescriptor</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">method</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">descriptor</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Function</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// é‡å†™å¹¶ä¸”æ˜¯ç”¨å‡½æ•°è¡¨è¾¾å¼</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">descriptor</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#BABED8;">axios</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">url</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">method</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_3-7-å±æ€§è£…é¥°å™¨" tabindex="-1">3.7. å±æ€§è£…é¥°å™¨ <a class="header-anchor" href="#_3-7-å±æ€§è£…é¥°å™¨" aria-label="Permalink to &quot;3.7. å±æ€§è£…é¥°å™¨&quot;">â€‹</a></h3><p>å¯¹å±æ€§çš„è£…é¥°ï¼Œä¼šåœ¨å®ä¾‹åŒ–å¯¹è±¡æ—¶ï¼Œæ³¨å…¥ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li>targetï¼šå¯¹äºé™æ€æˆå‘˜æ¥è¯´å°±æ˜¯å½“å‰çš„ç±»çš„æ„é€ å‡½æ•° <code>target.prototype.constructor</code>ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ¥è¯´å°±æ˜¯å½“å‰å®ä¾‹çš„åŸå‹å¯¹è±¡ <code>target.prototype</code></li><li>propertyKeyï¼šå½“å‰è£…é¥°çš„å±æ€§çš„åç§°</li></ul><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> MinLength </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">length</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PropertyDecorator</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">propertyKey</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">descriptor</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PropertyDescriptor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      set</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">v</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">v</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">å¯†ç é•¿åº¦ä¸èƒ½ä½äº</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">length</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">ä½</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">v</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      get</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">defineProperty</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">propertyKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">descriptor</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">User</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">MinLength</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">6</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">password</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">password</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">password</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">User</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">123</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><blockquote><p>å¦‚æœé•¿åº¦ä¸è¶³ï¼Œé€šä¸è¿‡æ ¡éªŒä¼šæŠ›å‡ºé”™è¯¯ï¼Œé€šè¿‡æ ¡éªŒåˆ™æ²¡æœ‰ä»»ä½•æç¤º</p></blockquote><h3 id="_3-8-å‚æ•°è£…é¥°å™¨" tabindex="-1">3.8. å‚æ•°è£…é¥°å™¨ <a class="header-anchor" href="#_3-8-å‚æ•°è£…é¥°å™¨" aria-label="Permalink to &quot;3.8. å‚æ•°è£…é¥°å™¨&quot;">â€‹</a></h3><p>å‚æ•°è£…é¥°å™¨æœ€å¸¸è§çš„åœºæ™¯å°±æ˜¯æ­é… <code>reflect-metadata</code> è¿›è¡Œç»„åˆä½¿ç”¨ï¼Œä¼šåœ¨æ–¹æ³•è°ƒç”¨æ—¶ï¼Œæ³¨å…¥ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li>targetï¼šå¯¹äºé™æ€æˆå‘˜æ¥è¯´å°±æ˜¯å½“å‰çš„ç±»çš„æ„é€ å‡½æ•° <code>target.prototype.constructor</code>ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ¥è¯´å°±æ˜¯å½“å‰å®ä¾‹çš„åŸå‹å¯¹è±¡ <code>target.prototype</code></li><li>propertyKeyï¼šå½“å‰è£…é¥°çš„æ–¹æ³•åç§°</li><li>parameterIndexï¼šå½“å‰è£…é¥°å‚æ•°çš„ç´¢å¼•ä½ç½®</li></ul><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> axios </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">axios</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">reflect-metadata</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> Get </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">url</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MethodDecorator</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">propertyKey</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">descriptor</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PropertyDescriptor</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">method</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">descriptor</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Function</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getMetadata</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">key</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">propertyKey</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">axios</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">url</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">method</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> Result </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ParameterDecorator</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">target</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">propertyKey</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">undefined</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// è®°å½•æ•°æ®ï¼Œæ–¹ä¾¿æ–¹æ³•è£…é¥°å™¨æ ¡éªŒå¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">defineMetadata</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">key</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">target</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">propertyKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">symbol</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Http</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://api.apiopen.top/api/getHaoKanVideo?page=0&amp;size=5</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">getList</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Result</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">result</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸš€ ~ data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">data</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Http</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="_4-http-åè®®" tabindex="-1">4. HTTP åè®® <a class="header-anchor" href="#_4-http-åè®®" aria-label="Permalink to &quot;4. HTTP åè®®&quot;">â€‹</a></h2><p><code>HTTP</code> åè®®æ˜¯æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ <strong>è¯·æ±‚å’Œåº”ç­”ï¼ˆrequestã€responseï¼‰</strong> çš„æ ‡å‡†åè®®ï¼Œè§„å®šä¼ è¾“æŠ¥æ–‡å½“ä¸­ï¼Œä¼ è¾“å’Œå“åº”æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼è¿›è¡Œçš„ä¸€ç§è§„èŒƒåè®®ã€‚</p><p>æ‰€è°“çš„è¯·æ±‚å’Œåº”ç­”ï¼Œå°±æ˜¯å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å“åº”è¿™æ¬¡çš„è¯·æ±‚ï¼Œæ­¤æ—¶å°±å®Œäº†ä¸€æ¬¡ <code>HTTP</code> è¯·æ±‚</p><p>ç¬¦åˆäº† <code>HTTP</code> åè®®çš„è§„èŒƒä¼ è¾“æŠ¥æ–‡å°±æ˜¯ <code>HTPP</code> åè®®ã€‚</p><h3 id="_4-1-http-è±¹çº¹" tabindex="-1">4.1. <code>HTTP</code> è±¹çº¹ <a class="header-anchor" href="#_4-1-http-è±¹çº¹" aria-label="Permalink to &quot;4.1. \`HTTP\` è±¹çº¹&quot;">â€‹</a></h3><p>ä¸€ä¸ªå®Œæ•´çš„ <code>HTPP</code> åè®®çš„æŠ¥æ–‡ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ul><li>èµ·å§‹è¡Œï¼ˆè¯·æ±‚ã€å“åº”è¡Œï¼‰ï¼šæè¿°è¯·æ±‚æˆ–å“åº”çš„åŸºæœ¬ä¿¡æ¯</li><li>é¦–éƒ¨å­—æ®µï¼ˆè¯·æ±‚ã€å“åº”å¤´ï¼‰ï¼šä½¿ç”¨ <code>key-value</code> çš„å½¢å¼æ›´åŠ è¯¦ç»†çš„è¯´æ˜æŠ¥æ–‡</li><li>æ¶ˆæ¯æ­£æ–‡ï¼ˆè¯·æ±‚ã€å“åº”ä½“ï¼‰ï¼šå®é™…ä¼ è¾“çš„æ•°æ®ï¼Œå¯ä»¥æ˜¯æ–‡æœ¬ã€æ–‡ä»¶ã€è§†é¢‘ã€éŸ³é¢‘ç­‰äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯”å¦‚å‰ç«¯ä¼ è¾“çš„è¡¨å•æ•°æ®ï¼Œåç«¯å“åº”çš„ <code>jsonæ•°æ®</code></li></ul><p>è¯·æ±‚æŠ¥æ–‡æ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="`+p+'" alt="image-20210922135409188"></p><p>å“åº”æŠ¥æ–‡æ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="'+o+`" alt="image-20210922135409188"></p><h4 id="_4-1-1-è¯·æ±‚æ–¹æ³•" tabindex="-1">4.1.1. è¯·æ±‚æ–¹æ³• <a class="header-anchor" href="#_4-1-1-è¯·æ±‚æ–¹æ³•" aria-label="Permalink to &quot;4.1.1. è¯·æ±‚æ–¹æ³•&quot;">â€‹</a></h4><p>HTTP/1.1 åè®®ä¸­å…±å®šä¹‰äº†å…«ç§æ–¹æ³•ï¼ˆä¹Ÿå«â€œåŠ¨ä½œâ€ï¼‰æ¥ä»¥ä¸åŒæ–¹å¼æ“ä½œæŒ‡å®šçš„èµ„æºã€‚</p><p>ä¸‹é¢æ˜¯æœ€å¸¸è§çš„å‡ ç§è¯·æ±‚æ–¹å¼ï¼š</p><ul><li><strong>GETï¼š</strong> ä»æœåŠ¡å™¨è·å–èµ„æº</li><li><strong>POSTï¼š</strong> åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æºï¼Œå¸¸ç”¨äºè¡¨å•æäº¤ï¼Œåˆ›å»ºæ•°æ®</li><li><strong>PUTï¼š</strong> æ›´æ–°æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œè¿”å›æ•´ä¸ªæ›´æ–°åçš„èµ„æº</li><li><strong>DELETEï¼š</strong> åˆ é™¤æœåŠ¡å™¨ä¸Šçš„èµ„æº</li><li><strong>PATCHï¼š</strong> æ›´æ–°æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œä»…è¿”å›æ›´æ–°çš„éƒ¨åˆ†èµ„æº</li></ul><h4 id="_4-1-2-å¸¸ç”¨httpå“åº”ç " tabindex="-1">4.1.2. å¸¸ç”¨httpå“åº”ç  <a class="header-anchor" href="#_4-1-2-å¸¸ç”¨httpå“åº”ç " aria-label="Permalink to &quot;4.1.2. å¸¸ç”¨httpå“åº”ç &quot;">â€‹</a></h4><ul><li>1xx æ¶ˆæ¯â€”â€”è¯·æ±‚å·²è¢«æœåŠ¡å™¨æ¥æ”¶ï¼Œç»§ç»­å¤„ç†</li><li>2xx æˆåŠŸâ€”â€”è¯·æ±‚å·²æˆåŠŸè¢«æœåŠ¡å™¨æ¥æ”¶ã€ç†è§£ã€å¹¶æ¥å—</li><li>3xx é‡å®šå‘â€”â€”éœ€è¦åç»­æ“ä½œæ‰èƒ½å®Œæˆè¿™ä¸€è¯·æ±‚</li><li>4xx è¯·æ±‚é”™è¯¯â€”â€”è¯·æ±‚å«æœ‰è¯æ³•é”™è¯¯æˆ–è€…æ— æ³•è¢«æ‰§è¡Œï¼Œå®¢æˆ·ç«¯</li><li>5xx æœåŠ¡å™¨é”™è¯¯â€”â€”æœåŠ¡å™¨åœ¨å¤„ç†æŸä¸ªæ­£ç¡®è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ï¼Œ500</li></ul><table><thead><tr><th>å¸¸è§çš„å“åº”ç </th><th></th><th></th></tr></thead><tbody><tr><td>200</td><td>OK</td><td>ä»å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å·²ç»æ­£å¸¸å¤„ç†äº†ã€‚</td></tr><tr><td>204</td><td>No Content</td><td>æœåŠ¡ç«¯å·²ç»æ­£å¸¸å¤„ç†äº†,ä½†æ˜¯å“åº”ä¸­æ²¡æœ‰å®ä½“ï¼Œä¹Ÿä¸å…è®¸æœ‰å®ä½“ã€‚</td></tr><tr><td>301</td><td>Moved Permanently</td><td>æ°¸ä¹…æ€§ï¼Œé‡å®šå‘ã€‚è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²ç»æ‹¥æœ‰äº†æ–°çš„ uriï¼Œéœ€è¦é‡æ–°è®¿é—®ã€‚</td></tr><tr><td>302</td><td>Moved Temporarily</td><td>ä¸´æ—¶é‡å®šå‘ã€‚</td></tr><tr><td>400</td><td>Bad Request</td><td>è¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™å»ã€‚</td></tr><tr><td>401</td><td>Unauthorized</td><td>è¯·æ±‚éœ€è¦æœ‰é€šè¿‡ HTTP è¯·æ±‚çš„è®¤è¯ä¿¡æ¯ã€‚</td></tr><tr><td>403</td><td>Forbidden</td><td>è¯·æ±‚è¢«é˜»æ­¢ï¼Œå¯èƒ½å› ä¸ºæŸäº›æƒé™é—®é¢˜ï¼Œæ¯”å¦‚è®¿é—®çš„æ–‡ä»¶æ²¡æœ‰æƒé™ç­‰ã€‚</td></tr><tr><td>404</td><td>Not Found</td><td>è¡¨ç¤ºåœ¨æœåŠ¡å™¨ä¸Šæ²¡æœ‰ä½ è¦æ‰¾çš„èµ„æº</td></tr><tr><td>500</td><td>Internal server Error</td><td>æœåŠ¡å™¨æ‰§è¡Œç¨‹åºå‡ºç°å¼‚å¸¸</td></tr></tbody></table><h4 id="_4-1-3-é¦–éƒ¨å­—æ®µ" tabindex="-1">4.1.3. é¦–éƒ¨å­—æ®µ <a class="header-anchor" href="#_4-1-3-é¦–éƒ¨å­—æ®µ" aria-label="Permalink to &quot;4.1.3. é¦–éƒ¨å­—æ®µ&quot;">â€‹</a></h4><p>é¦–éƒ¨å­—æ®µæ˜¯æ„æˆ http æŠ¥æ–‡çš„é‡è¦å…ƒç´ ï¼Œå®ƒèƒ½èµ·åˆ°ä¼ é€’é¢å¤–é‡è¦ä¿¡æ¯çš„ä½œç”¨ï¼Œé¦–éƒ¨ä¿¡æ¯ä¸€èˆ¬ä¼šæä¾›æŠ¥æ–‡ç±»å‹ã€ç¼–ç å’Œå¤§å°ã€è®¤è¯ä¿¡æ¯ï¼Œç¼“å­˜ç­–ç•¥ç­‰ä¿¡æ¯ã€‚</p><p>è®°ä½å¸¸ç”¨çš„å‡ ä¸ªå³å¯è¯·æ±‚ï¼š</p><ul><li>Content-Typeï¼šè¯·æ±‚ä½“æ˜¯ä»€ä¹ˆç¼–ç æ ¼å¼</li><li>Content-Lengthï¼šè¯·æ±‚ä½“ä½“ç§¯å¤§å°</li><li>Keep-Aliveï¼šä¿æŒ tcp æ—¶é•¿</li><li>Accept-Encodingï¼šå®¢æˆ·ç«¯æ”¯æŒçš„æ–‡ä»¶å‹ç¼©æ ¼å¼</li><li>Acceptï¼šæ”¯æŒè¿”å›çš„æ–‡ä»¶æ ¼å¼</li><li>User-Agentï¼šä»£ç†å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æµè§ˆå™¨çš„ä¿¡æ¯å“åº”ï¼š</li><li>Content-Typeï¼šå“åº”ä½“çš„æ•°æ®ç±»å‹</li><li>Access-Control-Allow-Originï¼šæ˜¯å¦å…è®¸è·¨åŸŸ</li><li>Keep-Aliveï¼šä¿æŒ tcp è¿æ¥çš„æ—¶é•¿</li></ul><h3 id="data-transform" tabindex="-1">4.2. æ•°æ®ä¼ è¾“ <a class="header-anchor" href="#data-transform" aria-label="Permalink to &quot;4.2. æ•°æ®ä¼ è¾“ {#data-transform}&quot;">â€‹</a></h3><p>å‰åç«¯é€šè¿‡ <code>HTTP</code> è¯·æ±‚é€šä¿¡ï¼Œå‰ç«¯ä¼ é€’å‚æ•°ç»™åç«¯ï¼ŒæŒ‰ç…§ä½ç½®çš„ä¸åŒåˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><code>URI</code> è·¯å¾„å‚æ•°ï¼Œå‚æ•°å†™åœ¨ <code>URI</code> åœ°å€ä¸­ï¼Œä¸€èˆ¬åˆ†ä¸º æŸ¥è¯¢å‚æ•° <code>query</code> ã€è·¯å¾„å‚æ•° <code>url param</code></li><li><code>body</code> å‚æ•°ï¼Œæ•°æ®å‚æ•°å†™åœ¨ <code>body</code> è¯·æ±‚ä½“ä¸­ï¼Œæœ‰å¤šç§æ•°æ®æ ¼å¼ï¼Œæ¯”å¦‚åƒ<code>JSONã€form-dataã€form-urlencodedã€xml</code>ï¼Œä¸€èˆ¬å¸¸è§çš„ä¹Ÿå°±æ˜¯ <code>JSONå’Œform-data</code> å±…å¤š</li></ul><p>å¤§å¤šæ•°å¼€å‘äººå‘˜æ˜¯é€šè¿‡è¯·æ±‚æ–¹å¼çš„ä¸åŒå»åŒºåˆ†ï¼Œæ¯”å¦‚<code>GET</code>ä¸èƒ½æ¥æ”¶<code>bodyå‚æ•°</code>ï¼Œè¿™ç§åŒºåˆ†æ˜¾ç„¶æ˜¯ä¸å‡†ç¡®çš„ã€‚</p><p>å› ä¸º<code>è·¯å¾„å‚æ•° url param </code>ä¸å±€é™äº <code>GET</code> è¯·æ±‚ï¼Œå…¶ä»–è¯·æ±‚æ–¹å¼ä¹Ÿèƒ½æ¥æ”¶è·¯å¾„å‚æ•°ã€‚å¹¶ä¸æ˜¯ä¸å…è®¸è¿™ç§ä¹¦å†™ä»£ç çš„æ–¹å¼ï¼Œåªæ˜¯ä¸ç¬¦åˆè§„èŒƒï¼Œæˆ‘ä»¬å†™çš„æ¥å£è¦å°½é‡ç¬¦åˆ <code>RESTful</code> è§„èŒƒã€‚</p><p>æš‚æ—¶ä½¿ç”¨ <code>express</code> å®ç°å‚æ•°ä¼ é€’ä¾‹å­ã€‚</p><hr><h4 id="_4-2-1-query-æŸ¥è¯¢å‚æ•°" tabindex="-1">4.2.1. query æŸ¥è¯¢å‚æ•° <a class="header-anchor" href="#_4-2-1-query-æŸ¥è¯¢å‚æ•°" aria-label="Permalink to &quot;4.2.1. query æŸ¥è¯¢å‚æ•°&quot;">â€‹</a></h4><p><code>URL</code> å <code>?</code> å­—ç¬¦åˆ†å‰²çš„å­—ç¬¦ä¸²ï¼Œä»¥ <code>key=value</code> å½¢å¼æˆå¯¹ï¼Œå¤šä¸ªå‚æ•°ç”¨ <code>&amp;</code> éš”å¼€</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/query</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">query</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">query</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>æ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><p><img src="`+E+'" alt=""></p><p><img src="'+e+`" alt=""></p><h4 id="_4-2-2-param-è·¯å¾„å‚æ•°" tabindex="-1">4.2.2. param è·¯å¾„å‚æ•° <a class="header-anchor" href="#_4-2-2-param-è·¯å¾„å‚æ•°" aria-label="Permalink to &quot;4.2.2. param è·¯å¾„å‚æ•°&quot;">â€‹</a></h4><p><code>URL</code> çš„åŠ¨æ€å‚æ•°ï¼Œé€šè¿‡ <code>/:å‚æ•°</code> å£°æ˜</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/param/:id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">params</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>æ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><p><img src="`+d+'" alt=""></p><p><img src="'+u+`" alt=""></p><h4 id="_4-2-3-body-è¯·æ±‚ä½“-form-urlencode" tabindex="-1">4.2.3. body è¯·æ±‚ä½“ - <code>form-urlencode</code> <a class="header-anchor" href="#_4-2-3-body-è¯·æ±‚ä½“-form-urlencode" aria-label="Permalink to &quot;4.2.3. body è¯·æ±‚ä½“ - \`form-urlencode\`&quot;">â€‹</a></h4><p>å®é™…å°±æ˜¯æŠŠ <code>query</code> å‚æ•°ï¼Œä½¿ç”¨è¯·æ±‚ä½“è¿›è¡Œä¼ è¾“ï¼Œæ³¨æ„è¦ä½¿ç”¨ <code>URL encode</code> è½¬æ¢ä¸€å±‚ï¼Œåç«¯æ‰èƒ½æ­£ç¡®æ¥æ”¶ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/urlencode</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">body</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/urlencode</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">body</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><p><img src="`+m+'" alt=""></p><p><img src="'+r+`" alt=""></p><h4 id="_4-2-4-body-è¯·æ±‚ä½“-json" tabindex="-1">4.2.4. body è¯·æ±‚ä½“ - <code>JSON</code> <a class="header-anchor" href="#_4-2-4-body-è¯·æ±‚ä½“-json" aria-label="Permalink to &quot;4.2.4. body è¯·æ±‚ä½“ - \`JSON\`&quot;">â€‹</a></h4><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">body</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>æ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><p><img src="`+C+'" alt=""></p><p><img src="'+c+`" alt=""></p><h4 id="_4-2-5-body-è¯·æ±‚ä½“-form-data" tabindex="-1">4.2.5. body è¯·æ±‚ä½“ - <code>form-data</code> <a class="header-anchor" href="#_4-2-5-body-è¯·æ±‚ä½“-form-data" aria-label="Permalink to &quot;4.2.5. body è¯·æ±‚ä½“ - \`form-data\`&quot;">â€‹</a></h4><p><code>form-data</code>ç±»å‹çš„å‚æ•°ï¼Œä¸€èˆ¬ç”¨äºæ–‡ä»¶ç±»å‹ä¼ è¾“</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/form-data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> upload</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">single</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cover</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// req.file è®°å½•äº†æ–‡ä»¶ä¸Šä¼ çš„ä¿¡æ¯</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// req.body è®°å½•äº†å…¶å®ƒæ™®é€šå‚æ•°ï¼ˆéæ–‡ä»¶ï¼‰çš„ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">file</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">body</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><p><img src="`+g+'" alt=""></p><p><img src="'+t+`" alt=""></p><h3 id="_4-3-restful-api-æ¥å£è§„èŒƒ" tabindex="-1">4.3. RESTFul api æ¥å£è§„èŒƒ <a class="header-anchor" href="#_4-3-restful-api-æ¥å£è§„èŒƒ" aria-label="Permalink to &quot;4.3. RESTFul api æ¥å£è§„èŒƒ&quot;">â€‹</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å…¨ç§°ï¼šRepresentational State Transfer =&gt; REST</p><p>ç›´è¯‘ä¸ºï¼šèµ„æºè¡¨ç¤ºå±‚çŠ¶æ€è½¬ç§»</p></div><p><code>REST</code> æ˜¯ <code>web</code> æœåŠ¡çš„ä¸€ç§æ¶æ„é£æ ¼ï¼Œä¸€ç§è®¾è®¡é£æ ¼ï¼Œè€Œä¸æ˜¯ä¸€ç§æŠ€æœ¯æ‰‹æ®µï¼Œ<span class="high-light">å†™ä»£ç ï¼Œé€šå¸¸è§„èŒƒå¤§äºçº¦æŸã€‚</span></p><p>ç¬¦åˆä»¥ä¸‹è¿™äº›ç‰¹ç‚¹ï¼Œå°±èƒ½è¢«ç§°ä¸º <code>RESTFul</code> é£æ ¼<code>api</code></p><ol><li>ç‰ˆæœ¬å·</li></ol><p>åœ¨è¯·æ±‚è·¯å¾„ä¸Šè¡¨æ˜è¯·æ±‚èµ„æºçš„ç‰ˆæœ¬ï¼Œèƒ½æœ‰æ•ˆè§£å†³å› ä¸ºå‡çº§ç³»ç»Ÿæ¥å£ä¸å…¼å®¹çš„é—®é¢˜ï¼Œé€šå¸¸ä¼šåœ¨ <code>URL</code> ä¸­ä¿ç•™æ—§ç‰ˆæœ¬ï¼ŒåŒæ—¶å…¼å®¹æ–°çš„ç‰ˆæœ¬</p><p>æ¯”å¦‚ï¼š<code>ã€GETã€‘/v1/user</code>ã€<code>ã€GETã€‘/v2/user</code></p><ol start="2"><li>èµ„æºè·¯å¾„</li></ol><p>è¯·æ±‚è·¯å¾„ä¼šè¢«è§†ä¸ºæœåŠ¡å™¨çš„ä¸€ç§èµ„æºï¼Œåœ¨è¯·æ±‚è·¯å¾„ <code>URL</code> ä¸­ï¼Œè§„å®šåªèƒ½åŒ…å«åè¯ï¼Œé€šè¿‡è¯·æ±‚æ–¹å¼åŒºåˆ†è¯·æ±‚çš„åŠ¨ä½œï¼Œå¤šä¸ªå•è¯çš„æƒ…å†µä¸‹ï¼Œéœ€è¦ä½¿ç”¨ä¸‹åˆ’çº¿ <code>_</code> åˆ’åˆ†ã€‚</p><p>æ¯”å¦‚ï¼š<code>ã€POSTã€‘/v1/user</code> æ–°å¢ç”¨æˆ·</p><ol start="3"><li>è¯·æ±‚æ–¹å¼</li></ol><p>é€šè¿‡è¯·æ±‚æ–¹å¼åŒºåˆ†æ­¤æ¬¡è¯·æ±‚çš„åŠ¨æœºï¼ŒåŠ¨ä½œå¯ä»¥åˆ’åˆ†ä¸ºå››ä¸ªå¤§ç±» <code>C R U D</code>ï¼Œå¯¹åº” <code>å¢æŸ¥æ”¹æŸ¥</code></p><ul><li>ã€GETã€‘ï¼šä»æœåŠ¡å™¨ä¸Šè·å–èµ„æº</li><li>ã€POSTã€‘ï¼šåœ¨æœåŠ¡å™¨åˆ›å»ºæ–°çš„èµ„æº</li><li>ã€PUTã€‘ï¼šä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œå¹¶è¿”å›æ•´ä¸ªä¿®æ”¹åçš„èµ„æº</li><li>ã€DELETEã€‘ï¼šåˆ é™¤æœåŠ¡å™¨ä¸Šçš„èµ„æº</li></ul><ol start="4"><li>æŸ¥è¯¢å‚æ•°</li></ol><p>æ¥å£åº”è¯¥è¦æ¥æ”¶å‚æ•°ï¼Œè¿‡æ»¤è¿”å›çš„ç»“æœ</p><p>æ¯”å¦‚åˆ†é¡µï¼š<code>ã€GETã€‘/v1/api/user?page={num}&amp;size={num}</code></p><ol start="5"><li>çŠ¶æ€ç </li></ol><p>ä½¿ç”¨åˆé€‚çš„çŠ¶æ€ç ï¼Œå¸¸è§„çš„ä¸šåŠ¡é”™è¯¯ï¼ˆè¡¨å•æ ¡éªŒä¸è¿‡ï¼‰ä¸åº”è¯¥ç›´æ¥æŠ›é”™è¿”å›å®¢æˆ·ç«¯ï¼Œåº”è¯¥åœ¨æ¥å£ç»“æœä¸­ï¼Œè¿”å›çŠ¶æ€ç  200ï¼Œå¹¶ä¸”è¿”å›æè¿°çš„é”™è¯¯ç±»å‹ï¼Œè¿”å›ä¸šåŠ¡çŠ¶æ€ç ã€‚å¦‚æœéä¸šåŠ¡é”™è¯¯ï¼Œå¯ç›´æ¥å“åº”é”™è¯¯ç»™å®¢æˆ·ç«¯ã€‚</p><p>å¸¸è§éä¸šåŠ¡é”™è¯¯çŠ¶æ€ç ï¼š</p><ul><li>200ï¼Œæ­£å¸¸è¿”å›</li><li>204ï¼Œå·²æ¥æ”¶å¤„ç†ï¼Œä½†æ— å®ä½“è¿”å›</li><li>401ï¼Œæœªç™»å½•ç”¨æˆ·</li><li>403ï¼Œæœªæˆæƒçš„èµ„æº</li><li>404ï¼Œæ‰¾ä¸åˆ°èµ„æºè·¯å¾„</li><li>500ï¼ŒæœåŠ¡å™¨ä»£ç å¼‚å¸¸</li><li>503ï¼ŒæœåŠ¡å™¨é”™è¯¯</li></ul><ol start="6"><li>å“åº”è§„èŒƒ</li></ol><p>æ¥å£åº”è¿”å›å°è£…ç»Ÿä¸€çš„ <code>JSON</code>æ ¼å¼çš„å“åº”ä½“ï¼ŒæˆåŠŸè¿”å›æ­£å¸¸æ•°æ®ï¼Œå¤±è´¥æ ¹æ®æ˜¯å¦ä¸ºä¸šåŠ¡é”™è¯¯è¿”å›çŠ¶æ€ç ã€é”™è¯¯ä¿¡æ¯ã€é”™è¯¯æ ‡è¯†ç­‰</p><p>æˆåŠŸè¿”å›ï¼š<code>{code: xxx}</code></p><p>ä¸šåŠ¡é”™è¯¯ï¼š<code>{message:&#39;xxxxx&#39;,failed:true}</code></p><p>éä¸šåŠ¡é”™è¯¯ï¼š<code>{statusCode:404,message:&#39;Not Found&#39;}</code></p><h2 id="_5-nest-ç®€å•çš„è·¯ç”±è®¿é—®" tabindex="-1">5. nest ç®€å•çš„è·¯ç”±è®¿é—® <a class="header-anchor" href="#_5-nest-ç®€å•çš„è·¯ç”±è®¿é—®" aria-label="Permalink to &quot;5. nest ç®€å•çš„è·¯ç”±è®¿é—®&quot;">â€‹</a></h2><p>æ­£å¼è¿›å…¥åˆ° <code>nest</code> åº”ç”¨çš„å­¦ä¹ ã€‚</p><h3 id="_5-1-åˆ›å»ºé¡¹ç›®" tabindex="-1">5.1. åˆ›å»ºé¡¹ç›® <a class="header-anchor" href="#_5-1-åˆ›å»ºé¡¹ç›®" aria-label="Permalink to &quot;5.1. åˆ›å»ºé¡¹ç›®&quot;">â€‹</a></h3><p>ä½¿ç”¨ <code>nest cli</code> å¯åˆ›å»ºä¸€ä¸ªæ¨¡æ¿é¡¹ç›®ï¼Œè¯¥æ¨¡æ¿é»˜è®¤æ”¯æŒ <code>typescript</code>ã€‚</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">nest</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">new</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">simple_route_control</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><code>main.ts</code>ä½œä¸ºç¨‹åºçš„å…¥å£æ–‡ä»¶ï¼Œä½¿ç”¨ <code>NestFactory</code> åˆ›å»º <code>nest</code> åº”ç”¨å®ä¾‹ã€‚</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-1mRfj" id="tab-anX6pzM" checked="checked"><label for="tab-anX6pzM">main.ts</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">bootstrap</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// NestFactoryä¼ é€’æ ¹æ¨¡å—ï¼Œå¹¶åˆ›å»ºå‡º \`Nest\` åº”ç”¨å®ä¾‹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">NestFactory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">AppModule</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// ç›‘å¬3000ç«¯å£</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å¯åŠ¨æœåŠ¡</span></span>
<span class="line"><span style="color:#82AAFF;">bootstrap</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div><p>æ ¸å¿ƒæ–‡ä»¶ç®€è¦æ¦‚è¿°ï¼š</p><ul><li><code>main</code>ï¼šåº”ç”¨ç¨‹åºçš„ä¸»å…¥å£æ–‡ä»¶ï¼Œä½¿ç”¨ <code>NestFactory</code> æ¥åˆ›å»º <code>nest</code> åº”ç”¨å®ä¾‹</li><li><code>*.controller.ts</code> ï¼šå¸¦æœ‰å•ä¸ªè·¯ç”±çš„æ§åˆ¶å™¨å®ä¾‹</li><li><code>*.module.ts</code>ï¼šæ¯ä¸ªåˆ‡å‰²çš„å­æ¨¡å—</li><li><code>*.service.ts</code>ï¼šå¸¦æœ‰å•ä¸ªæ–¹æ³•çš„åŸºæœ¬æœåŠ¡</li><li><code>app.module.ts</code>ï¼šæ¯ä¸ª <code>nest</code> åº”ç”¨éƒ½åº”è¯¥è‡³å°‘æœ‰ä¸€ä¸ªæ ¹æ¨¡å—</li></ul><h3 id="_5-2-è¿è¡Œç¨‹åº" tabindex="-1">5.2. è¿è¡Œç¨‹åº <a class="header-anchor" href="#_5-2-è¿è¡Œç¨‹åº" aria-label="Permalink to &quot;5.2. è¿è¡Œç¨‹åº&quot;">â€‹</a></h3><p>åœ¨ç»ˆç«¯ä½¿ç”¨å‘½ä»¤ <code>npm run start</code> å¯åŠ¨ç¨‹åºï¼Œåœ¨ç¨‹åºå¯åŠ¨ä¹‹åï¼Œé»˜è®¤ä¼šç›‘å¬ 3000 ç«¯å£ï¼Œåœ¨ <code>main.ts</code> ä¸­å¯ä»¥ä¿®æ”¹ç«¯å£ã€‚</p><p>åœ¨æµè§ˆå™¨è®¿é—® <code>http://localhost:3000</code></p><p><img src="`+h+`" alt=""></p><p>å¦‚ä¸Šå›¾ï¼ŒæˆåŠŸå¯åŠ¨å¹¶è®¿é—®äº† <code>nest</code> åº”ç”¨ã€‚</p><h2 id="_6-æ§åˆ¶å™¨" tabindex="-1">6. æ§åˆ¶å™¨ <a class="header-anchor" href="#_6-æ§åˆ¶å™¨" aria-label="Permalink to &quot;6. æ§åˆ¶å™¨&quot;">â€‹</a></h2><p>æ§åˆ¶å™¨è´Ÿè´£å¤„ç†ä¼ å…¥çš„ <code>HTTP</code> è¯·æ±‚å’Œå“åº”å®¢æˆ·ç«¯çš„å·¥ä½œï¼Œä¸»è¦å°±æ˜¯å¤„ç†ç”¨æˆ·å‘å‡ºçš„è¯·æ±‚å’Œå“åº”ã€‚</p><p>ä¸€ä¸ªå…·æœ‰ <code>@Controller</code> è£…é¥°å™¨çš„ç±»ï¼Œè¡¨ç¤ºè¿™ä¸ªç±»æ˜¯ä¸ªæ§åˆ¶å™¨ç±»ã€‚éœ€è¦åœ¨ <code>module</code> ä¸­å¯¼å…¥åˆ°å¯¹åº”çš„å…ƒæ•°æ®å‚æ•° <code>controllers</code> åˆ—è¡¨ä¸­ï¼Œè¿™æ · <code>nest</code> çš„ <code>IoCå®¹å™¨</code> æ‰ä¼šå®‰è£…è¯¥æ§åˆ¶å™¨çš„å®ä¾‹ï¼Œæ‰èƒ½è¢«ä½ çš„ <code>nest</code> åº”ç”¨æ‰€ä½¿ç”¨ã€‚</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-etjVN" id="tab-10WR5Ri" checked="checked"><label for="tab-10WR5Ri">controller</label><input type="radio" name="group-etjVN" id="tab-kDJ1EoK"><label for="tab-kDJ1EoK">module</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// è¢« @Controller è£…é¥°çš„ç±»ï¼Œæ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ç±»</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getHello</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getHello</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// éœ€è¦å°†æ§åˆ¶å™¨æ·»åŠ åˆ°åˆ—è¡¨é‡Œï¼Œnestå¯ä»¥åå°„å‡ºå“ªäº›æ§åˆ¶å™¨å¿…é¡»è¢«å®‰è£…</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ§åˆ¶å™¨å¤„ç† <code>HTTP</code> è¯·æ±‚å’Œå“åº”äº†ã€‚</p><ul><li>ä½¿ç”¨ä¸åŒè¯·æ±‚æ–¹æ³• <code>@Get @Post @Put @Delete</code> ç­‰åˆ†å‘å¤„ç†ä¸åŒç±»å‹çš„è¯·æ±‚</li><li>ä½¿ç”¨ <code>@Body()ã€@Query()ã€@Param()ã€@Request/@Reqã€@Response/@Resã€@Header()</code> ç­‰å±æ€§è£…é¥°å™¨å¤„ç†æ¥è‡ª <code>HTTP</code> è¯·æ±‚çš„å‚æ•°ã€è¯·æ±‚å¤´</li><li>ä½¿ç”¨ <code>@HttpCode()æ§åˆ¶å“åº”çŠ¶æ€ç ã€@Redirect()è·¯ç”±é‡å®šå‘</code> ç­‰æ–¹æ³•è£…é¥°å™¨å®Œæˆç‰¹å®šéœ€æ±‚</li></ul><h3 id="_6-1-è¯·æ±‚æ–¹æ³•" tabindex="-1">6.1. è¯·æ±‚æ–¹æ³• <a class="header-anchor" href="#_6-1-è¯·æ±‚æ–¹æ³•" aria-label="Permalink to &quot;6.1. è¯·æ±‚æ–¹æ³•&quot;">â€‹</a></h3><p>è¯·æ±‚æ–¹æ³•çš„å„ä¸ªè£…é¥°å™¨ä½¿ç”¨æ–¹å¼ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UserController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">userService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UserService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">findAll</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">create</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åˆ›å»ºç”¨æˆ·æˆåŠŸ</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Put</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">update</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ›´æ–°ç”¨æˆ·æˆåŠŸ</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Delete</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">delete</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åˆ é™¤ç”¨æˆ·æˆåŠŸ</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>è¯·æ±‚åŠå“åº”å¦‚ä¸‹å›¾ï¼š</p><p><img src="`+f+`" alt=""></p><h3 id="_6-2-å‚æ•°å¤„ç†" tabindex="-1">6.2. å‚æ•°å¤„ç† <a class="header-anchor" href="#_6-2-å‚æ•°å¤„ç†" aria-label="Permalink to &quot;6.2. å‚æ•°å¤„ç†&quot;">â€‹</a></h3><p>åœ¨<a href="#data-transform">ç¬¬å››ç«  <code>HTTP</code> åè®®</a>ä¸­ï¼Œ å·²ç»äº†è§£è¿‡è¯·æ±‚å‚æ•°å¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼š</p><ol><li><code>URI</code> è·¯å¾„å‚æ•°</li><li><code>Body</code> è¯·æ±‚ä½“å‚æ•°</li></ol><p>åœ¨ä¹‹å‰çš„ç« èŠ‚æ˜¯ç”± <code>express</code> å®Œæˆçš„è·ç¦»ï¼Œæœ¬èŠ‚ä¸­å°†ä¼šç”± <code>nest</code> é‡æ–°ä¸¾ä¾‹ã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>è¿™äº›æ–¹æ³•å®šä¹‰åœ¨æ§åˆ¶å™¨å†…ï¼Œåˆ†å‘å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç”±äº <code>nest</code> æ˜¯ç”± <code>expressjså’Œfastjs</code> å°è£…ï¼Œæ‰€ä»¥ <code>express</code> çš„ <code>requestã€response</code> åœ¨ <code>nest</code> ä¸­ä¹Ÿæ˜¯èƒ½å¤Ÿä½¿ç”¨çš„ï¼Œå¹¶ä¸”ä½¿ç”¨æ–¹æ³•æ²¡æœ‰å‘ç”Ÿå¤ªå¤§çš„æ”¹å˜ã€‚</p></div><h4 id="_6-2-1-query-æŸ¥è¯¢å‚æ•°" tabindex="-1">6.2.1. query æŸ¥è¯¢å‚æ•° <a class="header-anchor" href="#_6-2-1-query-æŸ¥è¯¢å‚æ•°" aria-label="Permalink to &quot;6.2.1. query æŸ¥è¯¢å‚æ•°&quot;">â€‹</a></h4><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Requestè£…é¥°å™¨ï¼Œç”¨æ¥è·å–requestçš„å‚æ•°ï¼Œå°±è·Ÿexpressçš„requestå‚æ•°ä¸€è‡´</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">findAll</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Request</span><span style="color:#BABED8;">() req) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">query</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Queryè£…é¥°å™¨ï¼Œç›´æ¥è§£æè·å–queryå‚æ•°ï¼Œæ— éœ€é€šè¿‡req.queryå»è·å–</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">findAll</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">() query) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">query</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è§£æå¹¶æå–å‚æ•°ï¼Œåœ¨è£…é¥°å™¨ä¼ å…¥å‚æ•°åç§°ï¼Œå³å¯æå–å‚æ•°</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">findAll</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) name) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><img src="`+y+`" alt=""></p><h4 id="_6-2-2-param-è·¯å¾„å‚æ•°" tabindex="-1">6.2.2. param è·¯å¾„å‚æ•° <a class="header-anchor" href="#_6-2-2-param-è·¯å¾„å‚æ•°" aria-label="Permalink to &quot;6.2.2. param è·¯å¾„å‚æ•°&quot;">â€‹</a></h4><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Requestè£…é¥°å™¨ï¼ŒåŒæ ·è·Ÿexpressä¸€æ ·çš„è·å–æ–¹å¼ï¼Œåªéœ€è¦è®¾ç½®åŠ¨æ€å‚æ•°ï¼Œä¹Ÿå°±æ˜¯url params</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">:id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#82AAFF;">find</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Request</span><span style="color:#BABED8;">() req) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">params</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">id</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Paramè£…é¥°å™¨ï¼ŒåŒæ ·ä¹Ÿèƒ½è§£æå‚æ•°å¹¶æå–</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">:id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#82AAFF;">find</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Param</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) id) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">id</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å½“åŠ¨æ€å‚æ•°å’Œå­è·¯ç”±ä¸€èµ·å®šä¹‰æ—¶ä¼šä¼˜å…ˆåŒ¹é…ï¼Œæ¯”å¦‚è¯´ <code>/user/1</code> å’Œ <code>/user/detail</code>ï¼Œåè€…è¿›å…¥çš„æ˜¯åŠ¨æ€å‚æ•°çš„æ§åˆ¶å™¨æ–¹æ³•ã€‚</p></div><h4 id="_6-2-3-body-å‚æ•°-form-urlencode" tabindex="-1">6.2.3. body å‚æ•° - <code>form-urlencode</code> <a class="header-anchor" href="#_6-2-3-body-å‚æ•°-form-urlencode" aria-label="Permalink to &quot;6.2.3. body å‚æ•° - \`form-urlencode\`&quot;">â€‹</a></h4><p>å®é™…å°±æ˜¯æŠŠ <code>query</code> å‚æ•°ï¼Œä½¿ç”¨è¯·æ±‚ä½“è¿›è¡Œä¼ è¾“ï¼Œéœ€è¦æŒ‡å®šæ­¤æ¬¡è¯·æ±‚çš„è¯·æ±‚ç±»å‹ <code>Content-Type: application/x-www-form-urlencoded</code></p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åŒæ ·ä¹Ÿèƒ½é€šè¿‡ Request expressçš„æ–¹å¼å»å¤„ç†å‚æ•°</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">create</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Request</span><span style="color:#BABED8;">() req) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">body</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åŒæ—¶è¿˜æœ‰ Bodyè£…é¥°å™¨ ï¼Œå»è§£æå‚æ•°</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">create</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">() body) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">body</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åŒæ ·ä¹Ÿæœ‰ä¼ é€’å‚æ•°è¿›è£…é¥°å™¨ä¸­ï¼Œè§£æå‚æ•°å±æ€§</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">create</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) name) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="_6-2-4-body-å‚æ•°-json" tabindex="-1">6.2.4. body å‚æ•° - <code>JSON</code> <a class="header-anchor" href="#_6-2-4-body-å‚æ•°-json" aria-label="Permalink to &quot;6.2.4. body å‚æ•° - \`JSON\`&quot;">â€‹</a></h4><p>éœ€è¦æŒ‡å®šè¯·æ±‚å¤´çš„è¯·æ±‚ç±»å‹ <code>Content-Type: application/json</code></p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// é€šè¿‡express çš„ request å‚æ•°è·å–ä¼ å‚</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">create</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Request</span><span style="color:#BABED8;">() req) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">body</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åŒæ ·ä¹Ÿæœ‰è£…é¥°å™¨è·å–å‚æ•°ï¼Œè¿˜èƒ½ä¼ é€’å‚æ•°åç§°è§£æå‚æ•°</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">create</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) name) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_6-2-5-body-å‚æ•°-form-data" tabindex="-1">6.2.5. body å‚æ•° - <code>form-data</code> <a class="header-anchor" href="#_6-2-5-body-å‚æ•°-form-data" aria-label="Permalink to &quot;6.2.5. body å‚æ•° - \`form-data\`&quot;">â€‹</a></h4><p>å¤šæ•°ç”¨äºæ–‡ä»¶ç±»å‹ä¼ è¾“ï¼Œåœ¨è¿™ä¸€æ­¥ä¸­ï¼Œ<code>nest</code>éœ€è¦å¼€å¯<code>FileInterceptor</code>æ‹¦æˆªå™¨æ¥è§£æ<code>form-data</code>æ•°æ®ï¼Œä½¿ç”¨<code>@UseInterceptors</code>å¯ç”¨è£…é¥°å™¨ï¼Œç„¶åé€šè¿‡<code>@UploadedFiles</code>æ¥å–æ–‡ä»¶ï¼Œè€Œéæ–‡ä»¶çš„å†…å®¹ï¼Œä¾ç„¶é€šè¿‡<code>@Body</code>è·å–</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">file</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UseInterceptors</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">	</span><span style="color:#82AAFF;">AnyFilesInterceptor</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">		</span><span style="color:#F07178;">dest</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">uploads/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">	</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#82AAFF;">body</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">() body</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> @</span><span style="color:#82AAFF;">UploadedFiles</span><span style="color:#BABED8;">() files: Array</span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">Express</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">Multer</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">File</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">files</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		fileName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">body</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">fileName</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_6-2-6-header" tabindex="-1">6.2.6. header <a class="header-anchor" href="#_6-2-6-header" aria-label="Permalink to &quot;6.2.6. header&quot;">â€‹</a></h4><p>ç”¨äºè·å– <code>HTTP</code> è¯·æ±‚çš„è¯·æ±‚å¤´å‚æ•°</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#82AAFF;">findAll</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">() query</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> @</span><span style="color:#82AAFF;">Headers</span><span style="color:#BABED8;">() headers) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">query</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		cookie</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">headers</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">cookie</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_6-2-7-http-code" tabindex="-1">6.2.7. http code <a class="header-anchor" href="#_6-2-7-http-code" aria-label="Permalink to &quot;6.2.7. http code&quot;">â€‹</a></h4><p>è¿”å›æŒ‡å®šçš„ <code>HTTP</code> çŠ¶æ€ç </p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">HttpCode</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">204</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#82AAFF;">findAll</span><span style="color:#BABED8;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="`+v+`" alt=""></p><h4 id="_6-2-8-redirect" tabindex="-1">6.2.8. Redirect <a class="header-anchor" href="#_6-2-8-redirect" aria-label="Permalink to &quot;6.2.8. Redirect&quot;">â€‹</a></h4><p>é‡å®šå‘åˆ°æŒ‡å®šçš„ <code>URL</code> è·¯å¾„</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Redirect</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/user/test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">302</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#82AAFF;">redirect</span><span style="color:#BABED8;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#82AAFF;">test</span><span style="color:#BABED8;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">é‡å®šå‘test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="`+k+`" alt=""></p><h3 id="_6-3-å¤šå±‚çº§è·¯ç”±" tabindex="-1">6.3. å¤šå±‚çº§è·¯ç”± <a class="header-anchor" href="#_6-3-å¤šå±‚çº§è·¯ç”±" aria-label="Permalink to &quot;6.3. å¤šå±‚çº§è·¯ç”±&quot;">â€‹</a></h3><p>å½“ç¨‹åºä½“é‡è¾¾åˆ°ä¸€å®šè§„æ¨¡ä¹‹åï¼Œä¸€ä¸ªæ§åˆ¶å™¨å¯èƒ½ä¼šåŒ…å«åå‡ ä¸ªæ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨æ˜ å°„çš„è·¯ç”±è·¯å¾„å¹¶ä¸æ˜¯æ ¹æ®æ¨¡å—æˆ–å¼•ç”¨å…³ç³»å†³å®šçš„ï¼Œè€Œæ˜¯åœ¨ <code>@Controller()</code> ä¸­å®šä¹‰çš„</p><p>æ¯”å¦‚ <code>user</code> æ¨¡å—ï¼Œå¦‚æœå®ƒä¸‹é¢è¿˜æœ‰ <code>info</code> å­æ¨¡å—ï¼Œå°±éœ€è¦åœ¨å­æ¨¡å—å®šä¹‰è·¯å¾„ï¼š<code>@Controller(&#39;user/info&#39;)</code></p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// useræ¨¡å—æ§åˆ¶å™¨</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UserController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// user/info åµŒå¥—è·¯å¾„æ¨¡å—æ§åˆ¶å™¨</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user/info</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">InfoController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getNested</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Req</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åµŒå¥—è·¯å¾„</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      url</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="`+x+`" alt=""></p><h2 id="_7-æœåŠ¡" tabindex="-1">7. æœåŠ¡ <a class="header-anchor" href="#_7-æœåŠ¡" aria-label="Permalink to &quot;7. æœåŠ¡&quot;">â€‹</a></h2><p><code>Provider services</code> ç›´è¯‘è¿‡æ¥å°±æ˜¯<span class="high-light">â€œæœåŠ¡æä¾›è€…â€</span>ï¼Œæ˜¯ä¸€ä¸ªè¢« <code>@Injectable()</code> è£…é¥°å™¨è£…é¥°çš„ç±»ï¼Œåªè¦å…·æœ‰è¯¥è£…é¥°å™¨ï¼Œä»»ä½•ç±»éƒ½èƒ½æ˜¯æä¾›è€…ï¼Œé‡ç‚¹æ˜¯ä½ å¸Œæœ›æä¾›è€…äº¤ç”± <code>nest</code> åˆ›å»ºå’Œç®¡ç†ï¼ˆä¹Ÿå°±æ˜¯ <code>IoCå®¹å™¨</code>ï¼‰ã€‚</p><h3 id="_7-1-ä¾èµ–æ³¨å…¥" tabindex="-1">7.1. ä¾èµ–æ³¨å…¥ <a class="header-anchor" href="#_7-1-ä¾èµ–æ³¨å…¥" aria-label="Permalink to &quot;7.1. ä¾èµ–æ³¨å…¥&quot;">â€‹</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>åœ¨<a href="#ioc-di">ç¬¬äºŒç« è®¾è®¡æ¨¡å¼</a>ä¸­ï¼Œè®²è¿°äº†ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚è¿™é‡Œæ›´å¤šå…³æ³¨å®ƒä»¬åœ¨ <code>nest</code> ä¸­çš„åº”ç”¨ã€‚</p></div><p>åœ¨å¸¸è§çš„ MVC æ¡†æ¶ä¸­ï¼ŒåŸºæœ¬éƒ½å®ç°äº†<code>IoCå’ŒDI</code>ï¼Œä¾‹å¦‚<code>Spring</code>ã€<code>Nest</code>å‡æœ‰å®ç°çš„<code>IoC Container</code>ï¼Œç”±å®¹å™¨å»åˆå§‹åŒ–è¢«ä¾èµ–çš„å®ä¾‹ï¼Œç„¶åæ³¨å…¥åˆ°åº”ç”¨å±‚ä¸­ã€‚</p><p>åœ¨ <code>nest</code> ä¸­ï¼Œ<code>IoC å®¹å™¨</code>ä¼šå¯¹ <code>moduleç±»</code> è¿›è¡Œæ‰«æï¼Œå¦‚æœæœ‰æä¾›äº† <code>providers</code> è¿™ä¸€é€‰é¡¹çš„æä¾›è€…æœåŠ¡ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹è¿™ä¸ª <code>providers</code> çš„ä¾èµ–æœè¿›è¡Œå®ä¾‹åŒ–ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ° <code>controller</code> çš„æ„é€ å‡½æ•°ä¸­ï¼Œè®© <code>controller</code> é¿å…æ‰‹åŠ¨å®ä¾‹ä¾èµ–çš„æ“ä½œæ­¥éª¤ã€‚</p><p>åŸºç¡€ç‰ˆçŠ¶æ€ä»£ç ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// module æ‰«æprovidersä¸­çš„ä¾èµ–æœåŠ¡ï¼Œç„¶åè¿›è¡Œå®ä¾‹åŒ–æ³¨å…¥åˆ°controllerçš„æ„é€ å‡½æ•°ä¸­</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppService]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// controller</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä¾èµ–æ³¨å…¥åˆ°æ„é€ å‡½æ•°ä¸­</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ä¸Šé¢ä»£ç åœ¨ <code>nest</code> åº”ç”¨å¸¸è§çš„æ³¨å†Œæä¾›è€…çš„ä¾‹å­ï¼Œç°åœ¨è®©æˆ‘ä»¬é€æ­¥é€€åŒ–ï¼Œå°†å„ç§å†™æ³•å®Œæ•´å±•ç¤º</p><ol><li><p>å®Œæ•´å†™æ³•</p><p>å¯¹è±¡å½¢å¼ï¼Œæ˜ç¡®æ ‡è®° <code>provide: MockService</code> å’Œ <code>useClass: MockService</code> å…³è”åœ¨ä¸€èµ·ï¼Œå¦‚æœ <code>token</code> å’Œ <code>class</code> ä¸ºåŒä¸€ä¸ªæœåŠ¡æä¾›è€…ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ç”¨ç®€å†™æ¨¡å¼</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    AppService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">provide</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> MockService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">useClass</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> MockService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li><li><p>è‡ªå®šä¹‰æœåŠ¡æä¾›è€…</p><p>ä½¿ç”¨è‡ªå®šä¹‰ <code>value</code>ï¼Œæ­¤æ—¶ <code>MockService</code> å”¯ä¸€çš„æ„ä¹‰å°±æ˜¯æä¾›äº† <code>token</code>ï¼Œå®é™…æä¾›çš„æ˜¯ <code>value</code>ï¼Œåœ¨ <code>controller</code> ä¸­ç›´æ¥ä½¿ç”¨æ³¨å…¥çš„ <code>value</code> å€¼</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> value </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom providers value</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    AppService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 3.è‡ªå®šä¹‰æä¾›è€…çš„å€¼ï¼Œä¸å•å•é™åˆ¶äºclassï¼Œå¯ä»¥æ˜¯ä»»æ„JavaScriptçš„ç±»å‹çš„å€¼</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">provide</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> MockService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">useValue</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> value</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// controller</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">mockService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MockService</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mock</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getMock</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">mockService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><img src="`+T+`" alt=""></p></li><li><p>ç”¨éç±»ä½œä¸º <code>token</code></p><p>åœ¨ç¬¬äºŒç‚¹å®é™…ä¸Šçš„ <code>class</code> ä»…ä»…ä½œä¸º <code>token</code> çš„æä¾›è€…ï¼Œæ— å®é™…æ„ä¹‰ï¼Œ<code>token</code> å¯ä»¥ä½¿ç”¨å…¶ä»–çš„å€¼ï¼Œå¯ä»¥æ˜¯ <code>string|symbol|interface|Abstract|Function|class</code>ã€‚</p><blockquote><p>æ³¨æ„ï¼Œä¸€æ—¦ä½¿ç”¨äº†è‡ªå®š <code>token</code>ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨ <code>@Inject()</code> è£…é¥°å™¨æ³¨å…¥åˆ°æŒ‡å®šçš„æ§åˆ¶å™¨</p></blockquote><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> value </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom providers inject mock value</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    AppService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 4.è‡ªå®šä¹‰æä¾›è€…çš„å€¼ï¼Œtokenå¯ä»¥æ˜¯string|symbol|interface|Abstract|Function|class</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">provide</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">MOCK_SERVICE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">useValue</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> value</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// controller</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æŒ‡å®šè‡ªå®šä¹‰tokenæ³¨å…¥åˆ°æ§åˆ¶å™¨ä¸­</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Inject</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">MOCK_SERVICE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">mockService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mock</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getMock</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">mockService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><img src="`+P+`" alt=""></p></li><li><p>åŠ¨æ€å‡½æ•°</p><p>ä½¿ç”¨åŠ¨æ€å‡½æ•°è¿”å›æ³¨å…¥å€¼ï¼Œ<code>useFactory</code>å¯ä»¥æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å·¥å‚å‡½æ•°</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> value </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom providers inject mock value</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    AppService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 5.ä½¿ç”¨åŠ¨æ€å‡½æ•°è¿”å›æœåŠ¡æä¾›è€…</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">provide</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">MOCK_SERVICE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#82AAFF;">useFactory</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> value </span><span style="color:#676E95;font-style:italic;">// ç”šè‡³å¯ä»¥æ˜¯å¼‚æ­¥çš„ async ()=&gt; await value</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// controller</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æŒ‡å®šè‡ªå®šä¹‰tokenæ³¨å…¥åˆ°æ§åˆ¶å™¨ä¸­</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Inject</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">MOCK_SERVICE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">mockService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mock</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getMock</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">mockService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></li></ol><p>é€šè¿‡æ‹†è§£é€€åŒ–ï¼Œèƒ½æ›´å¥½ç†è§£ <code>IoC/DI</code> æ˜¯å¦‚ä½•åœ¨ <code>nest</code> åº”ç”¨ä¸­å·¥ä½œçš„</p><p><img src="`+w+`" alt=""></p><h3 id="_7-2-ä½œç”¨åŸŸ" tabindex="-1">7.2. ä½œç”¨åŸŸ <a class="header-anchor" href="#_7-2-ä½œç”¨åŸŸ" aria-label="Permalink to &quot;7.2. ä½œç”¨åŸŸ&quot;">â€‹</a></h3><p><code>nest</code> åº”ç”¨ï¼Œ<code>Providers</code> æœåŠ¡æä¾›è€…é»˜è®¤æ˜¯å•ä¾‹æ¨¡å¼ï¼Œè¿™æ„å‘³ç€åœ¨æ•´ä¸ª<code>nest</code> åº”ç”¨ä¸­ï¼Œ<code>Providers</code> åªä¼šè¢«å®ä¾‹ä¸€æ¬¡ï¼Œæ‰€æœ‰çš„è¯·æ±‚å…±äº«ç›¸åŒçš„ <code>service</code> æœåŠ¡å®ä¾‹ã€‚</p><p>è¿™ç§è®¾è®¡å¯ä»¥æ›´å¥½æé«˜æ€§èƒ½ï¼Œå› ä¸ºå‡å°‘äº† <code>service</code> æœåŠ¡çš„å®åŠ›åŒ–æ¬¡æ•°ã€‚</p><p>ä½†è¿™ç§æ¨¡å¼ï¼Œæ— æ³•å®ç°ä¸€äº›ç‰¹å®šçš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸ºæ¯ä¸ªè¯·æ±‚æä¾›ä¸€ä¸ªæ–°çš„ <code>service</code> æœåŠ¡å®ä¾‹ï¼Œå°±éœ€è¦é€šè¿‡ <code>nest</code> çš„ä¸€äº›å…¶ä»–æ–¹æ³•æ¥å»¶ä¼¸å…¶ä½œç”¨åŸŸã€‚</p><ul><li>DEFAULTï¼šé»˜è®¤ä½œç”¨åŸŸï¼Œæ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸåªä¼šå®ä¾‹åŒ–ä¸€æ¬¡ï¼Œ<span class="high-light">æ¯æ¬¡è·å–çš„éƒ½æ˜¯åˆæ¬¡å®ä¾‹çš„å®ä¾‹</span>ã€‚</li><li>REQUESTï¼šè¯·æ±‚ä½œç”¨åŸŸï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šè¿›è¡Œä¸€æ¬¡å®ä¾‹åŒ–ï¼Œæ¯”å¦‚è·å–ç”¨æˆ·æ›´æ–°çš„ <code>TOKEN</code> å‡­è¯ï¼Œæˆ‘ä»¬éœ€è¦ä»å†…å­˜ä¸­è·å–æœ€æ–°çš„æ•°æ®è¿”å›ã€‚</li><li>TRANSIENtï¼šç¬æ€ä½œç”¨åŸŸï¼Œæ¯ä¸€ä¸ªä½¿ç”¨ <code>Providers</code> çš„æ¨¡å—éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å®ä¾‹ï¼ŒæœåŠ¡éš”ç¦»å‘ç”Ÿåœ¨äº†æ¨¡å—å±‚é¢ã€‚</li></ul><p>æ¥ä¸‹æ¥ç”¨åŒä¸€ä¸ªä¾‹å­è¯´æ˜ä¸‹è¿™ä¸‰ä¸ªä½œç”¨åŸŸçš„åŒºåˆ«ï¼Œæ·»åŠ ä¸¤ä¸ªæ§åˆ¶å™¨<code>appã€user</code>ï¼Œåˆ†åˆ«è¯»ã€å†™<code>service</code>çš„å±æ€§ã€‚</p><h4 id="_7-2-1-default" tabindex="-1">7.2.1. DEFAULT <a class="header-anchor" href="#_7-2-1-default" aria-label="Permalink to &quot;7.2.1. DEFAULT&quot;">â€‹</a></h4><p>æ•´ä¸ªåº”ç”¨å‘¨æœŸå†…åªä¼šå®ä¾‹åŒ–ä¸€æ¬¡ï¼Œæ‰€æœ‰æ¨¡å—å…±äº«è¿™äº›æœåŠ¡ã€‚</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-obBA4" id="tab-G5IgP88" checked="checked"><label for="tab-G5IgP88">app.servcer</label><input type="radio" name="group-obBA4" id="tab-BCoTZK-"><label for="tab-BCoTZK-">app.controller</label><input type="radio" name="group-obBA4" id="tab-PUXKXYh"><label for="tab-PUXKXYh">user.controller</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">scopeA</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">set</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">A</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">scopeA</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">get</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">A</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">scopeA</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">set</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">setString</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">str</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#BABED8;font-style:italic;">str</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">str</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getString</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UserController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">set</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">setString</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">str</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#BABED8;font-style:italic;">str</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">str</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getString</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></div></div><p>ä»éšä¾¿ä¸€ä¸ªä¿®æ”¹çš„æ¥å£ï¼Œå‘é€è¯·æ±‚ä¿®æ”¹æœåŠ¡ä¸­çš„ <code>scopeA</code> çš„å€¼ï¼Œç„¶åå†ä¾æ¬¡å»è®¿é—® <code>scopeA</code> çš„å€¼ï¼Œå‘ç°æ¯ä¸ªæ¥å£è¿”å›çš„å€¼éƒ½æ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥çœ‹å‡º<span class="high-light">é»˜è®¤å•ä¾‹æ¨¡å¼</span>æ˜¯å…±äº«æ¨¡å—æœåŠ¡çš„ã€‚</p><p><img src="`+q+`" alt=""></p><h4 id="_7-2-2-request" tabindex="-1">7.2.2. REQUEST <a class="header-anchor" href="#_7-2-2-request" aria-label="Permalink to &quot;7.2.2. REQUEST&quot;">â€‹</a></h4><p>å°†<code>service</code>æœåŠ¡çš„ä½œç”¨åŸŸç¨ä½œä¿®æ”¹ï¼Œè®¾ç½®ä¸º<code>REQUEST</code>ï¼Œå…¶ä»–ä¸åšä»»ä½•ä¿®æ”¹</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-FGPA4" id="tab-MksQMOD" checked="checked"><label for="tab-MksQMOD">app.servcer</label><input type="radio" name="group-FGPA4" id="tab-7-aBLmn"><label for="tab-7-aBLmn">app.controller</label><input type="radio" name="group-FGPA4" id="tab-CoEZEn7"><label for="tab-CoEZEn7">user.controller</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#F07178;">scope</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Scope</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">REQUEST </span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">scopeA</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">set</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">A</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">scopeA</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">get</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">A</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">scopeA</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">set</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">setString</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">str</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#BABED8;font-style:italic;">str</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">str</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getString</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UserController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">set</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">setString</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">str</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#BABED8;font-style:italic;">str</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">str</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getString</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></div></div><p>æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå°†<code>scopeA</code>å†™å…¥å…¶ä»–å€¼ï¼Œç„¶åå†æ¥å…¥è¯·æ±‚ï¼Œå‘ç°æ¯æ¬¡è¯·æ±‚éƒ½ä¼šè·å–åˆ°çš„éƒ½æ˜¯<code>scopeA</code>çš„é»˜è®¤å€¼ï¼Œè¯´æ˜æ¯æ¬¡æœåŠ¡å®ä¾‹éš”ç¦»åœ¨äº†è¯·æ±‚é˜¶æ®µï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šé‡æ–°å®ä¾‹åŒ–æœåŠ¡ã€‚</p><p>é‡æ–°å¯åŠ¨é¡¹ç›®ï¼ŒæŒ‰ç…§ä¸Šä¸€æ­¥çš„é¡ºåºæ‰§è¡Œï¼Œç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img src="`+S+`" alt=""></p><h4 id="_7-2-3-transient" tabindex="-1">7.2.3. TRANSIENT <a class="header-anchor" href="#_7-2-3-transient" aria-label="Permalink to &quot;7.2.3. TRANSIENT&quot;">â€‹</a></h4><p>å°†<code>service</code>æœåŠ¡çš„ä½œç”¨åŸŸç¨ä½œä¿®æ”¹ï¼Œä¿®æ”¹ä¸º<code>TRANSIENT</code>ï¼Œå…¶ä»–ä¾æ—§ä¸å˜ã€‚</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-Beii7" id="tab-5AugSSF" checked="checked"><label for="tab-5AugSSF">app.servcer</label><input type="radio" name="group-Beii7" id="tab-22-vfWV"><label for="tab-22-vfWV">app.controller</label><input type="radio" name="group-Beii7" id="tab-pyWnKxv"><label for="tab-pyWnKxv">user.controller</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line diff remove"><span style="color:#BABED8;">  </span><span style="color:#F07178;">scope</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Scope</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">REQUEST </span></span>
<span class="line diff add"><span style="color:#BABED8;">  scope: Scope</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">TRANSIENT </span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">Â  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">scopeA</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">Â </span></span>
<span class="line"><span style="color:#BABED8;">Â  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">set</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">A</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">scopeA</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">Â  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">Â  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">get</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">A</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">Â  Â  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">scopeA</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">Â  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">set</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">setString</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">str</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#BABED8;font-style:italic;">str</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">str</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getString</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UserController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">set</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">setString</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">str</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#BABED8;font-style:italic;">str</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">str</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getString</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></div></div><p>é‡å¯é¡¹ç›®ï¼ŒæŒ‰ç…§æµç¨‹è¯·æ±‚ä¸€éï¼Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><p><img src="`+M+`" alt=""></p><p>å½“ <code>app</code> çš„è¯·æ±‚æˆåŠŸå†™äº† <code>scopeA</code> çš„å€¼ï¼Œç„¶å<code>user</code>å†å»è¯·æ±‚è·å– <code>scopeA</code> å€¼æ—¶ï¼Œåªæœ‰<code>app</code>è¯·æ±‚æ—¶æœ‰å€¼ï¼Œ<code>user</code>çš„è¯·æ±‚ä»€ä¹ˆéƒ½æ²¡æœ‰è·å–åˆ°ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´<span class="high-light">ç¬æ€ä½œç”¨åŸŸ</span>çš„æœåŠ¡å®ä¾‹ï¼Œæ˜¯ä»¥æ¨¡å—è¿›è¡Œéš”ç¦»ï¼Œ<code>app</code>æ¨¡å—çš„æœåŠ¡å®ä¾‹ï¼Œæ— æ³•ä¸<code>user</code>æ¨¡å—å…±äº«ã€‚</p><h3 id="_7-3-ä½œç”¨åŸŸé“¾" tabindex="-1">7.3. ä½œç”¨åŸŸé“¾ <a class="header-anchor" href="#_7-3-ä½œç”¨åŸŸé“¾" aria-label="Permalink to &quot;7.3. ä½œç”¨åŸŸé“¾&quot;">â€‹</a></h3><div class="info custom-block"><p class="custom-block-title"><span></span></p><p>â€œå¿…é¡»éå¸¸è°¨æ…åœ°ä½¿ç”¨è¯·æ±‚èŒƒå›´çš„æä¾›è€…â€œ â€”â€”ã€Šnest æ–‡æ¡£ã€‹</p></div><p><code>scope</code>ä½œç”¨åŸŸæ˜¯åœ¨æ³¨å…¥æ—¶è¿›è¡Œå†’æ³¡çš„ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚æœä½ çš„æ§åˆ¶å™¨ä¾èµ–äº <code>Providers</code> æœåŠ¡ï¼Œé‚£ä¹ˆæ„å‘³ç€ä½ çš„æ§åˆ¶å™¨ä¹Ÿæ˜¯å’Œ <code>Providers</code> ä½œç”¨åŸŸä¿æŒä¸€è‡´ã€‚</p><p><code>Controller</code> &lt;- <code>Provider</code> &lt;- <code>Repository</code>ï¼Œå…¶ä¸­çš„ <code>Repository</code> ä»ç„¶ä¿æŒæ˜¯å•ä¾‹çš„ï¼Œåªæœ‰æ§åˆ¶å™¨çš„è¯·æ±‚èŒƒå›´æ˜¯ä¾èµ–äºæä¾›è€…ã€‚</p><p>æä¾›è€…çš„èŒƒå›´ä¸ºé»˜è®¤çš„å•ä¾‹æ¨¡å¼ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">B</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">set</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">setString</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">str</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#BABED8;font-style:italic;">str</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">str</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">B</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">str</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">done</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getString</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">B</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">A</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>åœ¨æ§åˆ¶å™¨ä¸­å¢åŠ ä¸€ä¸ªç§æœ‰å­—æ®µï¼Œè¯·æ±‚è®¾ç½®æˆåŠŸåï¼Œå†æ¬¡è¯·æ±‚è·å–ç§æœ‰å­—æ®µçš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºäº†ç»“æœï¼Œæ§åˆ¶å™¨ä¹Ÿæ˜¯å•ä¾‹æ¨¡å¼ï¼ŒéªŒè¯æ§åˆ¶å™¨çš„ä½œç”¨åŸŸæ˜¯è·Ÿéšç€æä¾›è€…çš„ï¼Œå…¶ä»–çš„èŒƒå›´ä¹Ÿæ˜¯ä¸€æ ·</p><p><img src="`+O+`" alt=""></p><h2 id="_8-æ¨¡å—" tabindex="-1">8. æ¨¡å— <a class="header-anchor" href="#_8-æ¨¡å—" aria-label="Permalink to &quot;8. æ¨¡å—&quot;">â€‹</a></h2><p><code>Module</code> æä¾›äº†ä¸€ç§æ¨¡å—åŒ–æ–¹å¼æ¥ç»„ç»‡å’Œç®¡ç†ä½ çš„ <code>nest</code> ç¨‹åºå’Œä»£ç ã€‚</p><p>è¢« <code>@Module()</code> è£…é¥°å™¨è£…é¥°çš„ç±»ï¼Œå°±å…·æœ‰æ¨¡å—çš„ç‰¹å¾ï¼Œè§†ä¸ºä¸€ä¸ªæ¨¡å—ç±»ï¼Œè£…é¥°å™¨æ–¹æ³•å¯ä»¥ä¼ é€’æ„å»ºæ¨¡å—çš„å…ƒæ•°æ®<code>Metadata</code>ï¼Œæ¯”å¦‚<code>serviceæœåŠ¡</code>ã€<code>controlleræ§åˆ¶å™¨</code>ç­‰ã€‚</p><p>æ¯ä¸ª<code>nest</code>åº”ç”¨è‡³å°‘éœ€è¦ä¸€ä¸ªæ ¹æ¨¡å—ï¼Œæ ¹æ¨¡å—æ˜¯åº”ç”¨ç»„è£…çš„å…¥å£ï¼Œæ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥çœ‹åšæ˜¯ä½ åº”ç”¨ä¸­çš„å­åº”ç”¨ï¼Œå½“è¿™äº›å­åº”ç”¨ç»„åˆèµ·æ¥ï¼Œå°±å½¢æˆä¸€ä¸ªå®Œæ•´çš„ <code>nest</code> åº”ç”¨ç¨‹åºã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å—å¥½æ¯”â€œä¸€ä¸ªå°é—­çš„ç›’å­â€ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœä¸åœ¨<code>providers</code>å…ƒæ•°æ®ä¸­æ³¨å…¥æœåŠ¡ï¼Œæ˜¯æ— æ³•ä½¿ç”¨æœåŠ¡çš„ï¼Œå¹¶ä¸”ä¸å¯¼å‡ºæ¨¡å—ï¼ˆåœ¨<code>exports</code>æ³¨å…¥ï¼‰ä¹Ÿæ— æ³•æä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚</p><p>å› æ­¤ä½ å¯ä»¥å°†æŠŠâ€œåœ¨æ¨¡å—å¯¼å‡ºçš„æœåŠ¡â€å½“åšå…¬å…±æ¥å£æˆ–è€…<code>API</code>ã€‚</p><h3 id="_8-1-moduleè£…é¥°å™¨" tabindex="-1">8.1. <code>@Module</code>è£…é¥°å™¨ <a class="header-anchor" href="#_8-1-moduleè£…é¥°å™¨" aria-label="Permalink to &quot;8.1. \`@Module\`è£…é¥°å™¨&quot;">â€‹</a></h3><p>æ¨¡å—å°±åƒæ˜¯ä¸€ä¸ªç›’å­ï¼Œè¿™ä¸ªç›’å­æä¾›äº†ç‰¹å®šåŠŸèƒ½çš„å·¥å…·ï¼Œæ¯”å¦‚<code>providers</code>ã€<code>controllers</code>ã€<code>importså¯¼å…¥</code>ã€<code>exportså¯¼å‡º</code>ç­‰ï¼Œåœ¨æ•´ä¸ªç›’å­çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œç›’å­å†…ä¼šå…±äº«è¿™äº›å·¥å…·ã€‚</p><p>è£…é¥°å™¨æ¥æ”¶ä¸€ä¸ªå¯¹è±¡å‚æ•°ï¼Œç±»å‹æ˜¯<code>ModuleMetadata</code>æ¥å£ï¼Œå®ƒå…·æœ‰å››ä¸ªå±æ€§å­—æ®µï¼Œçš†æ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>importsï¼šå¯¼å…¥æ¥è‡ªå…¶ä»–æ¨¡å—çš„<code>providers</code>æœåŠ¡</li><li>exportsï¼šå¯¼å‡º<code>providers</code>ï¼Œå…¶ä»–æ¨¡å—å¯¼å…¥æ—¶ï¼Œåšåˆ°å…±äº«çš„ä½œç”¨</li><li>providersï¼šæ¨¡å—ä¸­æ‰€éœ€è¦çš„æ‰€æœ‰<code>service</code>åŠŸèƒ½ç±»ï¼Œæ•´ä¸ªæ¨¡å—å…±äº«ä½¿ç”¨</li><li>controllersï¼šæ¨¡å—å‡ºå…¥å£ï¼Œæ§åˆ¶å™¨</li></ul><p><code>nest</code> çš„ <code>IoCå®¹å™¨</code> ä¼šæ ¹æ®ä¼ å…¥çš„å…ƒæ•°æ®ï¼Œå‡†ç¡®è¯†åˆ«åˆ°ç»„ä»¶çš„ä¾èµ–å…³ç³»ï¼ˆæ³¨å…¥ä¸è¢«æ³¨å…¥çš„å…³ç³»ï¼‰ã€‚</p><h3 id="_8-2-å…±äº«æ¨¡å—" tabindex="-1">8.2. å…±äº«æ¨¡å— <a class="header-anchor" href="#_8-2-å…±äº«æ¨¡å—" aria-label="Permalink to &quot;8.2. å…±äº«æ¨¡å—&quot;">â€‹</a></h3><p>é€šè¿‡<code>exports</code>å¯¼å‡ºï¼Œå½“å‰æ¨¡å—çš„<code>providers/imports</code>ä¼šè¢«å¯¼å…¥å½“å‰æ¨¡å—çš„æ¨¡å—æ‰€å…±äº«ã€‚</p><h4 id="_8-2-1-å¯¼å‡ºæœåŠ¡" tabindex="-1">8.2.1. å¯¼å‡ºæœåŠ¡ <a class="header-anchor" href="#_8-2-1-å¯¼å‡ºæœåŠ¡" aria-label="Permalink to &quot;8.2.1. å¯¼å‡ºæœåŠ¡&quot;">â€‹</a></h4><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-AktiH" id="tab-LRp4cVc" checked="checked"><label for="tab-LRp4cVc">cat.module</label><input type="radio" name="group-AktiH" id="tab-hJ-lNx9"><label for="tab-hJ-lNx9">dog.module</label><input type="radio" name="group-AktiH" id="tab-76787Hz"><label for="tab-76787Hz">cat.service</label><input type="radio" name="group-AktiH" id="tab-ujwYRl7"><label for="tab-ujwYRl7">dog.service</label><input type="radio" name="group-AktiH" id="tab-xNMyBum"><label for="tab-xNMyBum">dog.controller</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatService]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [DogController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [DogService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatModule]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">type</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">service</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">setType</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">type</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`\${</span><span style="color:#BABED8;">type</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">service</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">getType</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">type</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">catService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getType</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">catService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getType</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dog</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">dogService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getTypeToDog</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">dogService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getType</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div></div><p><img src="`+R+`" alt="image-20230907170013372"></p><p>ä» <code>cat.module</code> ä¸­å¯¼å‡ºæœåŠ¡ï¼Œç„¶ååœ¨ <code>dog.module</code> ä¸­å¯¼å…¥ï¼Œå…ˆæ˜¯è¯·æ±‚äº†æ”¹å˜ <code>cat</code> æœåŠ¡çš„ç§æœ‰å˜é‡ï¼Œåä¸¤ä¸ªæ¨¡å—åˆ†åˆ«è·å–ï¼Œå‘ç°å€¼æ˜¯ä¸€è‡´çš„ï¼Œä¸¤ä¸ªæ¨¡å—å·²ç»å…±äº«äº†æœåŠ¡ã€‚</p><h4 id="business" tabindex="-1">8.2.2. ä¸­è½¬å¯¼å‡º <a class="header-anchor" href="#business" aria-label="Permalink to &quot;8.2.2. ä¸­è½¬å¯¼å‡º {#business}&quot;">â€‹</a></h4><p>æ¨¡å—å¯ä»¥ä½œä¸ºä¸­è½¬ç«™ï¼Œä½œä¸ºä¸€ä¸ªè½½ä½“å†å¯¼å‡ºå…¶å†…éƒ¨çš„æœåŠ¡ã€‚</p><p>æ–°å¢ä¸€ä¸ªä¸­è½¬æ¨¡å— <code>middle.module</code> å¹¶åœ¨è¿™ä¸ªæ¨¡å—å¯¼å…¥ <code>dog.module</code> ï¼Œè¿˜æ˜¯æŒ‰ç…§åˆšæ‰çš„é¡ºåºè®¿é—®ï¼Œåœ¨æœ€åæ–°å¢è®¿é—®ä¸­è½¬ç«™è·¯ç”±çš„æ­¥éª¤ã€‚</p><p>è¿™ç§å…³ç³»èµ·åˆ°ä¸­è½¬æ¨¡å—çš„ä½œç”¨ï¼Œè®©ä¸€äº›äº’ç›¸ä¾èµ–çš„å…³ç³»ï¼Œå˜ä¸ºæ‰å¹³çš„å…³ç³»ï¼Œå¤§æ¦‚å°±æ˜¯ <code>business</code> å±‚çš„æ¦‚å¿µã€‚</p><p>å°†ä»£ç ç¨ä½œä¿®æ”¹</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-aWKV0" id="tab-Dj-fmVT" checked="checked"><label for="tab-Dj-fmVT">dog.module</label><input type="radio" name="group-aWKV0" id="tab-L_KoCR_"><label for="tab-L_KoCR_">middle.module</label><input type="radio" name="group-aWKV0" id="tab-_KGgEm7"><label for="tab-_KGgEm7">app.module</label><input type="radio" name="group-aWKV0" id="tab-4IHH_4q"><label for="tab-4IHH_4q">app.controller</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [DogController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [DogService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [DogService]</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatModule]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [DogModule]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [DogModule]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MiddleModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatModule</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> MiddleModule]</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">dogService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">() </span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getHello</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">dogService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getType</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div></div><p>ç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img src="`+N+`" alt="image-20230910124039852"></p><h4 id="_8-2-3-å…¨å±€æ¨¡å—" tabindex="-1">8.2.3. å…¨å±€æ¨¡å— <a class="header-anchor" href="#_8-2-3-å…¨å±€æ¨¡å—" aria-label="Permalink to &quot;8.2.3. å…¨å±€æ¨¡å—&quot;">â€‹</a></h4><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Global</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [GlobalController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [GlobalService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [GlobalService]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">GlobalModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>@Global</code> è£…é¥°å™¨ä½¿æ¨¡å—æˆä¸ºå…¨å±€ä½œç”¨åŸŸã€‚ å…¨å±€æ¨¡å—åº”è¯¥åªæ³¨å†Œä¸€æ¬¡ï¼Œæœ€å¥½ç”±æ ¹æˆ–æ ¸å¿ƒæ¨¡å—æ³¨å†Œï¼Œæ¯”å¦‚ï¼šhelperï¼Œæ•°æ®åº“è¿æ¥ç­‰ç­‰ã€‚</p><h3 id="_8-3-å¾ªç¯ä¾èµ–" tabindex="-1">8.3. å¾ªç¯ä¾èµ– <a class="header-anchor" href="#_8-3-å¾ªç¯ä¾èµ–" aria-label="Permalink to &quot;8.3. å¾ªç¯ä¾èµ–&quot;">â€‹</a></h3><p>ä¸¤ä¸ªç±»äº’ç›¸å¼•ç”¨æ—¶ï¼Œå°±ä¼šå‡ºç°å¾ªç¯ä¾èµ–ï¼Œæ¯”å¦‚ <code>A</code> ç±»ä¾èµ–æ³¨å…¥äº† <code>B</code> ç±»ï¼Œ<code>B</code> ç±»ä¾èµ–æ³¨å…¥äº† <code>A</code> ç±»ï¼Œå°±ä¼šäº§ç”Ÿâ€œå¾ªç¯ä¾èµ–â€ã€‚</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-aMSYq" id="tab-hGnPCgp" checked="checked"><label for="tab-hGnPCgp">app.module</label><input type="radio" name="group-aMSYq" id="tab-8Rtq0X6"><label for="tab-8Rtq0X6">dog.service</label><input type="radio" name="group-aMSYq" id="tab-XQ9tEr9"><label for="tab-XQ9tEr9">cat.service</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppService</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> CatService</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> DogService]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">catService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">dogService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div></div><p>å¯åŠ¨é¡¹ç›®ï¼Œä¼šæŠ¥é”™</p><p><img src="`+j+`" alt=""></p><p>é”™è¯¯æç¤ºæ‰¾ä¸åˆ°ä¾èµ–ï¼Œå®é™…æ˜¯<code>IoCå®¹å™¨</code> åœ¨å®ä¾‹åŒ–ä¾èµ–æ—¶ï¼Œä¼šéå†æ‰€æœ‰çš„æœåŠ¡ï¼Œä»å®ƒä»¬çš„ä¾èµ–æ³¨å…¥çš„å±æ€§ï¼ˆä¾èµ–æ³¨å…¥çš„å‚æ•°æˆ–ä½¿ç”¨äº†<code>@Inject</code>è£…é¥°å™¨çš„å‚æ•°ï¼‰è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†ï¼Œä¾èµ–å½¢æˆäº†ä¸€é¢—æ ‘ï¼Œå®ƒä¼šä»å¶å­èŠ‚ç‚¹å¼€å§‹å®ä¾‹åŒ–æ•´æ£µæ ‘ã€‚é‡åˆ°å¾ªç¯ä¾èµ–æ—¶ï¼Œå› ä¸ºå¾ªç¯ä¾èµ–ä¹‹é—´æ— æ³•å½¢æˆçˆ¶å­èŠ‚ç‚¹å…³ç³»ï¼Œéå†å°±ä¼šé™·å…¥å¾ªç¯ã€‚</p><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œç¨‹åºè®¾è®¡å±‚é¢ä¸åº”è¯¥å‡ºç°å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼Œè¿™æ˜¯ä¸€ç§é”™è¯¯çš„è®¾è®¡æ–¹å¼ï¼Œåº”è¯¥è¦å°½é‡é¿å…ï¼Œä½†æ˜¯åœ¨é¿æ— å¯é¿çš„æƒ…å†µä¸‹ï¼Œ<code>nest</code> æä¾›äº†å‡ ç§æ–¹æ³•æ¥è§£å†³è¿™ç§ç³Ÿç³•çš„è®¾è®¡ã€‚</p><h4 id="_8-3-1-æœ€å°å¾ªç¯ä¾èµ–è§£å†³æ–¹æ¡ˆä¼ªä»£ç " tabindex="-1">8.3.1. æœ€å°å¾ªç¯ä¾èµ–è§£å†³æ–¹æ¡ˆä¼ªä»£ç  <a class="header-anchor" href="#_8-3-1-æœ€å°å¾ªç¯ä¾èµ–è§£å†³æ–¹æ¡ˆä¼ªä»£ç " aria-label="Permalink to &quot;8.3.1. æœ€å°å¾ªç¯ä¾èµ–è§£å†³æ–¹æ¡ˆä¼ªä»£ç &quot;">â€‹</a></h4><p><code>nest</code> é‡‡ç”¨çš„å‰å‘å¼•ç”¨æ˜¯å°†å¾ªç¯ä¾èµ–çš„åŒæ–¹éƒ½æ ‡è®°ä¸Š <code>forwardRef</code>ï¼Œä¹Ÿå½“åšå¶å­èŠ‚ç‚¹å¤„ç†ï¼Œä½†æ˜¯ä¸å¯¹å…¶è¿›è¡Œå®ä¾‹åŒ–ï¼Œè€Œæ˜¯è¿”å› <code>Object.create()</code> åˆ›å»ºçš„å¼•ç”¨å¯¹è±¡ã€‚</p><p>å½“é‡åˆ°äº†è¿™ä¸ªæ ‡è®°æ—¶ï¼Œå®ƒä»¬è°ƒç”¨æ„é€ å‡½æ•°åï¼Œä¼šç”¨<code>Object.create()</code> åˆ›å»ºçš„å¼•ç”¨å¯¹è±¡ï¼Œå»è¦†ç›–å…ˆå‰ç¬¬ä¸€æ­¥åˆ›å»ºçš„å¯¹è±¡ï¼Œè¿™æ ·å…ˆå‰æ³¨å…¥äº†ä¸å®Œæ•´å¯¹è±¡çš„åœ°æ–¹ä¹Ÿä¼šå˜å¾—å®Œæ•´ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">A</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">b</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">b</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">b</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">B</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">a</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">a</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">instanceA</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#F07178;">(</span><span style="color:#FFCB6B;">A</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">prototype</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">instanceB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#F07178;">(</span><span style="color:#FFCB6B;">B</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">prototype</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">assign</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">instanceA</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">A</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">instanceB</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">assign</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">instanceB</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">B</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">instanceA</span><span style="color:#F07178;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">instanceA</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">instanceB</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">main</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="_8-3-2-å‰å‘å¼•ç”¨" tabindex="-1">8.3.2. å‰å‘å¼•ç”¨ <a class="header-anchor" href="#_8-3-2-å‰å‘å¼•ç”¨" aria-label="Permalink to &quot;8.3.2. å‰å‘å¼•ç”¨&quot;">â€‹</a></h4><p>å…è®¸ <code>nest</code> å¼•ç”¨ç›®å‰å°šæœªè¢«å®šä¹‰çš„å¼•ç”¨ï¼Œå½“ä¸¤ä¸ªæœåŠ¡å¾ªç¯ä¾èµ–æ—¶ï¼Œä¾èµ–çš„åŒæ–¹éƒ½éœ€è¦ä½¿ç”¨ <code>forwardRef()</code> å’Œ <code>@Inject</code> åŒ…è£¹ï¼Œå¦åˆ™ <code>nest</code> ä¸ä¼šå®ä¾‹åŒ–å®ƒä»¬ï¼Œæ‰€æœ‰çš„åŸºæœ¬å…ƒæ•°æ®éƒ½ä¸å¯ç”¨ã€‚</p><p>å°†ç”±é—®é¢˜çš„ä»£ç ç¨ä½œä¿®æ”¹ï¼Œç»™å¾ªç¯ä¾èµ–çš„åŒæ–¹éƒ½åŠ ä¸Šæ ‡è®°</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-j_p9p" id="tab-yCuwRr5" checked="checked"><label for="tab-yCuwRr5">app.module</label><input type="radio" name="group-j_p9p" id="tab-EfK7Gpa"><label for="tab-EfK7Gpa">dog.service</label><input type="radio" name="group-j_p9p" id="tab-HmTmYn2"><label for="tab-HmTmYn2">cat.service</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppService</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> CatService</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> DogService]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span></span>
<span class="line diff add"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Inject</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">forwardRef</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> CatService)) </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">catService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span></span>
<span class="line diff add"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Inject</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">forwardRef</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> DogService)) </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">dogService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div></div><p>é‡æ–°å¯åŠ¨é¡¹ç›®ï¼Œæ­£å¸¸è¿è¡Œã€‚é€šè¿‡å‰å‘å¼•ç”¨çš„æ–¹å¼è§£å†³äº†å¾ªç¯ä¾èµ–ã€‚</p><h4 id="_8-3-3-æ¨¡å—å¼•ç”¨" tabindex="-1">8.3.3. æ¨¡å—å¼•ç”¨ <a class="header-anchor" href="#_8-3-3-æ¨¡å—å¼•ç”¨" aria-label="Permalink to &quot;8.3.3. æ¨¡å—å¼•ç”¨&quot;">â€‹</a></h4><p><code>nest</code> æä¾›äº† <code>ModuleRef</code> ç±»æ¥å¯¼èˆªç¨‹åºå†…éƒ¨çš„ä¾èµ–åˆ—è¡¨ï¼Œå¹¶ä½¿ç”¨å…¶æ³¨å…¥ä»¤ç‰Œä½œä¸ºæŸ¥æ‰¾çš„ <code>key</code> ã€‚</p><p>ç®€å•ç‚¹è¯´ï¼Œ<code>ModuleRef</code> æä¾›äº†å½“å‰æ¨¡å—çš„å¼•ç”¨ï¼Œé€šè¿‡å½“å‰æ¨¡å—å¼•ç”¨è·å–å·²å®ä¾‹åŒ–çš„æä¾›è€…ã€æ§åˆ¶å™¨ã€æ³¨å…¥çš„æ‹¦æˆªå™¨ã€ä¸­é—´ä»¶ç­‰ã€‚</p><p>å¦‚æœéœ€è¦å…¨å±€æœç´¢ä¾èµ–ï¼Œä¼ é€’ <code>{strict: false}</code> ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-V2Pkp" id="tab-tOXoxYp" checked="checked"><label for="tab-tOXoxYp">dog.service</label><input type="radio" name="group-V2Pkp" id="tab-TP8Tyf2"><label for="tab-TP8Tyf2">cat.service</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">catService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">moduleRef</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ModuleRef</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getService</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">catService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">moduleRef</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">CatService</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-focused-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">dogService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">moduleRef</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ModuleRef</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getService</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">dogService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">moduleRef</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">DogService</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> strict</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">) </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div><p>é¡¹ç›®æ— æŠ¥é”™ï¼Œè¯æ˜å¾ªç¯ä¾èµ–é—®é¢˜å¾—åˆ°è§£å†³ã€‚</p><blockquote><p>æ— æ³•ä½¿ç”¨<code>ModuleRef.get()</code>è·å–<span class="high-light">ç¬æ€ä½œç”¨åŸŸ</span>çš„æä¾›è€…ï¼Œå¦‚æœè¦è§£å†³ï¼Œ<code>nest</code> æä¾›äº†å¦å¤–çš„è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><ol><li><p>è§£å†³ get æ— æ³•è·å–ç¬æ€ä½œç”¨åŸŸ</p><p>åªéœ€è¦å°†<code>moduleRef.get</code>æ›¿æ¢ä¸º<code>moduleRef.resolve()</code>ï¼Œå³å¯è§£å†³é—®é¢˜ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-focused-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">dogService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">moduleRef</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ModuleRef</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">getService</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">dogService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">moduleRef</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">DogService</span><span style="color:#F07178;">) </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è¯¥æ–¹æ³•ä»è‡ªå·±çš„ <code>DIå®¹å™¨å­æ ‘</code> ä¸­è¿”å›æä¾›è€…çš„å”¯ä¸€å®ä¾‹ï¼Œæ¯ä¸ªå­æ ‘ä¸Šéƒ½æœ‰å”¯ä¸€çš„ä¸Šä¸‹æ–‡æ ‡è¯†ç¬¦ï¼Œå› æ­¤ï¼Œå¦‚æœä½ å¤šæ¬¡è°ƒç”¨ <code>resolver()</code> å°†å‘ç°è¿”å›çš„è¿™äº›å€¼éƒ½ä¸ç›¸ç­‰</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">catService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">moduleRef</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ModuleRef</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">getService</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">catService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#F07178;">([</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">moduleRef</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">CatService</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">moduleRef</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">CatService</span><span style="color:#F07178;">)])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">catService</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">catService</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">]) </span><span style="color:#676E95;font-style:italic;">// false</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å¦‚æœè¦è·¨å¤šä¸ª <code>resolve()</code> ç”Ÿæˆå•ä¾‹å…±äº«çš„æœåŠ¡ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯è®©å¤šæ¬¡è°ƒç”¨<code>resolve()</code>çš„è¿”å›å€¼ç›¸ç­‰ï¼Œä½ å¯ä»¥ä¼ é€’ä¸Šä¸‹æ–‡æ ‡è¯†ç¬¦ç»™è¯¥æ–¹æ³•ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚</p><blockquote><p>ä½¿ç”¨ <code>ContextIdFactory.create()</code> ç”Ÿæˆè¿”å›é€‚å½“çš„å”¯ä¸€æ ‡è¯†ç¬¦</p></blockquote><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">catService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">moduleRef</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ModuleRef</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">getService</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ–°å¢è·å– contextId çš„æ–¹æ³•</span></span>
<span class="line diff add"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">contextId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ContextIdFactory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#F07178;">() </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">catService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#F07178;">([</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">moduleRef</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">contextId</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">moduleRef</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">contextId</span><span style="color:#F07178;">)])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">catService</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">catService</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">]) </span><span style="color:#676E95;font-style:italic;">// true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li><li><p>è§£å†³ get æ— æ³•è·å–è¯·æ±‚ä½œç”¨åŸŸ</p><p>å°† <code>resolve()</code> æ›¿æ¢ä¸º <code>registerRequestByContextId()</code> æ–¹æ³•ï¼Œä¼ é€’è¯·æ±‚ä½œç”¨åŸŸçš„æä¾›è€… ã€å”¯ä¸€ä¸Šä¸‹æ–‡æ ‡è¯†ç¬¦ä½œä¸ºå‚æ•°</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-KIC5N" id="tab-14CIReD" checked="checked"><label for="tab-14CIReD">dog.service</label><input type="radio" name="group-KIC5N" id="tab-ot_ffNp"><label for="tab-ot_ffNp">cat.serviceè¯·æ±‚ä½œç”¨åŸŸ</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">catService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">moduleRef</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ModuleRef</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">getService</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">contextId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ContextIdFactory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">moduleRef</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">registerRequestByContextId</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">catService</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">contextId</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">scope</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Scope</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">REQUEST</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div></div></li></ol><h4 id="_8-3-4-åˆ†å±‚è®¾è®¡" tabindex="-1">8.3.4. åˆ†å±‚è®¾è®¡ <a class="header-anchor" href="#_8-3-4-åˆ†å±‚è®¾è®¡" aria-label="Permalink to &quot;8.3.4. åˆ†å±‚è®¾è®¡&quot;">â€‹</a></h4><p>ä¹Ÿå°±æ˜¯<a href="#business">business</a>çš„åˆ†å±‚æ¦‚å¿µï¼Œå°†å…±åŒçš„æœåŠ¡ç‰¹å¾æå–åˆ°ä¸€ä¸ªæ–°çš„æœåŠ¡æ¨¡å—ä¸­ï¼Œè¿™ä¸ªæ¨¡å—ä½¿å¾—å¾ªç¯ä¾èµ–çš„ä¸¤ä¸ªä¾èµ–ç±»çš„å…³ç³»å˜å¾—æ‰å¹³åŒ–ã€‚</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-v0pWn" id="tab-UjKsIau" checked="checked"><label for="tab-UjKsIau">profile.service-businesså¤„ç†å±‚</label><input type="radio" name="group-v0pWn" id="tab-GhecGba"><label for="tab-GhecGba">dog.module</label><input type="radio" name="group-v0pWn" id="tab-gHHFyfw"><label for="tab-gHHFyfw">cat.module</label><input type="radio" name="group-v0pWn" id="tab-h0tETW6"><label for="tab-h0tETW6">profile.module</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ProfileService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">catService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">dogService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">mergeProcess</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">catService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getType</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">dogService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getType</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [DogController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [DogService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [DogService]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DogModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatService]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatModule</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> DogModule]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [ProfileService]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ProfileModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><p>é€šè¿‡åˆå¹¶é‡å ä¸šåŠ¡ï¼Œæå‡åˆ°ä¸€ä¸ªäº’ä¸ç›¸å…³çš„ä¸­é—´å±‚ï¼ˆbusinessï¼‰ä¸­å¤„ç†ï¼Œé‡æ„äº†å¾ªç¯ä¾èµ–ï¼Œç±»ä¼¼ä¸‹å›¾çš„å˜åŒ–</p><p><img src="`+I+`" alt=""></p><h3 id="_8-4-åŠ¨æ€æ¨¡å—" tabindex="-1">8.4. åŠ¨æ€æ¨¡å— <a class="header-anchor" href="#_8-4-åŠ¨æ€æ¨¡å—" aria-label="Permalink to &quot;8.4. åŠ¨æ€æ¨¡å—&quot;">â€‹</a></h3><p>åœ¨æœ¬ç« ä¹‹å‰å­¦ä¹ çš„ä»£ç å®ä¾‹å…¨éƒ½ä½¿ç”¨äº†é™æ€æ¨¡å—ï¼Œæ¨¡å—å®šä¹‰äº†ä¸€äº›ç»„ä»¶ï¼ˆæœåŠ¡ã€æ§åˆ¶å™¨ï¼‰ï¼Œå®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ä½œä¸ºæ•´ä¸ª <code>nest</code> åº”ç”¨ç¨‹åºçš„æ¨¡å—åŒ–ã€‚ ç”±äºæ˜¯é™æ€æ¨¡å—ï¼Œæ‰€ä»¥æ¯æ¬¡ <code>import</code> éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬å¸Œæœ›å¯¼å…¥æ—¶ç»™æ¨¡å—ä¼ é€’ä¸€äº›å‚æ•°ï¼ŒåŠ¨æ€åœ°ç”Ÿæˆæ¨¡å—å†…å®¹ï¼Œé™æ€æ¨¡å—å°±æ— æ³•æ»¡è¶³éœ€æ±‚äº†ï¼Œå°±éœ€è¦åŠ¨æ€æ¨¡å—å¯¼å…¥ã€‚</p><p><code>Provider</code> æ˜¯å¯ä»¥é€šè¿‡ <code>useFactory</code> åŠ¨æ€åˆ›å»ºçš„ï¼Œ<code>Module</code> åŒæ ·ä¹Ÿå¯ä»¥åŠ¨æ€åˆ›å»ºã€‚</p><p>æ¯”å¦‚æ•°æ®åº“è¿æ¥æ¨¡å—ï¼Œæ¯ä¸€ä¸ª <code>nest</code> ç¨‹åºéƒ½æœ‰ä¸åŒçš„æ•°æ®åº“è¿æ¥å‚æ•°ï¼Œç”¨æˆ·åã€å¯†ç ã€ç«¯å£ã€æ•°æ®æ± è¿æ¥æ•°ç­‰ç­‰ï¼Œä½¿ç”¨åŠ¨æ€æ¨¡å—å¾ˆæ–¹ä¾¿çš„å°±åˆ›å»ºä¸åŒçš„æ¨¡å—æ³¨å…¥ã€‚å¸¸ç”¨çš„ä¾‹å­è¿˜æœ‰ <code>jwtã€redisã€ä¸Šä¼ çš„ossæœåŠ¡å•†ã€‚ã€‚</code> ä¹Ÿä¼šä½¿ç”¨åˆ°ï¼Œ<span class="high-light">åªè¦éœ€è¦æ ¹æ®å‚æ•°åˆ›å»ºçš„é…ç½®æ¨¡å—ï¼Œéƒ½å¯ä»¥ä½¿ç”¨åŠ¨æ€åˆ›å»ºã€‚</span></p><h4 id="_8-4-1-åˆ›å»ºåŠ¨æ€æ¨¡å—" tabindex="-1">8.4.1. åˆ›å»ºåŠ¨æ€æ¨¡å— <a class="header-anchor" href="#_8-4-1-åˆ›å»ºåŠ¨æ€æ¨¡å—" aria-label="Permalink to &quot;8.4.1. åˆ›å»ºåŠ¨æ€æ¨¡å—&quot;">â€‹</a></h4><p>æ³¨å†Œæ¨¡å—é€šå¸¸éœ€è¦ 3~4 ä¸ªå…ƒæ•°æ®ï¼Œåˆ†åˆ«æ˜¯<code>providersã€importsã€exportsã€controllers</code>ã€‚</p><blockquote><p>DynamicModule ç”±@nestjs/common åŒ…å¯¼å‡º</p></blockquote><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-8Eu8p" id="tab-HJJWZ2p" checked="checked"><label for="tab-HJJWZ2p">config.module</label><input type="radio" name="group-8Eu8p" id="tab-2r1mi9N"><label for="tab-2r1mi9N">config.controller</label><input type="radio" name="group-8Eu8p" id="tab-_SMNT84"><label for="tab-_SMNT84">config.service</label><input type="radio" name="group-8Eu8p" id="tab-RKqTf8m"><label for="tab-RKqTf8m">app.module</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">static</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">register</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DynamicModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åŠ¨æ€åˆ›å»º~ConfigModule</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      module</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ConfigModule</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      controllers</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#BABED8;">ConfigContrller</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      imports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      providers</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#BABED8;">ConfigService</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigContrller</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">test</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ConfigContrller</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æ³¨å†ŒåŠ¨æ€æ¨¡å—</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [ConfigModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">register</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{}</span><span style="color:#BABED8;">)]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><p>æˆ‘ä»¬éœ€è¦ç»™åŠ¨æ€å¯¼å‡ºçš„æ¨¡å—æ·»åŠ ä¸Šä¸€ä¸ª <code>register</code> æ³¨å†Œæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­éœ€è¦è¿”å›éœ€è¦æ³¨å†Œçš„æ¨¡å—ã€å…ƒæ•°æ®ã€‚</p><p>ä¸é™æ€æ³¨å†Œå¹¶æ— ä¸åŒï¼Œåªæ˜¯åœ¨æ³¨å†Œæ–¹æ³•ä¸­å¤šäº†ä¸ªéœ€è¦æ³¨å†Œçš„æ¨¡å—ï¼Œåœ¨æ§åˆ¶å°ä¸­åŒæ ·æ‰“å°å‡ºäº†å†…å®¹ï¼Œä»¥åŠè®¿é—®åŠ¨æ€æ¨¡å—å®šä¹‰çš„è·¯ç”±ä¹ŸæˆåŠŸè¿”å›å†…å®¹ï¼š</p><p><img src="`+_+'" alt="image-20230912225527276"></p><p><img src="'+L+`" alt="image-20230912230126698"></p><p>è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªæœ€åŸºæœ¬çš„åŠ¨æ€æ¨¡å—åˆ›å»ºã€‚</p><h4 id="_8-4-2-ä¼ é€’å‚æ•°" tabindex="-1">8.4.2. ä¼ é€’å‚æ•° <a class="header-anchor" href="#_8-4-2-ä¼ é€’å‚æ•°" aria-label="Permalink to &quot;8.4.2. ä¼ é€’å‚æ•°&quot;">â€‹</a></h4><p>æˆ‘ä»¬è¿˜èƒ½é€šè¿‡<code>register</code>æ³¨å†Œæ–¹æ³•ä¼ é€’å‚æ•°ï¼Œå¯ä»¥æ ¹æ®ä¼ é€’çš„å‚æ•°åŠ¨æ€åˆ›å»ºæ¨¡å—ã€‚æˆ‘ä»¬å¦‚ä½•ä»æ³¨å†Œæ–¹æ³•ä¸­å–å‡º <code>options</code> å¹¶ä½¿ç”¨å‘¢ï¼Ÿ</p><p>ç»è¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ <code>service</code> æœåŠ¡åœ¨ä¾èµ–æ³¨å…¥åæ˜¯è´¯ç©¿æ•´ä¸ªæ¨¡å—ï¼Œä¸”åˆå¯ä»¥è‡ªå®šä¹‰æ³¨å…¥æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½ä» <code>register</code> æ³¨å†Œæ–¹æ³•ä¸­å–å‡º <code>options</code> å‚æ•°ï¼Œå¹¶æ³¨å…¥åˆ°å…¶ä¸­ï¼Œè¿™æ ·æ•´ä¸ªæ¨¡å—éƒ½èƒ½ä½¿ç”¨ä¼ é€’çš„å‚æ•°äº†ã€‚</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-hHV3R" id="tab-bzX_4cz" checked="checked"><label for="tab-bzX_4cz">config.module è‡ªå®šä¹‰æ³¨å…¥æœåŠ¡æ•°æ®</label><input type="radio" name="group-hHV3R" id="tab-G8ckUUy"><label for="tab-G8ckUUy">config.controller</label><input type="radio" name="group-hHV3R" id="tab-VTZKiwQ"><label for="tab-VTZKiwQ">config.service</label><input type="radio" name="group-hHV3R" id="tab-P5puoKT"><label for="tab-P5puoKT">app.module</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">static</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">register</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">options</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DynamicModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åŠ¨æ€åˆ›å»º~ConfigModule</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      module</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ConfigModule</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      controllers</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#BABED8;">ConfigContrller</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      providers</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">{</span></span>
<span class="line diff add"><span style="color:#F07178;">          </span></span>
<span class="line diff add"><span style="color:#F07178;">          provide</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">CUSTOM_CONFIG</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">          useValue</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">options</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">ConfigService</span></span>
<span class="line"><span style="color:#F07178;">      ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigContrller</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">configService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#BABED8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">test</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line diff add"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">configService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getOpts</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">aaa</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Inject</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">CUSTOM_CONFIG</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">option</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Record</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#BABED8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getOpts</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line diff add"><span style="color:#F07178;">    </span></span>
<span class="line diff add"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">option</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">] </span></span>
<span class="line diff add"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æ³¨å†ŒåŠ¨æ€æ¨¡å—</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [ConfigModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">register</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">aaa</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><p>ç»“æœå¦‚ä¸‹å›¾æ˜¾ç¤º</p><p><img src="`+U+`" alt="image-20230912233509676"></p><h4 id="_8-4-4-builder-ç”ŸæˆåŠ¨æ€æ¨¡å—" tabindex="-1">8.4.4. builder ç”ŸæˆåŠ¨æ€æ¨¡å— <a class="header-anchor" href="#_8-4-4-builder-ç”ŸæˆåŠ¨æ€æ¨¡å—" aria-label="Permalink to &quot;8.4.4. builder ç”ŸæˆåŠ¨æ€æ¨¡å—&quot;">â€‹</a></h4><p>åœ¨ <code>nest</code> ä¸­ï¼Œä¸€èˆ¬å°†åˆ›å»ºåŠ¨æ€æ¨¡å—çš„é™æ€æ–¹æ³•å‘½åä¸º <code>register</code> ï¼Œä½† <code>nest</code> å¯¹æ­¤æ²¡æœ‰ç¡¬æ€§è§„å®šï¼Œæ¯”å¦‚ <code>nest</code> ä¸­å°±çº¦å®šäº† 3 ç§æ–¹æ³•åï¼Œä¸€èˆ¬æ–¹æ³•åä¸åŒï¼Œä»£è¡¨çš„å«ä¹‰ä¹Ÿä¸åŒï¼Œæ‰€åšçš„äº‹æƒ…ä¹Ÿä¸åŒï¼š</p><ul><li>registerï¼šä½¿ç”¨ç‰¹å®šçš„å‚æ•°é…ç½®æ¥åˆ›å»ºåŠ¨æ€æ¨¡å—ï¼Œä»…ä¾›è°ƒç”¨æ¨¡å—ä½¿ç”¨ï¼Œå¯ä»¥å¯¹ä»»æ„æ•°é‡æ¨¡å—æ‰§è¡Œåˆ›å»ºåŠ¨ä½œã€‚</li><li>forRootï¼šæœŸæœ›åªé…ç½®ä¸€æ¬¡å¹¶åœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨ï¼Œæ¯”å¦‚ <code>TypeOrmModule.forRoot()</code>ã€‚</li><li>forFeatureï¼šéœ€è¦ä¿®æ”¹ä¸€äº›ç‰¹å®šçš„å‚æ•°åˆ›å»ºçš„åŠ¨æ€æ¨¡å—ï¼Œä»¥ä¾›æ¨¡å—ä½¿ç”¨ï¼Œæ¯”å¦‚è¯¥æ¨¡å—æ˜¯å¦æ‹¥æœ‰æƒé™è®¿é—®æ•°æ®åº“ï¼Œ<code>TypeOrmModule.forFeature([NoteEntity])</code></li></ul><p>è¿™äº›æ–¹æ³•é€šå¸¸ä¹Ÿæœ‰å¯¹åº”çš„å¼‚æ­¥åˆ›å»ºæ–¹æ³•ï¼Œ<code>registerAsyncã€forRootAsyncã€forFeatureAsync</code>ï¼Œå®ƒä»¬çš„æ„æ€ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œä¹Ÿä½¿ç”¨ <code>nest</code> çš„ä¾èµ–æ³¨å…¥è¿›è¡Œé…ç½®ã€‚</p><p>æˆ‘ä»¬ä»¥ä¸Šé¢çš„å®ä¾‹(<code>ConfigModule</code>)ä¸ºä¾‹ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸º<code>Builder</code>åˆ›å»ºçš„åŠ¨æ€æ¨¡å—ã€‚</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-ghbvb" id="tab-vi3Oc2B" checked="checked"><label for="tab-vi3Oc2B">config.module-definition</label><input type="radio" name="group-ghbvb" id="tab-y9LlyTa"><label for="tab-y9LlyTa">config.module</label><input type="radio" name="group-ghbvb" id="tab--cvhiol"><label for="tab--cvhiol">config.controller</label><input type="radio" name="group-ghbvb" id="tab-rMBkzrD"><label for="tab-rMBkzrD">config.service</label><input type="radio" name="group-ghbvb" id="tab-Mb7FyN_"><label for="tab-Mb7FyN_">app.module</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ConfigurableModuleBuilder</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 1. åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºè®©\`ConfigModule\`æ¥æ¥æ”¶å‚æ•°çš„æ¥å£ã€‚</span></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigModuleOptions</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">aaa</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 2. ä½¿ç”¨\`Builder\`åˆ›å»º å·¥å‚å‡½æ•° å’Œ æœåŠ¡ç±»tokenã€‚</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> ConfigurableModuleClass</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> MODULE_OPTIONS_TOKEN </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ConfigurableModuleBuilder</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">ConfigModuleOptions</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [ConfigService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [ConfigService]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigModule</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigurableModuleClass</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigContrller</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">configService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">test</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">configService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getOpts</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">aaa</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">MODULE_OPTIONS_TOKEN</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./config.module-definition</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ³¨æ„ä¸€ä¸‹ï¼Œä¾èµ–æ³¨å…¥çš„ \`token\` æ˜¯ç”± \`Builder\` åˆ›å»ºè€Œæ¥çš„</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Inject</span><span style="color:#BABED8;">(MODULE_OPTIONS_TOKEN) </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">option</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Record</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getOpts</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">option</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ³¨å†ŒåŠ¨æ€æ¨¡å—</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    ConfigModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">register</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">aaa</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æˆ–è€…ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼åˆ›å»º</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ConfigModule.registerAsync({</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//   useFactory: () =&gt; {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//     return {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//       folder: &#39;./config&#39;,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//     }</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//   },</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//   inject: [...any extra dependencies...]</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// })</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></div></div><p>é‡æ–°è¿è¡Œé¡¹ç›®ï¼Œå¹¶ä¸”æŒ‰ç…§ä¹‹å‰çš„æ–¹å¼è®¿é—®ï¼Œç»“æœå’Œä¹‹å‰å¹¶æ— åŒºåˆ«ï¼Œè¯æ˜é…ç½®æˆåŠŸã€‚</p><p>è¿™ç§ <code>Builder</code> çš„æ–¹å¼æ­¥éª¤æ¯”æ‰‹åŠ¨ç¼–å†™æ³¨å†Œæ–¹æ³•çœäº†å¾ˆå¤šæ­¥éª¤ï¼Œåªéœ€è¦å‡ è¡Œä»£ç å³å¯åŠ¨æ€åˆ›å»ºæ¨¡å—ã€‚</p><h4 id="_8-4-5-è‡ªå®šä¹‰é”®" tabindex="-1">8.4.5. è‡ªå®šä¹‰é”® <a class="header-anchor" href="#_8-4-5-è‡ªå®šä¹‰é”®" aria-label="Permalink to &quot;8.4.5. è‡ªå®šä¹‰é”®&quot;">â€‹</a></h4><p><code>Builder</code> é»˜è®¤æä¾› <code>registerã€registerAsync</code> æ–¹æ³•ï¼Œè¦æƒ³ä½¿ç”¨ä¸åŒçš„æ–¹æ³•åç§°ï¼Œè¯·ä½¿ç”¨ <code>Builder</code> çš„é™æ€æ–¹æ³• <code>setClassMethodName(name:string)</code> ä¼ é€’åç§°ã€‚</p><p>ä¿®æ”¹ä¸‹ <code>config.module-definition.ts</code> æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ConfigurableModuleBuilder</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigModuleOptions</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">aaa</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> ConfigurableModuleClass</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> MODULE_OPTIONS_TOKEN </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ConfigurableModuleBuilder</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">ConfigModuleOptions</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setClassMethodName</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">forRoot</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>æ³¨å†ŒåŠ¨æ€æ¨¡å—çš„æ–¹å¼ä¹Ÿéœ€è¦ç¨ä½œä¿®æ”¹ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ³¨å†ŒåŠ¨æ€æ¨¡å—</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    ConfigModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forRoot</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">aaa</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æˆ–è€…ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼åˆ›å»º</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ConfigModule.forRootAsync({</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//   useFactory: () =&gt; {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//     return {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//       folder: &#39;./config&#39;,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//     }</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//   },</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//   inject: [...any extra dependencies...]</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// })</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_8-4-6-é¢å¤–é…ç½®" tabindex="-1">8.4.6. é¢å¤–é…ç½® <a class="header-anchor" href="#_8-4-6-é¢å¤–é…ç½®" aria-label="Permalink to &quot;8.4.6. é¢å¤–é…ç½®&quot;">â€‹</a></h4><p>åœ¨æŸç§æƒ…å†µä¸‹ï¼ŒåŠ¨æ€æ¨¡å—å¯èƒ½éœ€è¦é¢å¤–çš„ <code>options</code> æ¥ç¡®å®šå®ƒçš„è¡Œä¸ºåŒæ—¶ä¸åº”åŒ…å«åœ¨ <code>MODULE_OPTIONS_TOKEN</code> ä¸­ï¼Œæ¯”å¦‚è¯¥åŠ¨æ€æ¨¡å—æ˜¯å¦ä¸ºå…¨å±€æ¨¡å—ï¼Œå› ä¸ºè¿™äº›å‚æ•°ä¸è¯¥åŠ¨æ€æ¨¡å—ä¸­çš„æœåŠ¡æ— å…³ã€‚</p><p>å¯ä»¥ä½¿ç”¨ <code>Builder</code> çš„é™æ€æ–¹æ³• <code>setExtras</code> æ¥ä¼ é€’é¢å¤–çš„å‚æ•°ï¼Œç›®çš„æ˜¯å»é™¤ä¸å±äº <code>MODULE_OPTIONS_TOKEN</code> ï¼Œä½†æ˜¯åˆå¯¹æ„å»ºåŠ¨æ€æ¨¡å—æœ‰ç”¨çš„å±æ€§ã€‚</p><p>ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯é¢å¤–å‚æ•°çš„é”®å€¼å¯¹ï¼Œå€¼ä¸ºé¢å¤–å‚æ•°çš„é»˜è®¤å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä¸­åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ¨¡å—å®šä¹‰(<code>providersã€exports...</code>)ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯é¢å¤–å±æ€§(<code>extras</code>)å¯¹è±¡ï¼Œè¯¥å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¿®æ”¹åçš„æ¨¡å—å®šä¹‰ã€‚</p><p>å¦‚æœä¸éœ€è¦è‡ªå®šä¹‰æ¨¡å—å®šä¹‰ï¼Œå‡½æ•°è¿”å›å‚æ•°å³å¯ã€‚</p><p>ä¿®æ”¹ä¸‹ <code>config.module-definition.ts</code> æ–‡ä»¶ï¼Œæ”¹åŠ¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ConfigurableModuleBuilder</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigModuleOptions</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">aaa</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> ConfigurableModuleClass</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> MODULE_OPTIONS_TOKEN </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ConfigurableModuleBuilder</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">ConfigModuleOptions</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setExtras</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">isGlobal</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">},</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">definition</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">extras</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line diff add"><span style="color:#BABED8;">    </span></span>
<span class="line diff add"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">definition</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line diff add"><span style="color:#BABED8;">    </span><span style="color:#F07178;">global</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> extras</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">isGlobal </span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)) </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>å…¶ä¸­ <code>definition</code> æ˜¯æ¨¡å—å®šä¹‰ï¼Œ<code>extras</code> æ˜¯é¢å¤–å‚æ•°å¯¹è±¡</p><p>åœ¨æ³¨å†Œä½¿ç”¨è¯¥åŠ¨æ€æ¨¡å—æ—¶ï¼Œå¯ä»¥ä¼ å…¥é¢å¤–çš„å‚æ•°ï¼Œä¿®æ”¹ä¸‹<code>app.module</code>ï¼Œæ”¹åŠ¨å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;">@Module({</span></span>
<span class="line"><span style="color:#babed8;">  controllers: [AppController],</span></span>
<span class="line"><span style="color:#babed8;">  providers: [AppService],</span></span>
<span class="line"><span style="color:#babed8;">  // æ³¨å†ŒåŠ¨æ€æ¨¡å—</span></span>
<span class="line"><span style="color:#babed8;">  imports: [</span></span>
<span class="line"><span style="color:#babed8;">    ConfigModule.forRoot({ aaa: 1, isGlobal: true }),</span></span>
<span class="line"><span style="color:#babed8;">    // æˆ–è€…ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼åˆ›å»º</span></span>
<span class="line"><span style="color:#babed8;">    // ConfigModule.forRootAsync({</span></span>
<span class="line"><span style="color:#babed8;">    //   useFactory: () =&gt; {</span></span>
<span class="line"><span style="color:#babed8;">    //     return {</span></span>
<span class="line"><span style="color:#babed8;">    //       folder: &#39;./config&#39;,</span></span>
<span class="line"><span style="color:#babed8;">    //       isGlobal: true</span></span>
<span class="line"><span style="color:#babed8;">    //     }</span></span>
<span class="line"><span style="color:#babed8;">    //   },</span></span>
<span class="line"><span style="color:#babed8;">    //   inject: [...any extra dependencies...]</span></span>
<span class="line"><span style="color:#babed8;">    // })</span></span>
<span class="line"><span style="color:#babed8;">  ]</span></span>
<span class="line"><span style="color:#babed8;">})</span></span>
<span class="line"><span style="color:#babed8;">export class AppModule {}</span></span>
<span class="line"><span style="color:#babed8;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>æ³¨æ„ï¼šç”±äºè¯¥é¢å¤–é…ç½®çš„æ–¹å¼ï¼Œæ˜¯å°†é¢å¤–å‚æ•°ç”¨äºæ„å»ºåŠ¨æ€æ¨¡å—æ‰€ä½¿ç”¨ï¼Œä¸å‚ä¸ä¾èµ–æ³¨å…¥ï¼Œæ‰€ä»¥åœ¨ <code>service</code> æœåŠ¡ä¸­ï¼Œæ— æ³•è®¿é—®ä¼ é€’çš„é¢å¤–å±æ€§</p><h4 id="_8-4-7-æ‹“å±•æ³¨å†Œæ–¹æ³•" tabindex="-1">8.4.7. æ‹“å±•æ³¨å†Œæ–¹æ³• <a class="header-anchor" href="#_8-4-7-æ‹“å±•æ³¨å†Œæ–¹æ³•" aria-label="Permalink to &quot;8.4.7. æ‹“å±•æ³¨å†Œæ–¹æ³•&quot;">â€‹</a></h4><p>å¦‚æœéœ€è¦ï¼Œå¯ä»¥æ‹“å±• <code>Builder</code> è‡ªåŠ¨ç”Ÿæˆçš„é™æ€æ–¹æ³•å’Œå…¶å¯¹æ ‡çš„å¼‚æ­¥æ–¹æ³•ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">DynamicModule</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ConfigurableModuleClass</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">OPTIONS_TYPE</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ASYNC_OPTIONS_TYPE</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./config.module-definition</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ConfigService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./config.service</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [ConfigService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">exports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [ConfigService]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigModule</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ConfigurableModuleClass</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">static</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">register</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">options</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#BABED8;"> OPTIONS_TYPE</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DynamicModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">register</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">options</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">static</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">registerAsync</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">options</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#BABED8;"> ASYNC_OPTIONS_TYPE</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">DynamicModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">registerAsync</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">options</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>æ³¨æ„ï¼šéœ€è¦ä»æ¨¡å—å®šä¹‰(ä¹Ÿå°±æ˜¯<code>Builder</code>)ä¸­ï¼Œå¯¼å‡º<code>OPTIONS_TYPEã€ASYNC_OPTIONS_TYPE</code> ç±»å‹ä½¿ç”¨ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  ConfigurableModuleClass</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  MODULE_OPTIONS_TOKEN</span><span style="color:#89DDFF;">,</span></span>
<span class="line diff add"><span style="color:#BABED8;">  OPTIONS_TYPE</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line diff add"><span style="color:#BABED8;">  ASYNC_OPTIONS_TYPE </span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ConfigurableModuleBuilder</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">ConfigModuleOptions</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setExtras</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">isGlobal</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">},</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">definition</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">extras</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">definition</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">global</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> extras</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">isGlobal</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">))</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="_9-ç»„ä»¶" tabindex="-1">9. ç»„ä»¶ <a class="header-anchor" href="#_9-ç»„ä»¶" aria-label="Permalink to &quot;9. ç»„ä»¶&quot;">â€‹</a></h2><p><code>nest</code> ä¸­çš„ç»„ä»¶åŒ…å«äº†å‡ ç§ç±»å‹ï¼Œ<code>middlewareä¸­é—´ä»¶</code>ã€<code>pipeç®¡é“</code>ã€<code>interceptoræ‹¦æˆªå™¨</code>ã€<code>guardså®ˆå«</code>ã€<code>filterè¿‡æ»¤å™¨</code> ç­‰ã€‚</p><p>å®ƒä»¬åŸºæœ¬éƒ½æ˜¯åŸºäºåˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰å¯¹è¯·æ±‚ã€æ–¹æ³•çš„å¢å¼ºæ‰‹æ®µï¼Œè¿™äº›çš„åŒºåˆ«åœ¨äº<span class="high-light">ä½œç”¨ä¸åŒï¼Œæ‰§è¡Œçš„é¡ºåºä¸åŒã€‚</span></p><ul><li>ä¸­é—´ä»¶ï¼šè¯·æ±‚è¿›å…¥æ§åˆ¶å™¨ä¹‹å‰è°ƒç”¨çš„å‡½æ•°ï¼Œå®ƒå¯ä»¥è®¿é—®è¯·æ±‚ã€å“åº”å¯¹è±¡ï¼Œå¤šä¸ªä¸­é—´ä»¶æŒ‰ç…§å®šä¹‰é¡ºåºæ‰§è¡Œï¼Œä½¿ç”¨<code>next()</code>æ–¹æ³•æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</li><li>å®ˆå«ï¼šæ ¹æ®è¿è¡Œæ—¶å­˜åœ¨çš„æŸäº›æ¡ä»¶ï¼ˆå¦‚æƒé™ã€è§’è‰²ã€TOKEN ç­‰ï¼‰ç¡®å®šè·¯ç”±æ˜¯å¦å¤„ç†è¯·æ±‚ï¼Œå¸¸ç”¨äºè¯·æ±‚çš„æƒé™æ ¡éªŒã€‚</li><li>æ‹¦æˆªå™¨ï¼šæœ‰ä¸¤éƒ¨åˆ†æ‰§è¡Œæ—¶æœºï¼Œä¸€ä¸ªæ˜¯åœ¨è¿›å…¥æ§åˆ¶å™¨æ–¹æ³•ä¹‹å‰ï¼Œä¸€ä¸ªæ˜¯åœ¨ç¦»å¼€æ§åˆ¶å™¨æ–¹æ³•ä¹‹åï¼ˆæœ€åçš„å“åº”æ‹¦æˆªï¼‰ã€‚</li><li>ç®¡é“ï¼šæ•°æ®ä»ç®¡é“å£æµå…¥ï¼Œè¿›è¡Œå¤„ç†ä¹‹åä»ç®¡é“å°¾ç«¯æµå‡ºï¼Œç»å…¸çš„ç”¨æ³•å°±æ˜¯è½¬æ¢æ•°æ®æ ¼å¼å’Œè¿›è¡Œå‚æ•°æ ¡éªŒï¼Œåœ¨æŸä¸ªæ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼Œä½¿ç”¨ç®¡é“å‡½æ•°ï¼Œå³å¯è¢«è°ƒç”¨ã€‚</li><li>è¿‡æ»¤å™¨ï¼šè¿‡æ»¤å™¨æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„éƒ¨åˆ†ï¼Œä¸€èˆ¬æ˜¯ <code>nest</code> å†…ç½®çš„å¼‚å¸¸å±‚å¯¹ç¨‹åºä¸­æ‰€æœ‰æœªå¤„ç†çš„å¼‚å¸¸è¿›è¡Œæ•è·ã€‚</li></ul><h3 id="filter" tabindex="-1">9.1. filter å¼‚å¸¸è¿‡æ»¤å™¨ <a class="header-anchor" href="#filter" aria-label="Permalink to &quot;9.1. filter å¼‚å¸¸è¿‡æ»¤å™¨ {#filter}&quot;">â€‹</a></h3><p><code>nest</code> å†…ç½®çš„å¼‚å¸¸è´Ÿè´£å¤„ç†æ•´ä¸ªç¨‹åºä¸­æŠ›å‡ºçš„æ‰€æœ‰å¼‚å¸¸ï¼Œå†…ç½®å¼‚å¸¸ç±»åŸºæœ¬ç»§æ‰¿äº <code>HttpException</code>ï¼Œå½“æ•è·åˆ°å¯¹åº”çš„å¼‚å¸¸æ—¶ï¼Œä¼šæŠ›å‡ºå›ºå®šæ ¼å¼çš„å¼‚å¸¸ä¿¡æ¯ï¼š</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">message</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">error message</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">statusCode</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;">xx/</span><span style="color:#F78C6C;">5</span><span style="color:#BABED8;">xx...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>å½“ç¨‹åºæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸æ— æ³•è¢«è¯†åˆ«æ—¶ï¼ˆæ—¢ä¸æ˜¯ <code>HttpException</code> ä¹Ÿä¸æ˜¯å…¶å­ç±»çš„å¼‚å¸¸ï¼‰ï¼Œå°†ä¼šæ”¶åˆ°ä»¥ä¸‹å¼‚å¸¸å“åº”ï¼š</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">statusCode</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">500</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">message</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Internal server error</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>nest</code> æä¾›äº†åŸºç¡€çš„å¼‚å¸¸ç±»ï¼š</p><table><thead><tr><th>ç±»</th><th>å«ä¹‰</th><th>çŠ¶æ€ç </th></tr></thead><tbody><tr><td>BadRequestException</td><td>è¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚</td><td>400</td></tr><tr><td>UnauthorizedException</td><td>ç”¨æˆ·æœªæä¾›èº«ä»½éªŒè¯å‡­æ®ï¼Œæˆ–è€…æ²¡æœ‰é€šè¿‡èº«ä»½éªŒè¯</td><td>401</td></tr><tr><td>ForbiddenException</td><td>å®¢æˆ·ç«¯æ— æƒè®¿é—®å†…å®¹ã€‚</td><td>403</td></tr><tr><td>NotFoundException</td><td>æœåŠ¡å™¨ä¸Šæ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æº</td><td>404</td></tr><tr><td>NotAcceptableException</td><td>æœåŠ¡å™¨é€šçŸ¥å®¢æˆ·ç«¯æ²¡æœ‰èµ„æºç¬¦åˆæµè§ˆå™¨è¯·æ±‚çš„æ ‡å‡†ã€‚</td><td>406</td></tr><tr><td>RequestTimeoutException</td><td>è¯·æ±‚è¶…æ—¶</td><td>408</td></tr><tr><td>ConflictException</td><td>æœåŠ¡å™¨æ— æ³•å¤„ç†æµè§ˆå™¨çš„è¯·æ±‚ï¼Œå› ä¸ºä¸ç›¸å…³èµ„æºå­˜åœ¨å†²çªã€‚</td><td>409</td></tr><tr><td>GoneException</td><td>è¯·æ±‚çš„èµ„æºå°†æ¥å°†ä¸å†å¯ç”¨ã€‚</td><td>410</td></tr><tr><td>PayloadTooLargeException</td><td>è¯·æ±‚çš„è´Ÿè½½å¤§äºæœåŠ¡å™¨èƒ½å¤Ÿæˆ–æ„¿æ„å¤„ç†</td><td>413</td></tr><tr><td>UnsupportedMediaTypeException</td><td>è¯·æ±‚å·²è¢«æœåŠ¡å™¨æ‹’ç»ï¼Œå› ä¸ºå®ƒä¸æ”¯æŒè¯·æ±‚æ•°æ®çš„åª’ä½“æ ¼å¼ã€‚</td><td>415</td></tr><tr><td>UnprocessableException</td><td>å®¢æˆ·ç«¯ä¸Šä¼ çš„é™„ä»¶æ— æ³•å¤„ç†ï¼Œå¯¼è‡´è¯·æ±‚å¤±è´¥</td><td>422</td></tr><tr><td>InternalServerErrorException</td><td>å®¢æˆ·ç«¯è¯·æ±‚æœ‰æ•ˆï¼ŒæœåŠ¡å™¨å¤„ç†æ—¶å‘ç”Ÿäº†æ„å¤–ï¼Œå±äºæœåŠ¡ç«¯é”™è¯¯</td><td>500</td></tr><tr><td>NotImplementedException</td><td>è¯·æ±‚æ— æ³•å¤„ç†ï¼Œå› ä¸ºæœåŠ¡å™¨ä¸æ”¯æŒã€‚</td><td>501</td></tr><tr><td>BadGatewayException</td><td>ç½‘å…³é”™è¯¯</td><td>502</td></tr><tr><td>ServiceUnavailableException</td><td>æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºç½‘ç«™ç»´æŠ¤çŠ¶æ€</td><td>503</td></tr><tr><td>GatewayTimeoutException</td><td>ç½‘å…³è¶…æ—¶</td><td>504</td></tr></tbody></table><p>åˆ—ä¸¾å‡ ä¸ªå¸¸ç”¨çš„ï¼š401ã€403ã€404ã€413ã€500ã€503ï¼Œå…¶ä»–çš„é”™è¯¯ä¸€èˆ¬æ˜¯æŠ›å‡ºä¸šåŠ¡é”™è¯¯ï¼Œæ¯”å¦‚å‚æ•°ä¼ é€’é”™è¯¯è¿™äº›ï¼Œèƒ½äººä¸ºè§„é¿çš„é”™è¯¯ï¼Œå±äºæ˜¯ä¸šåŠ¡æ“ä½œé”™è¯¯ã€‚</p><h4 id="_9-1-1-åŸºç¡€ä½¿ç”¨" tabindex="-1">9.1.1. åŸºç¡€ä½¿ç”¨ <a class="header-anchor" href="#_9-1-1-åŸºç¡€ä½¿ç”¨" aria-label="Permalink to &quot;9.1.1. åŸºç¡€ä½¿ç”¨&quot;">â€‹</a></h4><p>å½“æˆ‘ä»¬åœ¨ç¨‹åºä¸­ä½¿ç”¨ <code>throw</code> æŠ›å‡ºé”™è¯¯æ—¶ï¼Œå°±ä¼šè¢«å¼‚å¸¸å±‚æ•è·å¹¶å“åº”ç»™å®¢æˆ·ç«¯</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">async </span><span style="color:#82AAFF;">findAll</span><span style="color:#BABED8;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">HttpException</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">è¯·æ±‚é”™è¯¯</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      error</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      statusCode</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">BAD_REQUEST</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">BAD_REQUEST</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å‘é€è¯·æ±‚ï¼š</p><p><img src="`+H+`" alt="image-20231026163210714"></p><h4 id="_9-1-2-è‡ªå®šä¹‰å¼‚å¸¸-ç»§æ‰¿" tabindex="-1">9.1.2. è‡ªå®šä¹‰å¼‚å¸¸-ç»§æ‰¿ <a class="header-anchor" href="#_9-1-2-è‡ªå®šä¹‰å¼‚å¸¸-ç»§æ‰¿" aria-label="Permalink to &quot;9.1.2. è‡ªå®šä¹‰å¼‚å¸¸-ç»§æ‰¿&quot;">â€‹</a></h4><p>åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ— éœ€è‡ªå®šä¹‰å¼‚å¸¸ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>nest</code> å†…ç½®çš„å¼‚å¸¸ç±»ï¼Œå¦‚æœç¡®å®éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸ï¼Œå…¶ä¸­è‡ªå®šä¹‰å¼‚å¸¸ç±»ç»§æ‰¿è‡ª <code>HttpException</code> åŸºç¡€ç±»</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ForbiddenException</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">HttpException</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">response</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Record</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">super</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">response</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">FORBIDDEN</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>åœ¨ç¨‹åºä¸­ç›´æ¥æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸å³å¯ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">filter</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">FilterController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getHello</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">ForbiddenException</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">è¯·æ±‚é”™è¯¯</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      error</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      statusCode</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">BAD_REQUEST</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>ç»“æœå¦‚ä¹‹å‰ä¸€è‡´ã€‚</p><h4 id="_9-1-3-å¼‚å¸¸è¿‡æ»¤" tabindex="-1">9.1.3. å¼‚å¸¸è¿‡æ»¤ <a class="header-anchor" href="#_9-1-3-å¼‚å¸¸è¿‡æ»¤" aria-label="Permalink to &quot;9.1.3. å¼‚å¸¸è¿‡æ»¤&quot;">â€‹</a></h4><p>åœ¨ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ç»§æ‰¿è‡ª <code>HttpException</code> åŸºç¡€ç±»å®ç°è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œä½†æœ‰æ—¶å€™ä¸€äº›ä¸šåŠ¡æ“ä½œä¸ä¸€å®šéè¦æŠ›å‡º <code>http</code> å¼‚å¸¸ï¼Œè€Œæ˜¯æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸ï¼Œæ¯”å¦‚ä¸‹åˆ—æ ¼å¼ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">interface</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">message</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯æ—¶å‡ºç°</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">PUT</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DELETE</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">PATCH</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯æ—¶å‡ºç°</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">failed</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯æ—¶å‡ºç°</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>è¿™å°±è¦ç”¨åˆ° <code>nest</code> çš„å¼‚å¸¸è¿‡æ»¤å™¨ï¼Œå¼‚å¸¸è¿‡æ»¤å™¨å¿…é¡»å®ç° <code>ExceptionFilter</code> æ¥å£ï¼Œåªæœ‰ä¸€ä¸ª <code>catch()</code> æ–¹æ³•ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li>å¼‚å¸¸å¯¹è±¡</li><li>ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå½“è¿›å…¥åˆ°è¿‡æ»¤å™¨ä¸­ï¼Œ<code>response</code> å¯¹è±¡å¿…é¡»è¦æœ‰å†…å®¹è¿”å›ï¼Œä¸ç„¶æ•´ä¸ªç¨‹åºä¼šé€ æˆé˜»å¡ï¼Œå¾—ä¸åˆ°å“åº”è€Œè¶…æ—¶</li></ul><p>åˆ›å»ºä¸€ä¸ªè¿‡æ»¤å™¨ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Catch</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">FilterFilter</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ExceptionFilter</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">catch</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">exception</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">host</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ArgumentsHost</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>@Catch()</code> è£…é¥°å™¨çš„ä½œç”¨æ˜¯å‘Šè¯‰ <code>nest</code> ï¼Œå½“å‰çš„ç±»æ˜¯ä¸€ä¸ªå¼‚å¸¸è¿‡æ»¤å™¨ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå¼‚å¸¸ç±»ï¼Œå½“æ²¡æœ‰ä¼ é€’æ—¶ï¼Œä¼šè¿‡æ»¤æ‰€æœ‰çš„å¼‚å¸¸ã€‚</p><p>å°†è¿‡æ»¤å™¨è¡¥å……å®Œæ•´ï¼Œè¿”å›ä¸Šé¢ç‰¹å®šçš„æ ¼å¼ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">ArgumentsHost</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">Catch</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">ExceptionFilter</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">HttpException</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Response</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Request</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Catch</span><span style="color:#BABED8;">(HttpException)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">FilterFilter</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ExceptionFilter</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">catch</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">exception</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">HttpException</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">host</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ArgumentsHost</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å–å¾—ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">host</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">switchToHttp</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å“åº”å¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getResponse</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Response</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// è¯·æ±‚å¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRequest</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Request</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¼‚å¸¸çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">exception</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getStatus</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">response</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å“åº”çŠ¶æ€</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">status</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å“åº”è¿”å›å¾æ–‡</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">exception</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">message</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        method</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">method</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        failed</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        data</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>ç»‘å®šå¼‚å¸¸è¿‡æ»¤å™¨ï¼Œå®ƒæœ‰å¥½å‡ ä¸ªä½œç”¨åŸŸï¼šæ–¹æ³•ã€æ§åˆ¶å™¨ã€å…¨å±€ã€å…¨å±€ä¾èµ–æ³¨å…¥</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">filter</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UseFilters</span><span style="color:#BABED8;">(FilterFilter) </span><span style="color:#676E95;font-style:italic;">// 2. æ§åˆ¶å™¨ä½œç”¨åŸŸ</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">FilterController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UseFilters</span><span style="color:#BABED8;">(FilterFilter) </span><span style="color:#676E95;font-style:italic;">// 1. æ–¹æ³•ä½œç”¨åŸŸ</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getHello</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">ForbiddenException</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å‚æ•°é”™è¯¯</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 3. å…¨å±€ä½œç”¨åŸŸ-global</span></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">useGlobalFilter</span><span style="color:#BABED8;">(FilterFilter)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 3.1. å…¨å±€ä½œç”¨åŸŸ-ä¾èµ–æ³¨å…¥ï¼Œå…¶ä¸­APP_FILTERæ˜¯ä»\`@nestjs/core\`åŒ…ä¸­å¯¼å‡º</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [FilterModule]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    AppService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">provide</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> APP_FILTER</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">useClass</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> FilterFilter</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>å‘é€è¯·æ±‚ï¼Œå®¢æˆ·æ”¶åˆ°æˆ‘ä»¬è¿‡æ»¤çš„å“åº”ä¿¡æ¯ï¼Œæ­£å¸¸200çŠ¶æ€ç ï¼Œä¹Ÿæœ‰ä¸šåŠ¡å¼‚å¸¸ã€‚</p><p><img src="`+G+`" alt="image-20231026172523721"></p><h4 id="_9-1-4-è½»é€»è¾‘è¿‡æ»¤å™¨" tabindex="-1">9.1.4. è½»é€»è¾‘è¿‡æ»¤å™¨ <a class="header-anchor" href="#_9-1-4-è½»é€»è¾‘è¿‡æ»¤å™¨" aria-label="Permalink to &quot;9.1.4. è½»é€»è¾‘è¿‡æ»¤å™¨&quot;">â€‹</a></h4><p>å½“ä½ çš„éœ€æ±‚è¿‡äºç®€å•ï¼Œæ¯”å¦‚åªéœ€è¦åœ¨è¿‡æ»¤å™¨ä¸­ç®€å•è®°å½•ï¼Œå¹¶æ— å…¶ä»–å…³é”®é€»è¾‘ï¼Œå¯ä»¥åˆ©ç”¨ <code>BaseExceptionFilter</code> ç±»ï¼ŒåŸºæœ¬çš„å¼‚å¸¸å¤„ç†ä¾æ—§äº¤ç”± <code>nest</code> å¤„ç†</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ArgumentsHost</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Catch</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ExceptionFilter</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">BaseExceptionFilter</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/core</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Catch</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AllexceptionFilter</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">BaseExceptionFilter</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">catch</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">exception</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">host</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ArgumentsHost</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">some exceptions occurred</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">exception</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">host</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>å…¶ä½¿ç”¨æ–¹æ³•ä¸ä¸€èˆ¬çš„è¿‡æ»¤å™¨ç›¸åŒï¼Œä¹Ÿå¯ä»¥åœ¨è£…é¥°å…¶ä¸­åˆ¶å®šæˆ–ä¸æŒ‡å®šå¼‚å¸¸ç±»å‹ã€‚</p><h3 id="_9-2-middleware-ä¸­é—´ä»¶" tabindex="-1">9.2. Middleware ä¸­é—´ä»¶ <a class="header-anchor" href="#_9-2-middleware-ä¸­é—´ä»¶" aria-label="Permalink to &quot;9.2. Middleware ä¸­é—´ä»¶&quot;">â€‹</a></h3><p>åœ¨è¯·æ±‚è¿›å…¥æ§åˆ¶å™¨ä¹‹å‰è°ƒç”¨çš„å‡½æ•°ï¼Œä¸­é—´ä»¶å¯ä»¥è®¿é—®è¯·æ±‚ã€å“åº”å¯¹è±¡ï¼Œä»¥åŠ <code>next()</code> å‡½æ•°ã€‚åœ¨å®šä¹‰å¤šä¸ªä¸­é—´ä»¶æ—¶ï¼Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°é€šå¸¸ç”±<code>next()</code>å‡½æ•°è¡¨ç¤ºã€‚</p><p>ä½ å¯ä»¥åœ¨å¸¦æœ‰ <code>@Injectable()</code> è£…é¥°å™¨çš„ç±»ä¸­å®ç°è‡ªå®šä¹‰çš„ä¸­é—´ä»¶ï¼Œè¯¥ç±»éœ€è¦å®ç° <code>NestMiddleware</code> æ¥å£ã€‚</p><div class="tip custom-block"><p class="custom-block-title">é»˜è®¤ä¸­é—´ä»¶</p><p><code>nest</code> é»˜è®¤ä½¿ç”¨ <code>express</code> çš„ä¸­é—´ä»¶ï¼Œ<code>express</code>å’Œ<code>fastify</code>å¤„ç†ä¸­é—´ä»¶çš„æ–¹å¼å¹¶ä¸ç›¸åŒã€‚</p></div><h4 id="_9-2-1-åŸºæœ¬ä½¿ç”¨" tabindex="-1">9.2.1. åŸºæœ¬ä½¿ç”¨ <a class="header-anchor" href="#_9-2-1-åŸºæœ¬ä½¿ç”¨" aria-label="Permalink to &quot;9.2.1. åŸºæœ¬ä½¿ç”¨&quot;">â€‹</a></h4><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-Kr5Zk" id="tab-B79gnHs" checked="checked"><label for="tab-B79gnHs">logger.midderware</label><input type="radio" name="group-Kr5Zk" id="tab-82FfoLJ"><label for="tab-82FfoLJ">app.module</label><input type="radio" name="group-Kr5Zk" id="tab-g67wl2A"><label for="tab-g67wl2A">cat.controller</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨ç±»æ–¹æ³•å®ç°ä¸€ä¸ªç®€å•çš„ä¸­é—´ä»¶æ‰“å°åŠŸèƒ½ã€‚</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Injectable</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">NestMiddleware</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Request</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Response</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">NextFunction</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">LoggerMiddleware</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestMiddleware</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">use</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Request</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Response</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">next</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NextFunction</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">before...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">after...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨ä¸­é—´ä»¶ï¼Œå®ç°NestModuleæ¥å£ï¼ŒæŒ‡å®šcatæ¥å£ä½¿ç”¨ä¸­é—´ä»¶</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatModule]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">configure</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">consumer</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MiddlewareConsumer</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">consumer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">LoggerMiddleware</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forRoutes</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">catService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CatService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getTxt</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></div><p>è¯·æ±‚<code>/cat</code>ï¼Œç»“æœå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="`+Q+`" alt="image-20230918195427392"></p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸ºè·¯å¾„ <code>/cat</code> çš„æ§åˆ¶å™¨è®¾ç½®äº†ä¸­é—´ä»¶ï¼Œ<code>forRoutes(&#39;cat&#39;)</code>è¡¨ç¤ºä½œç”¨äº <code>cat controller</code>ï¼Œè¿˜å¯ä»¥æ§åˆ¶è·¯å¾„ã€è¯·æ±‚æ–¹æ³•ã€ç‰ˆæœ¬ç­‰ç­‰é™åˆ¶ç‰¹å®šçš„è¯·æ±‚æ–¹æ³•ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatModule]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">configure</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">consumer</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MiddlewareConsumer</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#BABED8;">consumer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">LoggerMiddleware</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forRoutes</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> method</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">RequestMethod</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">GET</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>RequestMethod æšä¸¾ç”± @nestjs/common åŒ…ä¸­å¯¼å‡º</p></blockquote><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å¯ä»¥å°† <code>configure</code> æ–¹æ³•è®¾ä¸ºå¼‚æ­¥æ–¹æ³•ï¼Œå®ƒæ”¯æŒ <code>async/await</code> ã€‚</p></div><h4 id="_9-2-2-ä¾èµ–æ³¨å…¥" tabindex="-1">9.2.2. ä¾èµ–æ³¨å…¥ <a class="header-anchor" href="#_9-2-2-ä¾èµ–æ³¨å…¥" aria-label="Permalink to &quot;9.2.2. ä¾èµ–æ³¨å…¥&quot;">â€‹</a></h4><p>ä¸­é—´ä»¶å®Œå…¨æ”¯æŒä¾èµ–æ³¨å…¥ï¼Œå°±åƒæä¾›è€…å’Œæ§åˆ¶å™¨ä¸€æ ·ï¼Œèƒ½å¤Ÿæ³¨å…¥åŒä¸€æ¨¡å—ä¸­å¯ä»¥æ³¨å…¥çš„ä¾èµ–é¡¹ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">LoggerMiddleware</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestMiddleware</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">appService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">use</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Request</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Response</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">next</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NextFunction</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">before...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ä¾èµ–æ³¨å…¥</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getHello</span><span style="color:#F07178;">()) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">after...</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ä¾èµ–æ³¨å…¥æä¾›è€…</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getHello</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="`+V+`" alt="image-20230918195943084"></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>æ³¨æ„ï¼Œè¿™é‡Œè¯´çš„ä¾èµ–æ³¨å…¥å¹¶ä¸æ˜¯æ³¨å…¥èµ·ä½œç”¨è·¯ç”±çš„<code>service</code> ï¼Œè€Œæ˜¯è°ä¾èµ–æ³¨å…¥äº†ä¸­é—´ä»¶ï¼Œå°±èƒ½å…±äº«é‚£ä¸ªæ¨¡å—çš„æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„ <code>app.module</code></p></div><h4 id="_9-2-3-è·¯ç”±é€šé…ç¬¦" tabindex="-1">9.2.3. è·¯ç”±é€šé…ç¬¦ <a class="header-anchor" href="#_9-2-3-è·¯ç”±é€šé…ç¬¦" aria-label="Permalink to &quot;9.2.3. è·¯ç”±é€šé…ç¬¦&quot;">â€‹</a></h4><p><code>forRoutes</code>æ–¹æ³•è¿˜æ”¯æŒ <code>*</code> ä½œé€šé…ç¬¦ï¼Œæ¯”å¦‚ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [CatModule]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">configure</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">consumer</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MiddlewareConsumer</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">consumer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">LoggerMiddleware</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forRoutes</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*cat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> method</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">RequestMethod</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">GET</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>è¡¨ç¤ºè¯¥ä¸­é—´ä»¶å¯ä»¥åœ¨ <code>cat</code> ç»“å°¾çš„ <code>GET</code> è¯·æ±‚æ–¹æ³•çš„è·¯å¾„è·¯ç”±ä¸­ä½¿ç”¨ã€‚</p><h4 id="_9-2-4-ä¸­é—´ä»¶æ¶ˆè´¹è€…" tabindex="-1">9.2.4. ä¸­é—´ä»¶æ¶ˆè´¹è€… <a class="header-anchor" href="#_9-2-4-ä¸­é—´ä»¶æ¶ˆè´¹è€…" aria-label="Permalink to &quot;9.2.4. ä¸­é—´ä»¶æ¶ˆè´¹è€…&quot;">â€‹</a></h4><p>æ‰€è°“çš„æ¶ˆè´¹è€…ï¼Œä¹Ÿå°±æ˜¯æ³¨å†Œä¸­é—´ä»¶çš„å¯¹è±¡â€”â€”<code>consumer</code>ã€‚<code>MiddlewareConsumer</code> å®ƒæ˜¯ä¸€ä¸ªè¾…åŠ©ç±»ï¼Œæä¾›äº†å‡ ç§å†…ç½®çš„æ–¹æ³•æ¥ç®¡ç†ä¸­é—´ä»¶ï¼Œæ‰€æœ‰çš„ä¸­é—´ä»¶éƒ½å¯ä»¥ä¸²è¡Œé“¾æ¥èµ·æ¥ï¼ˆé“¾å¼è°ƒç”¨ï¼‰ã€‚</p><p>ä¸Šé¢çš„ä¾‹å­éƒ½æ˜¯å•ä¸ªæ§åˆ¶å™¨çš„å®ä¾‹ï¼Œä¸‹é¢å±•ç¤ºå¤šä¸ªä¸­é—´ä»¶ã€å¤šä¸ªæ§åˆ¶å™¨çš„å†™æ³•</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">configure</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">consumer</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MiddlewareConsumer</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">consumer</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">LoggerMiddleware</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Logger2Middleware</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// å¤šä¸ªä¸­é—´ä»¶</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forRoutes</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> method</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">RequestMethod</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ALL</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å¤šä¸ªæ§åˆ¶å™¨</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cat/b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> method</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">RequestMethod</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ALL</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      )</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>å†æ¬¡è¯·æ±‚<code>/cat</code>å’Œ<code>/cat/b</code>ï¼Œæ³¨å†Œçš„è¿™ä¸¤ä¸ªä¸­é—´ä»¶éƒ½èƒ½èµ·åˆ°ä½œç”¨ã€‚</p><h4 id="_9-2-5-æ’é™¤è·¯ç”±" tabindex="-1">9.2.5. æ’é™¤è·¯ç”± <a class="header-anchor" href="#_9-2-5-æ’é™¤è·¯ç”±" aria-label="Permalink to &quot;9.2.5. æ’é™¤è·¯ç”±&quot;">â€‹</a></h4><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›æŸäº›è·¯ç”±åº”è¯¥æ’é™¤ä¸­é—´ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>exclude</code>æ–¹æ³•ï¼Œä¼ å…¥éœ€è¦æ’é™¤çš„è·¯å¾„è·¯ç”±ï¼Œè¯¥æ–¹æ³•åŒæ ·å¯ä»¥ä¼ å…¥å¤šä¸ªå­—ç¬¦ä¸²ã€å¤šä¸ª<code>RouteInfo</code>å¯¹è±¡ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">consumer</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#BABED8;">(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exclude</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cats</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> RequestMethod</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">GET </span><span style="color:#89DDFF;">},</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cats</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> RequestMethod</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">POST </span><span style="color:#89DDFF;">},</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cats/(.*)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forRoutes</span><span style="color:#BABED8;">(CatsController)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºå°†ä¸­é—´ä»¶ç»‘å®šåˆ° <code>CatsController</code> ä¸­çš„æ‰€æœ‰è·¯ç”±æ–¹æ³•ï¼Œä½†æ˜¯æ’é™¤ä¼ é€’ <code>GET:/catsã€POST:/catsä»¥åŠæ‰€æœ‰ä»¥cats/ç»“å°¾çš„</code> è·¯å¾„è·¯ç”±ã€‚</p><h4 id="_9-2-6-å‡½æ•°å¼ä¸­é—´ä»¶" tabindex="-1">9.2.6. å‡½æ•°å¼ä¸­é—´ä»¶ <a class="header-anchor" href="#_9-2-6-å‡½æ•°å¼ä¸­é—´ä»¶" aria-label="Permalink to &quot;9.2.6. å‡½æ•°å¼ä¸­é—´ä»¶&quot;">â€‹</a></h4><p>ä¸€äº›ç®€å•çš„ä¸­é—´ä»¶ï¼Œå¯ä»¥ä¸ä½¿ç”¨ç±»ä½œä¸ºè½½ä½“ï¼Œå¯ä»¥ä½¿ç”¨ç®€å•çš„å‡½æ•°ï¼Œè¿™ç§ç±»å‹å°±å«åšå‡½æ•°å¼ä¸­é—´ä»¶ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">logger</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Request</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Response</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">next</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NextFunction</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Request...</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">configure</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">consumer</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MiddlewareConsumer</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">consumer</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">logger</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// æ³¨å†Œå‡½æ•°ä¸­é—´ä»¶</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forRoutes</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    	  </span><span style="color:#676E95;font-style:italic;">//...</span></span>
<span class="line"><span style="color:#F07178;">    	</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>æ³¨å†Œä½¿ç”¨å¹¶ä¸å—åˆ°å½±å“ï¼Œè¿˜æ˜¯ç…§å¸¸æ³¨å†Œã€‚</p><p>å½“ä½ çš„ä¸­é—´ä»¶åŠŸèƒ½å¾ˆç®€å•ï¼Œå¹¶ä¸”ä¸éœ€è¦ä¾èµ–æ³¨å…¥æ—¶ï¼Œå¯ä»¥è€ƒè™‘è¿™ç§ç®€å•çš„å‡½æ•°å¼ä¸­é—´ä»¶æ›¿ä»£æ–¹æ¡ˆã€‚</p><h4 id="_9-2-7-å…¨å±€ä¸­é—´ä»¶" tabindex="-1">9.2.7. å…¨å±€ä¸­é—´ä»¶ <a class="header-anchor" href="#_9-2-7-å…¨å±€ä¸­é—´ä»¶" aria-label="Permalink to &quot;9.2.7. å…¨å±€ä¸­é—´ä»¶&quot;">â€‹</a></h4><p>å…¨å±€ä¸­é—´ä»¶ï¼Œåªè¦æ³¨å†Œä¸€æ¬¡ï¼Œå…¨å±€çš„è·¯ç”±æ–¹æ³•éƒ½ä¼šç»è¿‡çš„ä¸­é—´ä»¶æ–¹æ³•ã€‚åªéœ€è¦åœ¨<code>main.ts</code>ä¸­ï¼Œä½¿ç”¨ app å®ä¾‹æ³¨å†Œä¸­é—´ä»¶å³å¯ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> NestFactory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#BABED8;">(AppModule)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#BABED8;">(logger)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#BABED8;"> app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>è¿™ç§æ–¹æ³•æ³¨å†Œçš„å…¨å±€ä¸­é—´ä»¶æ— æ³•ä½¿ç”¨ä¾èµ–æ³¨å…¥åŠŸèƒ½ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>forRoutes(&quot;*&quot;)</code>çš„æ–¹å¼ï¼Œåœ¨é¡¶å±‚æ¨¡å— <code>(ä¹Ÿå°±æ˜¯æ ¹æ¨¡å— appModule / rootModule)</code> æˆ–å…¶ä»–æ¨¡å—æ³¨å†Œï¼Œè¿™æ ·å®ƒå°±èƒ½ä½¿ç”¨åˆ°ä¾èµ–æ³¨å…¥çš„æœåŠ¡äº†ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">configure</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">consumer</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">MiddlewareConsumer</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">consumer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">LoggerMiddleware</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forRoutes</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>åªè¦ç»è¿‡ <code>app.module</code> çš„è·¯ç”±æ–¹æ³•ï¼Œéƒ½ä¼šç»è¿‡æ³¨å†Œçš„ä¸­é—´ä»¶ã€‚</p><h3 id="_9-3-æ¡ˆä¾‹å®æˆ˜" tabindex="-1">9.3. æ¡ˆä¾‹å®æˆ˜ <a class="header-anchor" href="#_9-3-æ¡ˆä¾‹å®æˆ˜" aria-label="Permalink to &quot;9.3. æ¡ˆä¾‹å®æˆ˜&quot;">â€‹</a></h3><p>åšä¸€ä¸ªç®€å•çš„çš„æ–‡ç« ç®¡ç†åŠŸèƒ½ï¼ŒåŸºæœ¬å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>åŸºç¡€æ–‡ç« ç®¡ç† CRUDâ€”â€”æ§åˆ¶å™¨ã€æä¾›è€…ã€æ•°æ®ä¼ è¾“ã€ä¾èµ–æ³¨å…¥ã€è£…é¥°å™¨</li><li>TypeOrm ä½¿ç”¨â€”â€”åŠ¨æ€æ¨¡å—</li></ul><h4 id="_9-3-1-æ•°æ®åº“è®¾è®¡" tabindex="-1">9.3.1. æ•°æ®åº“è®¾è®¡ <a class="header-anchor" href="#_9-3-1-æ•°æ®åº“è®¾è®¡" aria-label="Permalink to &quot;9.3.1. æ•°æ®åº“è®¾è®¡&quot;">â€‹</a></h4><p>user è¡¨</p><table><thead><tr><th>field</th><th>type</th><th>description</th></tr></thead><tbody><tr><td>id</td><td>int</td><td>ä¸»é”®</td></tr><tr><td>username</td><td>varchar(100)</td><td>ç”¨æˆ·å</td></tr><tr><td>password</td><td>varchar(255)</td><td>å¯†ç </td></tr><tr><td>email</td><td>varchar(100)</td><td>é‚®ç®±</td></tr><tr><td>create_time</td><td>int</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>update_time</td><td>int</td><td>æ›´æ–°æ—¶é—´</td></tr></tbody></table><p>article è¡¨</p><table><thead><tr><th>field</th><th>type</th><th>description</th></tr></thead><tbody><tr><td>id</td><td>int</td><td>ä¸»é”®</td></tr><tr><td>title</td><td>varchar(255)</td><td>æ ‡é¢˜</td></tr><tr><td>content</td><td>varchar(255)</td><td>å†…å®¹</td></tr><tr><td>desc</td><td>varchar(100)</td><td>æ‘˜è¦</td></tr><tr><td>cover_image</td><td>varchar(100)</td><td>å°é¢ url</td></tr><tr><td>create_time</td><td>int</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>update_time</td><td>int</td><td>æ›´æ–°æ—¶é—´</td></tr></tbody></table><p>tags è¡¨</p><table><thead><tr><th>field</th><th>type</th><th>description</th></tr></thead><tbody><tr><td>id</td><td>int</td><td>ä¸»é”®</td></tr><tr><td>name</td><td>varchar(100)</td><td>åç§°</td></tr><tr><td>create_time</td><td>int</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>update_time</td><td>int</td><td>æ›´æ–°æ—¶é—´</td></tr></tbody></table><p>article_tags è¡¨ï¼ˆtags è¡¨ã€article è¡¨ä¸ºå¤šå¯¹å¤šçš„å…³è”å…³ç³»ï¼Œéœ€è¦ä½¿ç”¨åˆ°ç¬¬ä¸‰å¼ å…³ç³»è¡¨ï¼‰</p><table><thead><tr><th>field</th><th>type</th><th>description</th></tr></thead><tbody><tr><td>article_id</td><td>int</td><td>æ–‡ç«  id</td></tr><tr><td>tag_id</td><td>int</td><td>æ ‡ç­¾ id</td></tr><tr><td>create_time</td><td>int</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>update_time</td><td>int</td><td>æ›´æ–°æ—¶é—´</td></tr></tbody></table><details class="details custom-block"><summary>å»ºè¡¨è¯­å¥ï¼š</summary><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- ----------------------------</span></span>
<span class="line"><span style="color:#F78C6C;">DROP</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">IF</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">EXISTS</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">article</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#BABED8;"> \`</span><span style="color:#82AAFF;">article</span><span style="color:#BABED8;">\`  (</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">int</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">11</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ä¸»é”®</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">title</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">255</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> utf8_general_ci </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ ‡é¢˜</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">content</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">255</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> utf8_general_ci </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ–‡ç« å†…å®¹</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">desc</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> utf8_general_ci </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ‘˜è¦</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">cover_image</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">255</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> utf8_general_ci </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ–‡ç« å°é¢</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">create_time</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">datetime</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åˆ›å»ºæ—¶é—´</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">update_time</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">datetime</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ›´æ–°æ—¶é—´</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">PRIMARY KEY</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">USING</span><span style="color:#BABED8;"> BTREE</span></span>
<span class="line"><span style="color:#BABED8;">) ENGINE </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> InnoDB </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> utf8_general_ci ROW_FORMAT </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">Dynamic</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- ----------------------------</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- ----------------------------</span></span>
<span class="line"><span style="color:#F78C6C;">DROP</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">IF</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">EXISTS</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">article_tags</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#BABED8;"> \`</span><span style="color:#82AAFF;">article_tags</span><span style="color:#BABED8;">\`  (</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">article_id</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">int</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">11</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> æ–‡ç« å¤–é”®id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">tag_id</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">int</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">11</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ ‡ç­¾å¤–é”®id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">create_time</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">datetime</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åˆ›å»ºæ—¶é—´</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">update_time</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">datetime</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ›´æ–°æ—¶é—´</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#BABED8;">) ENGINE </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> InnoDB </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> utf8_general_ci ROW_FORMAT </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">Dynamic</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- ----------------------------</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- ----------------------------</span></span>
<span class="line"><span style="color:#F78C6C;">DROP</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">IF</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">EXISTS</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">tags</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#BABED8;"> \`</span><span style="color:#82AAFF;">tags</span><span style="color:#BABED8;">\`  (</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">int</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">11</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ä¸»é”®</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> utf8_general_ci </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åç§°</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">create_time</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">datetime</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åˆ›å»ºæ—¶é—´</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">update_time</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">datetime</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ›´æ–°æ—¶é—´</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">PRIMARY KEY</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">USING</span><span style="color:#BABED8;"> BTREE</span></span>
<span class="line"><span style="color:#BABED8;">) ENGINE </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> InnoDB </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> utf8_general_ci ROW_FORMAT </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">Dynamic</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- ----------------------------</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- ----------------------------</span></span>
<span class="line"><span style="color:#F78C6C;">DROP</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">IF</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">EXISTS</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">user</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#BABED8;"> \`</span><span style="color:#82AAFF;">user</span><span style="color:#BABED8;">\`  (</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">int</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">11</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#BABED8;"> AUTO_INCREMENT COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ä¸»é”®</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">username</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> utf8_general_ci </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç”¨æˆ·å</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">password</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">255</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> utf8_general_ci </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¯†ç </span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">email</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> utf8_general_ci </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">é‚®ç®±è´¦å·</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">create_time</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">datetime</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åˆ›å»ºæ—¶é—´</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">update_time</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">datetime</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#BABED8;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ›´æ–°æ—¶é—´</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">PRIMARY KEY</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">\`</span><span style="color:#BABED8;">) </span><span style="color:#F78C6C;">USING</span><span style="color:#BABED8;"> BTREE</span></span>
<span class="line"><span style="color:#BABED8;">) ENGINE </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> InnoDB AUTO_INCREMENT </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">CHARACTER</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">SET</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> utf8 </span><span style="color:#C792EA;">COLLATE</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> utf8_general_ci ROW_FORMAT </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">Dynamic</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- ----------------------------</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div></details><h4 id="_9-3-2-è·¯ç”±è®¾è®¡" tabindex="-1">9.3.2. è·¯ç”±è®¾è®¡ <a class="header-anchor" href="#_9-3-2-è·¯ç”±è®¾è®¡" aria-label="Permalink to &quot;9.3.2. è·¯ç”±è®¾è®¡&quot;">â€‹</a></h4><p>article</p><ul><li>ã€GETã€‘/article è·å–æ–‡ç« åˆ—è¡¨</li><li>ã€GETã€‘/article/:id è·å–æ–‡ç« è¯¦æƒ…</li><li>ã€POSTã€‘/article åˆ›å»ºæ–‡ç« </li><li>ã€PUTã€‘/article/:id ä¿®æ”¹æ–‡ç« </li><li>ã€DELETEã€‘/article/:id åˆ é™¤æ–‡ç« </li></ul><p>tags</p><ul><li>ã€GETã€‘/tags è·å–æ ‡ç­¾åˆ—è¡¨</li><li>ã€POSTã€‘/tags åˆ›å»ºæ ‡ç­¾</li><li>ã€PUTã€‘/tags/:id ä¿®æ”¹æ–‡ç« </li><li>ã€DELETEã€‘/tags/:id åˆ é™¤æ–‡ç« </li></ul><p>user</p><ul><li>ã€GETã€‘/user/:id è·å–ç”¨æˆ·è¯¦æƒ…</li><li>ã€POSTã€‘/user æ³¨å†Œ</li><li>ã€PUTã€‘/tags/:id ä¿®æ”¹ç”¨æˆ·</li><li>ã€DELETEã€‘/tags/:id åˆ é™¤ç”¨æˆ·</li></ul><details class="details custom-block"><summary>controllerï¼ˆtags ä¸ºä¾‹å­ï¼Œå…ˆä¸ç®¡å®ä½“ç±»å’Œå‚æ•°ç±»å‹ä¹‹ç±»çš„ï¼Œä¸»è¦çœ‹è·¯ç”±è®¾è®¡ï¼‰</summary><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Controller</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Get</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Post</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Put</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Delete</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Body</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Param</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">TagsService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../services/tags.service</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Tags</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../entities/tags.entities</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CommonParams</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/typings/controllers</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">tags</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">TagsController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">tagsService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">TagsService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getTags</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">createTag</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">tagInfo</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Tags</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Put</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/:id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">updateTag</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Param</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">params</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CommonParams</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">tagInfo</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Tags</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Delete</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/:id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">deleteTag</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Param</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">params</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CommonParams</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></details><p>ç›®å‰æ–‡ä»¶ç›®å½•ï¼š</p><p><img src="`+Y+`" alt="image-20230920233953465"></p><h4 id="_9-3-3-typeorm" tabindex="-1">9.3.3. TypeORM <a class="header-anchor" href="#_9-3-3-typeorm" aria-label="Permalink to &quot;9.3.3. TypeORM&quot;">â€‹</a></h4><ol><li><p>æ ¹æ®æ•°æ®è®¾è®¡å¥½çš„è¡¨å­—æ®µå®šä¹‰å®ä½“ç±»</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Entity</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Column</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">PrimaryGeneratedColumn</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CreateDateColumn</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">UpdateDateColumn</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">typeorm</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Entity</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Tags</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">PrimaryGeneratedColumn</span><span style="color:#BABED8;">() </span><span style="color:#676E95;font-style:italic;">// è‡ªå¢ä¸»é”®</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Column</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">varchar</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">length</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">CreateDateColumn</span><span style="color:#BABED8;">() </span><span style="color:#676E95;font-style:italic;">// CreateDateColumnç‰¹æ®Šåˆ—ï¼Œåˆ›å»ºå¯¹è±¡è‡ªåŠ¨æ’å…¥å½“å‰æ—¶é—´</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">create_time</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Date</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UpdateDateColumn</span><span style="color:#BABED8;">() </span><span style="color:#676E95;font-style:italic;">// UpdateDateColumnç‰¹æ®Šåˆ—ï¼Œæ›´æ–°å¯¹è±¡æ—¶è‡ªåŠ¨æ’å…¥å½“å‰æ—¶é—´</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">update_time</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Date</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li><li><p>æ³¨å†Œ TypeORMï¼Œè¿æ¥æ•°æ®åº“</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">AppController</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./app.controller</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">AppService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./app.service</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">TagsModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./tags/tags.module</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">TypeOrmModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/typeorm</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    TypeOrmModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forRoot</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mysql</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">3307</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">username</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">123456</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">database</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nestdemo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">entities</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [__dirname </span><span style="color:#89DDFF;">+</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/**/*.entity{.ts,.js}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">]</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// æ‰¹é‡æ³¨å†Œå®ä½“ç±»</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">synchronize</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// æ ¹æ®å®ä½“è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“è¡¨ï¼Œ ç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­ï¼Œåªå¼€å¯æ­¤é€‰é¡¹å¹¶ä¸ä¼šæ›¿ä½ åˆ›å»ºæ•°æ®åº“è¡¨ï¼Œè¿˜å¿…é¡»åœ¨æ¨¡å—ä¸­ä½¿ç”¨featureåŠŸèƒ½ï¼Œæ³¨å…¥å®ä½“æ¨¡å—ä¾èµ–</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">autoLoadEntities</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">//è‡ªåŠ¨åŠ è½½å®ä½“ï¼Œå¦‚æœentitiesä¸­åŒ¹é…äº†å…¨å±€è·¯å¾„ï¼Œè¯¥é€‰é¡¹å¯ä»¥å…³é—­</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">logging</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    TagsModule</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppService]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>tags.module.tsï¼ˆæ³¨å†Œå®ä½“ä¾èµ–ï¼‰</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">TagsService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./services/tags.service</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">TypeOrmModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/typeorm</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Tags</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./entities/tags.entities</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [TagsService]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [TypeOrmModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forFeature</span><span style="color:#BABED8;">([Tags])]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">TagsModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ol><h4 id="_9-3-4-è¡¥å……-serviceã€controller-ä»£ç " tabindex="-1">9.3.4. è¡¥å…… serviceã€controller ä»£ç  <a class="header-anchor" href="#_9-3-4-è¡¥å……-serviceã€controller-ä»£ç " aria-label="Permalink to &quot;9.3.4. è¡¥å…… serviceã€controller ä»£ç &quot;">â€‹</a></h4><p><code>ï¼ˆä»¥tagsä¸ºä¾‹ï¼‰</code></p><p>tag.service.ts</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Injectable</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">InjectRepository</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/typeorm</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Tags</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../entities/tags.entities</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Repository</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">typeorm</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">TagsService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">InjectRepository</span><span style="color:#BABED8;">(Tags)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">tagRepository</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Repository</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Tags</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * æŸ¥è¯¢æ‰€æœ‰tag</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   */</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getAll</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">tagRepository</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * æ–°å»ºtagè¡Œè®°å½•</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">tag</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   */</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">create</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">tag</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Tags</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">tagRepository</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">tag</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * æ ¹æ®idæ›´æ–°tag</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">id</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">tag</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   */</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">updateById</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">tag</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Tags</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">tagRepository</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">tag</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * æ ¹æ®idåˆ é™¤tagè®°å½•</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">id</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   */</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">deleteById</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">tagRepository</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">delete</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">id</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>tag.controller.ts</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Controller</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Get</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Post</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Put</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Delete</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Body</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Param</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">TagsService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../services/tags.service</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Tags</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../entities/tags.entities</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CommonParams</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/typings/controllers</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">tags</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">TagsController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">tagsService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">TagsService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">getTags</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">tagsService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getAll</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">createTag</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">tagInfo</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Tags</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">tagsService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">tagInfo</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Put</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/:id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">updateTag</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Param</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">params</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CommonParams</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">tagInfo</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Tags</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">tagsService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">updateById</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">params</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">tagInfo</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Delete</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/:id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">deleteTag</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Param</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">params</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CommonParams</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">tagsService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">deleteById</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">params</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">id</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>åˆ°æ­¤ä¸ºæ­¢å·²ç»è¡¥å……äº†ä»¥ <code>tags</code> ä¸ºä¾‹å­çš„æ‰€æœ‰ä»£ç ï¼Œé™„ä¸Šæ¡ˆä¾‹ä»£ç <a href="https://github.com/chen-d-yu/nest-http-server-template/tree/article-template" target="_blank" rel="noreferrer">github</a>åœ°å€ã€‚</p><h3 id="_9-4-guards-å®ˆå«" tabindex="-1">9.4. guards å®ˆå« <a class="header-anchor" href="#_9-4-guards-å®ˆå«" aria-label="Permalink to &quot;9.4. guards å®ˆå«&quot;">â€‹</a></h3><p>ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œå®ç°äº† <code>CanActivate </code> æ¥å£ï¼Œè¿™æ ·çš„ç±»å°±å¯ä»¥è¢«ç§°ä¸ºå®ˆå«ï¼ˆå®ˆå«åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªæä¾›è€…<code>providers</code>ï¼‰ã€‚</p><p>å®ˆå«çš„æ„æ€æ˜¯åœ¨æŸä¸ªæ–¹æ³•å‰å……å½“ã€ŠæŠ¤å«ã€‹å®ˆæŠ¤å…¥å£ï¼Œç±»ä¼¼äº <code>Vue</code> çš„è·¯ç”±é‰´æƒï¼Œé‰´æƒæ­£æ˜¯å®ˆå«çš„æœ€å¥½ç”¨ä¾‹ï¼Œå½“ç”¨æˆ·è°ƒç”¨æ–¹æ³•ï¼Œéœ€è¦æ ¡éªŒæ˜¯å¦æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™ <code>(é‰´æƒã€JWTæ ¡éªŒã€RBACæ ¡éªŒã€è®¿é—®æ§åˆ¶)</code> æ—¶ï¼Œä¹‹åé“¾è·¯ä¸Šçš„è·¯ç”±æ–¹æ³•æ‰å¯ç”¨ã€‚</p><p>å®ˆå«çš„ä¾‹å­éœ€è¦æ­é… <code>JWT</code> çš„ç”Ÿæˆä»¥åŠéªŒè¯ã€‚</p><h4 id="_9-4-1-åŸºæœ¬ä½¿ç”¨" tabindex="-1">9.4.1. åŸºæœ¬ä½¿ç”¨ <a class="header-anchor" href="#_9-4-1-åŸºæœ¬ä½¿ç”¨" aria-label="Permalink to &quot;9.4.1. åŸºæœ¬ä½¿ç”¨&quot;">â€‹</a></h4><p>å®ˆå«çš„åŸºæœ¬ä½¿ç”¨ï¼Œå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»å®ç°äº† <code>CanActivate</code> æ¥å£ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼</p><ul><li>å¦‚æœè¿”å› <code>true</code>, å°†å¤„ç†ç”¨æˆ·è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¿›å…¥è·¯ç”±æ–¹æ³•ã€‚</li><li>å¦‚æœè¿”å› <code>false</code>, åˆ™ <code>nest</code> å°†å¿½ç•¥å½“å‰å¤„ç†çš„è¯·æ±‚ï¼Œå®é™…ä¸Š <code>nest</code> ä¼šæŠ›å‡ºé”™è¯¯ <code>throw new UnauthorizedException()</code> ï¼Œä¹Ÿå°±æ˜¯ä¼šå¾—åˆ°403çš„å“åº”ç»“æœï¼ŒæŠ›å‡ºçš„é”™è¯¯å¯ä»¥ç»“åˆ<a href="#filter">å¼‚å¸¸æ‹¦æˆªå™¨</a>è¿›è¡Œè‡ªå®šä¹‰é”™è¯¯ã€‚</li></ul><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªä¸å®ç°ä»»ä½•é€»è¾‘çš„å®ˆå«ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CanActivate</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ExecutionContext</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Injectable</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Observable</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rxjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">RoleGuard</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CanActivate</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">canActivate</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">context</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ExecutionContext</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">boolean</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Observable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">boolean</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// nestä¼šæ”¾è¡Œè¿›å…¥åˆ°æ§åˆ¶å™¨æ–¹æ³•ä¸­</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// nestä¼šæŠ›å‡ºé”™è¯¯ï¼Œå®é™…ä¸Šæ˜¯è§¦å‘è¿™è¡Œä»£ç  throw new UnauthorizedException(); å¾—åˆ°403çš„å“åº”ç»“æœ</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>æ³¨å†Œå®ˆå«ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guard</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UseGuards</span><span style="color:#BABED8;">(RoleGuard) </span><span style="color:#676E95;font-style:italic;">// æ§åˆ¶å™¨ä½œç”¨åŸŸ</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">GuardController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">guardService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">GuardService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// @UseGuards(RoleGuard) // æ–¹æ³•ä½œç”¨åŸŸ</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">findAll</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">guardService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">findAll</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å…¨å±€ä½œç”¨åŸŸ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// main.ts</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// app.useGlobalGuards(new RoleGuard());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å¦‚æœæƒ³ä½¿ç”¨ä¾èµ–æ³¨å…¥åŠŸèƒ½ï¼Œé‚£ä¹ˆå…¨å±€å®ˆå«çš„æ³¨å†Œæ–¹å¼åº”æ”¹ä¸ºä¸ºæ ¹æ¨¡å—æ³¨å…¥çš„æ–¹å¼</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// @Module({</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//   providers:[</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//     provide:APP_GUARD,</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//     useClass:RoleGuard</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//   ]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// })</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// export class AppModule{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>é€šè¿‡å®ˆå«çš„æƒ…å†µï¼Œä¼šæ‰§è¡ŒæŒ‰ç…§åŸå®šçš„é€»è¾‘æ‰§è¡Œæ§åˆ¶å™¨æ–¹æ³•ã€‚</p><p>æ²¡é€šè¿‡æ ¡éªŒä¼šè¿”å›403é”™è¯¯</p><p><img src="`+K+`" alt="image-20231004160721209"></p><h4 id="_9-4-2-jwt" tabindex="-1">9.4.2. jwt <a class="header-anchor" href="#_9-4-2-jwt" aria-label="Permalink to &quot;9.4.2. jwt&quot;">â€‹</a></h4><p><code>JWTï¼ˆJson Web Tokenï¼‰</code> æ˜¯ä¸€ç§ä»¥<code>JSON</code>ä½œä¸ºè½½ä½“ï¼Œåœ¨ä¸åŒçš„æœåŠ¡ç«¯ä¹‹é—´è¿›è¡Œå®‰å…¨çš„ä¼ è¾“ä¿¡æ¯ã€‚</p><p>æœ€å¸¸è§çš„åœºæ™¯å°±æ˜¯æˆæƒè®¤è¯ï¼Œç”¨æˆ·ç™»å½•è¿‡åï¼ŒæœåŠ¡ç«¯å‘æ”¾ <code>jwt token</code> ï¼Œåç»­ç”¨æˆ·çš„æ¯ä¸ªè¯·æ±‚éƒ½å°†åŒ…å« <code>token</code> ï¼ŒæœåŠ¡ç«¯åœ¨å¤„ç†ç”¨æˆ·çš„è¯·æ±‚æ—¶ï¼Œä¼šå…ˆå¯¹ <code>token</code> è¿›è¡Œå®‰å…¨æ ¡éªŒï¼Œé€šè¿‡ä¹‹åå†è¿›è¡Œè¯·æ±‚å¤„ç†ã€‚</p><p><code>Token</code> å¯ä»¥ä¿å­˜ï¼Œä¹Ÿå¯ä»¥ä¸ä¿å­˜ã€‚</p><p>ä¿å­˜ï¼Œæ˜¯å› ä¸ºè¦é€‚åº”å¤§å¹¶å‘åœºæ™¯ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼çš„æœåŠ¡ç«¯ï¼Œå¤šä¸ªæœåŠ¡éœ€è¦å…±äº« <code>Token</code> çš„æƒ…å†µï¼Œè§£æ <code>Token</code> æ˜¯éœ€è¦è€—è´¹èµ„æºçš„ï¼Œè‹¥èƒ½ç›´æ¥é€šè¿‡å¿«é€Ÿçš„åˆ¤æ–­è¿›è¡Œ <code>Token</code> çš„æœ‰æ•ˆåˆ¤æ–­ï¼Œèƒ½èŠ‚çœå¾ˆå¤šæœåŠ¡å™¨å ç”¨ï¼Œæ¯”å¦‚ <code>Redis</code> å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼›</p><p>ä¸ä¿å­˜ï¼Œå› ä¸ºç”¨æˆ·çš„ä¿¡æ¯ï¼ˆé™¤æ•æ„Ÿä¿¡æ¯ä¹‹å¤–ï¼‰éƒ½å·²ç»å­˜åˆ° <code>Token</code> é‡Œï¼ŒæœåŠ¡ç«¯è¦åšçš„æ˜¯å¯¹ <code>Token</code> è¿›è¡Œæ ¡éªŒï¼Œçœ‹æ˜¯å¦è¿›è¡ŒåŠ å¯†è¿‡ä¸”è¿˜åœ¨æœ‰æ•ˆæœŸå†…ï¼Œå¦‚æœä»¤ç‰Œæœ‰é—®é¢˜ï¼Œå°±æ‹’ç»æ­¤æ¬¡è¯·æ±‚ã€‚</p><p><code>nest </code> é›†æˆäº† <code>JWT</code> ï¼Œä½¿å…¶å˜ä¸ºä¸€ä¸ªæ¨¡å—ï¼Œéœ€è¦å®‰è£…å¹¶ä» <code>@nestjs/jwt</code> ä¸­å¼•å…¥ï¼Œç”¨æˆ·æ•°æ®ä½¿ç”¨jsonæ•°æ®æ¨¡æ‹Ÿã€‚</p><details class="details custom-block"><summary>Details</summary><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-rfFiB" id="tab-Qe-xXHQ" checked="checked"><label for="tab-Qe-xXHQ">auth.module</label><input type="radio" name="group-rfFiB" id="tab-sKigbaX"><label for="tab-sKigbaX">auth.controller</label><input type="radio" name="group-rfFiB" id="tab-yv_akES"><label for="tab-yv_akES">auth.service</label><input type="radio" name="group-rfFiB" id="tab-WD_QmHq"><label for="tab-WD_QmHq">user.dto</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">AuthService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./auth.service</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">AuthController</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./auth.controller</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#BABED8;"> user </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../data/user.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">JwtModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/jwt</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// tokenç§˜é’¥ï¼Œä¸€èˆ¬ä»¥é…ç½®æ–‡ä»¶çš„å½¢å¼å®šä¹‰ï¼Œè¿™é‡Œä»…ä½œä¸ºæ¨¡æ‹Ÿ</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> TOKEN_SECRET </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">123456</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">provide</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">userData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">useValue</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> user</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">    AuthService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    JwtModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">registerAsync</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#82AAFF;">useFactory</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">secret</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> TOKEN_SECRET</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">signOptions</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">expiresIn</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1d</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AuthController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Body</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Controller</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Post</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">AuthService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./auth.service</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">User</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dto/user.dto</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">auth</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">auth</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">login</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">body</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">User</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">body</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">auth</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">login</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">body</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Inject</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Injectable</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> user </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../data/user.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">JwtService</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/jwt</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">User</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dto/user.dto</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Inject</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">userData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">userData</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#BABED8;"> user</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">jwtService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">JwtService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">login</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">userDto</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">User</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">userData</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">userData</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">user</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">userDto</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">password</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">userDto</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">password</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">user</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        errCode</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">100053</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        msg</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">generateToken</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">user</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">generateToken</span><span style="color:#89DDFF;">({</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">id</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">User</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      token</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">jwtService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">signAsync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> sub</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">interface</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">User</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">age</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div></div></details><p><img src="`+J+`" alt="image-20231005160001756"></p><h4 id="_9-4-3-passportç­–ç•¥" tabindex="-1">9.4.3. passportç­–ç•¥ <a class="header-anchor" href="#_9-4-3-passportç­–ç•¥" aria-label="Permalink to &quot;9.4.3. passportç­–ç•¥&quot;">â€‹</a></h4><p>èº«ä»½éªŒè¯å…·æœ‰ä¸åŒçš„ç­–ç•¥æ¨¡å¼ï¼Œæ¯”å¦‚ç™»å½•ã€æ³¨å†Œå’Œæ­£å¸¸æ¥å£è®¿é—®æ˜¯ä¸¤ç§ä¸åŒçš„ç­–ç•¥ï¼Œç™»å½•ã€æ³¨å†Œä¸éœ€è¦ <code>Token</code> ä»¤ç‰Œï¼Œä½†æ˜¯æ­£å¸¸çš„æ¥å£è®¿é—®å´éœ€è¦ã€‚</p><p>åœ¨ <code>nodejs</code> å¸¸ç”¨ <code>passport</code> èº«ä»½éªŒè¯åº“ä½œä¸ºä¸åŒç­–ç•¥çš„æ ¡éªŒï¼Œå®ƒå°†èº«ä»½éªŒè¯æŠ½è±¡ä¸ºå‡ ä¸ªåŸºæœ¬æ­¥éª¤ï¼Œä½ å¯ä»¥æ ¹æ®å®ç°çš„ç­–ç•¥è¿›è¡Œè‡ªå®šä¹‰çš„é…ç½®ï¼Œå°±èƒ½å®ç°ä¸åŒçš„ç­–ç•¥ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚</p><p>ç­–ç•¥ç±»éœ€è¦ç»§æ‰¿æ¥è‡ª <code>@nestjs/passport</code> åŒ…çš„ <code>PassportStrategy</code> ç±»ï¼Œä¼ å…¥å¯¹åº”çš„ç­–ç•¥ã€‚</p><p>å°† <code>jwt</code> çš„ä¾‹å­å®Œå…¨ä½¿ç”¨ <code>passport</code> æ¥è¿›è¡Œæ”¹é€ ï¼Œåœ¨ <code>auth</code> çš„æ¨¡å—ä¸­æ–°å»ºå¤šç§ç­–ç•¥ç±»ã€‚</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-fOxL1" id="tab-ZOrBpZN" checked="checked"><label for="tab-ZOrBpZN">local.stragety æ–°å¢æ–‡ä»¶</label><input type="radio" name="group-fOxL1" id="tab-wdKA9oh"><label for="tab-wdKA9oh">auth.module</label><input type="radio" name="group-fOxL1" id="tab-Pzo9irh"><label for="tab-Pzo9irh">auth.service</label><input type="radio" name="group-fOxL1" id="tab-HpyNThY"><label for="tab-HpyNThY">auth.service</label></div><div class="blocks"><div class="language-ts active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">PassportStrategy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/passport</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Strategy</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">IStrategyOptions</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">passport-local</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">BadRequestException</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Inject</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">User</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dto/user.dto</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">LocalStragety</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">PassportStrategy</span><span style="color:#BABED8;">(Strategy</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">local</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Inject</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">userData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">userData</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">User</span><span style="color:#BABED8;">[]</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">super</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      usernameField</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      passwordField</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">password</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">IStrategyOptions</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">validate</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">password</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æœ¬åœ°ç­–ç•¥çš„é€»è¾‘ï¼Œå…ˆä»æ•°æ®åº“ä¸­æŸ¥æ‰¾å½“å‰ç”¨æˆ·ï¼Œç„¶åè¿”å›å½“å‰ç”¨æˆ·ï¼Œäº¤ç”±ç»™ä¸‹ä¸€æ­¥è¿›è¡Œå¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">userData</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">user</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">password</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">password</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">user</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">BadRequestException</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">provide</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">userData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">useValue</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> user</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line diff add"><span style="color:#BABED8;">    LocalStragety</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">    AuthService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    JwtModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">registerAsync</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#82AAFF;">useFactory</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">secret</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> TOKEN_SECRET</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">signOptions</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">expiresIn</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1d</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line diff add"><span style="color:#BABED8;">    PassportModule</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AuthController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">auth</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">auth</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UseGuards</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AuthGuard</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">local</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)) </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">login</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">body</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">User</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">auth</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">login</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">body</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Inject</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">userData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">userData</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#BABED8;"> user</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">jwtService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">JwtService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">login</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">userDto</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">User</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ”¹é€ ä¸º passport æ–¹æ¡ˆ</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    const user = this.userData?.find((user) =&gt; {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//      return user.name === userDto.name &amp;&amp; user.password === userDto.password;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    });</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    if (!user) {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//      return {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//        errCode: 100053,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//        msg: &#39;ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®&#39;,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//      };</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">generateToken</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">userDto</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">generateToken</span><span style="color:#89DDFF;">({</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">id</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">User</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      token</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">jwtService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">signAsync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> sub</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></div></div><p>é‡æ–°è¯·æ±‚ï¼Œå‘ç°æ•ˆæœå¦‚ä¹‹å‰ä¸€è‡´ï¼Œè¡¨ç¤ºé…ç½®æˆåŠŸï¼Œ<code>nest</code> åœ¨ä½¿ç”¨<code>UseGuard</code> è£…é¥°å™¨ä¸­å¼•ç”¨è¿™ä¸ªåç§°ï¼Œå°±å°†è¯¥ç­–ç•¥ä¸å®ˆå«ä»£ç å…³è”èµ·æ¥äº†ã€‚</p><h4 id="_9-4-4-ç»“åˆå¼‚å¸¸è¿‡æ»¤å™¨" tabindex="-1">9.4.4. ç»“åˆå¼‚å¸¸è¿‡æ»¤å™¨ <a class="header-anchor" href="#_9-4-4-ç»“åˆå¼‚å¸¸è¿‡æ»¤å™¨" aria-label="Permalink to &quot;9.4.4. ç»“åˆå¼‚å¸¸è¿‡æ»¤å™¨&quot;">â€‹</a></h4><p>å®ˆå«ç»“åˆå¼‚å¸¸è¿‡æ»¤å™¨ï¼Œä½œç”¨å°±æ˜¯åœ¨æŠ›å‡ºé”™è¯¯æ—¶ï¼Œä¸å†ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„é”™è¯¯æ ¼å¼ï¼Œè€Œæ˜¯ç”±è‡ªå®šä¹‰æ ¼å¼æ›¿ä»£ã€‚ä¹‹å‰å·²ç»ç»ƒä¹ è¿‡ç­¾å‘ <code>token</code> çš„ä¾‹å­ï¼Œç°åœ¨åªéœ€è¦éªŒè¯ <code>token</code> ï¼Œä¸ç¬¦åˆé¢„æœŸçš„æ ¡éªŒæ—¶ï¼ŒæŠ›å‡ºé”™è¯¯å³å¯ã€‚</p><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªç­–ç•¥ï¼Œç”¨äºéªŒè¯ <code>JWT</code> ç­–ç•¥çš„å®ˆå«ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ExtractJwt</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Strategy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">passport-jwt</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">PassportStrategy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/passport</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpException</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Injectable</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">jwtConstants</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./constant</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">JwtStrategy</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">PassportStrategy</span><span style="color:#BABED8;">(Strategy) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">super</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      jwtFromRequest</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ExtractJwt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fromAuthHeaderAsBearerToken</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      ignoreExpiration</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      secretOrKey</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">jwtConstants</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">secret</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">validate</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">payload</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// jwtéªŒè¯é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æŸ¥è¯¢æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨ç”¨æˆ·</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> userId</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">sub</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li>jwtFromRequestï¼šæä¾›ä»è¯·æ±‚ä¸­æå– <code>token</code> çš„æ–¹æ³•ï¼Œæ— è®ºæ˜¯ä» <code>header</code> çš„ <code>Bearer</code> æˆ–è€… <code>body</code> ä¼ é€’çš„ <code>token</code> ã€‚</li><li>secretOrKeyï¼šåŠ å¯† <code>token</code> çš„ç§é’¥</li><li>validateï¼šæ ¹æ®éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢ <code>token</code> æºå¸¦çš„ <code>userId</code> æ˜¯å¦å­˜åœ¨äºæ•°æ®åº“æ˜¯å¦ä¸ç­¾å‘çš„ <code>token</code> ç›¸åŒ¹é…ã€‚</li></ul><p>æ¥ç€éœ€è¦æ³¨å…¥ <code>jwt</code> çš„ç­–ç•¥éªŒè¯ï¼Œåœ¨æ¨¡å—ä¸­æ³¨å†Œï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">provide</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">userData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">useValue</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> user</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">    LocalStragety</span><span style="color:#89DDFF;">,</span></span>
<span class="line diff add"><span style="color:#BABED8;">    JwtStrategy</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">    AuthService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    JwtModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">registerAsync</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#82AAFF;">useFactory</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">secret</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> jwtConstants</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">secret</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">signOptions</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">expiresIn</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1d</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    PassportModule</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AuthController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸­æ·»åŠ æ¥å£æµ‹è¯•æ˜¯å¦æˆåŠŸï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">auth</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">auth</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">login</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UseGuards</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AuthGuard</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">local</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">))</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">login</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">body</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">User</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">body</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">auth</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">login</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">body</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UseGuards</span><span style="color:#BABED8;">(</span><span style="color:#82AAFF;">AuthGuard</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jwt</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">))</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">profile</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">getProfile</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Request</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>é¦–å…ˆç™»å½•è·å– <code>token</code> ï¼Œç„¶åå†ç”¨è¿™ä¸ª <code>token</code> è®¿é—® <code>jwt</code> ç­–ç•¥çš„æ¥å£ï¼Œæ˜¯å¦èƒ½å¤Ÿè®¿é—®æˆåŠŸï¼š</p><p><img src="`+X+`" alt="image-20231027160831087"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦å®šä¹‰å¼‚å¸¸è¿‡æ»¤å™¨ï¼Œå› ä¸ºç°åœ¨çš„å¼‚å¸¸æ˜¯è¿™æ ·çš„æ ¼å¼ï¼Œæ˜æ˜¾ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸ</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">message</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Unauthorized</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">statusCode</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">401</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>åˆ›å»ºå¼‚å¸¸è¿‡æ»¤ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">ArgumentsHost</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">Catch</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">ExceptionFilter</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">HttpException</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Response</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Request</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Catch</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AuthFilter</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ExceptionFilter</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">catch</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">exception</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">HttpException</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">host</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ArgumentsHost</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å–å¾—ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">host</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">switchToHttp</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å“åº”å¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getResponse</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Response</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// è¯·æ±‚å¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRequest</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Request</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¼‚å¸¸çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">exception</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getStatus</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">response</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å“åº”çŠ¶æ€</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">status</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å“åº”è¿”å›å¾æ–‡</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">exception</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">message</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        method</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">method</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        failed</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        data</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>å‘é€è¯·æ±‚çœ‹çœ‹å¤±è´¥çš„ç”¨ä¾‹ï¼š</p><p><img src="`+z+`" alt="image-20231027161402389"></p><p>å®ˆå«ç»“åˆå¼‚å¸¸è¿‡æ»¤å™¨çš„ä¾‹å­å°±å®Œæˆäº†ã€‚</p><h4 id="_9-4-5-è§’è‰²æƒé™" tabindex="-1">9.4.5. è§’è‰²æƒé™ <a class="header-anchor" href="#_9-4-5-è§’è‰²æƒé™" aria-label="Permalink to &quot;9.4.5. è§’è‰²æƒé™&quot;">â€‹</a></h4><p>å®ˆå«ä¸è‡ªå®šä¹‰å…ƒæ•°æ®ç»“åˆï¼Œå¯ä»¥ä¸ºä¸åŒçš„æ§åˆ¶å™¨æ–¹æ³•å…è®¸æ‰§è¡Œçš„è§’è‰²é€šè¿‡ã€‚ç”± <code>nest</code> æä¾›çš„ <code>@SetMetadata()</code> è£…é¥°å™¨ä¸å®ˆå«ç»“åˆï¼Œåœ¨å®ˆå«å®ç°çš„æ–¹æ³•çš„ä¸Šä¸‹æ–‡å‚æ•° <code>ExecutionContext</code> ä¸­å–å‡ºå…ƒæ•°æ®ï¼Œç»“åˆå®ˆå«è¿›è¡Œè§’è‰²æ ¡éªŒã€‚</p><p>::: code-gruop</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">role</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">RoleController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">roleService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">RoleService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">SetMetadata</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">roles</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">admin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">]) </span><span style="color:#676E95;font-style:italic;">// rolesä¸ºé”®ï¼Œ[&#39;admin&#39;]ä¸ºå€¼</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">findAll</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get method</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">RoleGuard</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CanActivate</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">reflector</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Reflector</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">canActivate</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">context</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ExecutionContext</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">boolean</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Observable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">boolean</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">roles</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">reflector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#F07178;">[]</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">roles</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">context</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getHandler</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ä»ä¸Šä¸‹æ–‡ä¸­å–å‡ºå®ˆå«è®¾ç½®çš„å…ƒæ•°æ®ï¼Œä¹Ÿå°±æ˜¯@SetMetadataä¸­çš„é”®å€¼å¯¹</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">roles</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">context</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">switchToHttp</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRequest</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">matchRoles</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">roles</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">roles</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æ­¤æ–¹æ³•æ ¹æ®ä¸šåŠ¡ä¹¦å†™ï¼Œåœ¨è¿™é‡Œä»…åšé€»è¾‘å±•ç¤º</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">matchRoles</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">roles</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;">[]</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">userRoles</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">roles</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">userRoles</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>:::</p><p>é€šè¿‡ä¸Šé¢çš„æ„å»ºï¼Œè™½ç„¶å¯è¡Œï¼Œä½†æ˜¯ç›´æ¥ä½¿ç”¨ <code>@SetMetadata</code> ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹å¼ï¼Œæˆ‘ä»¬åº”è¯¥è‡ªå®šä¹‰åˆ›å»ºè£…é¥°å™¨ ï¼Œè¿™ç§æ–¹å¼æ›´åŠ ç®€æ´ã€æ˜“è¯»ã€‚</p><blockquote><p>role.decorator.ts</p></blockquote><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">SetMetadata</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> Roles </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(...</span><span style="color:#BABED8;font-style:italic;">roles</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;">[]</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">SetMetadata</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">roles</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> roles)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¿®æ”¹æ§åˆ¶å™¨çš„ <code>@SetMetadata</code></p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line diff add"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Roles</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./role.decorator</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">role</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">RoleController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">roleService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">RoleService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line diff remove"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">SetMetadata</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">roles</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">admin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">]) </span></span>
<span class="line diff add"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Roles</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">admin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">findAll</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">get method</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_9-4-6-æ‹“å±•â€”rbacåŸºäºè§’è‰²æƒé™æ¨¡å‹" tabindex="-1">9.4.6. æ‹“å±•â€”RBACåŸºäºè§’è‰²æƒé™æ¨¡å‹ <a class="header-anchor" href="#_9-4-6-æ‹“å±•â€”rbacåŸºäºè§’è‰²æƒé™æ¨¡å‹" aria-label="Permalink to &quot;9.4.6. æ‹“å±•â€”RBACåŸºäºè§’è‰²æƒé™æ¨¡å‹&quot;">â€‹</a></h4><p><code>Role-base-assess-control</code> åŸºäºç”¨æˆ·çš„æƒé™è®¿é—®æ§åˆ¶ï¼Œæ˜¯ä¸€å¥—æƒé™ç®¡ç†æ¨¡å‹è®¾è®¡æ–¹æ¡ˆï¼Œä¸åŒçš„è§’è‰²æ‹¥æœ‰ä¸åŒçš„æƒé™ï¼Œç”¨æˆ·é€šè¿‡è§’è‰²ä¸æƒé™è¿›è¡Œå…³è”ã€‚ç”¨æˆ·ä¸è§’è‰²ä¸ºå¤šå¯¹å¤šå…³ç³»ï¼Œè§’è‰²ä¸æƒé™åŒæ ·ä¸ºå¤šå¯¹å¤šå…³ç³»ã€‚</p><p>è§’è‰²é€šå¸¸æŒ‡ä¸€ç»„å…·æœ‰æŸäº›ç‰¹å¾çš„é›†åˆï¼Œæ¯”å¦‚ï¼šéƒ¨é—¨/èŒä½/å·¥ä½œèŒè´£ã€‚</p><p><code>RBAC</code> æ¨¡å‹å¯ä»¥æŠ½è±¡æ¦‚æ‹¬ä¸ºï¼šwhoæ˜¯å¦å¯ä»¥å¯¹whatè¿›è¡Œhowçš„è®¿é—®æ“ä½œï¼Œå¹¶å¯¹è¿™ä¸ªè¡¨è¾¾å¼è¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸º<code>True</code> çš„æ±‚è§£è¿‡ç¨‹ã€‚</p><h5 id="æ¨¡å‹å±‚æ¬¡" tabindex="-1">æ¨¡å‹å±‚æ¬¡ <a class="header-anchor" href="#æ¨¡å‹å±‚æ¬¡" aria-label="Permalink to &quot;æ¨¡å‹å±‚æ¬¡&quot;">â€‹</a></h5><p>æ¨¡å‹å®šä¹‰äº†å››ä¸ªç­‰çº§ï¼š</p><ol start="0"><li><p>æœ€å¸¸ç”¨çš„æ‰å¹³åŒ–æ¨¡å‹ï¼Œç”¨æˆ·ä½¿ç”¨è§’è‰²æ¥è·å¾—æƒé™ã€‚</p></li><li><p>åœ¨0çº§ä¹‹ä¸Šï¼Œå¢åŠ äº†è§’è‰²å±‚æ¬¡ç»“æ„ï¼Œæ¯”å¦‚é”€å”®å²—çš„è§’è‰²åˆ†ä¸ºç»ç†ã€æ€»ç›‘ã€æ™®é€šé”€å”®ï¼Œè¿™å°±æ˜¯è§’è‰²çš„æ›´ç»†ç²’åº¦çš„å±‚æ¬¡æ‹†åˆ†ã€‚</p></li><li><p>åœ¨1å±‚ä¹‹ä¸Šï¼Œå¢åŠ äº†èŒè´£åˆ†ç¦»ï¼Œåˆ†ä¸ºåŠ¨æ€å’Œé™æ€çš„èŒè´£åˆ†ç¦»ã€‚</p></li></ol><ul><li>é™æ€èŒè´£ï¼š <ul><li>äº’æ–¥è§’è‰²ï¼šä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰ä¸¤ä¸ªäº’æ–¥çš„è§’è‰²ï¼Œæ¯”å¦‚ä»–æ˜¯è­¦å¯Ÿçš„åŒæ—¶ï¼Œåˆæ˜¯é»‘ç¤¾ä¼šï¼Œé‚£ä¹ˆä»–å°±åªèƒ½é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚</li><li>åŸºæ•°é™åˆ¶ï¼šä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰çš„è§’è‰²æ˜¯æœ‰é™çš„ï¼Œä¸€ä¸ªè§’è‰²æ‹¥æœ‰çš„æƒé™åŒæ ·ä¹Ÿæ˜¯æœ‰é™çš„ã€‚</li><li>å…ˆå†³æ¡ä»¶é™åˆ¶ï¼šç”¨æˆ·æƒ³è¦æ‹¥æœ‰é«˜çº§è§’è‰²ï¼Œå¿…é¡»å…ˆæ‹¥æœ‰ä½çº§è§’è‰²ï¼Œæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·ç›¸å½“ä½“åˆ¶å†…çš„é¢†å¯¼ï¼Œé‚£ä¹ˆä»–å¿…é¡»åœ¨åŸºå±‚å·¥ä½œå¤šå°‘å¹´ï¼Œä¸å…è®¸ç©ºé™é¢†å¯¼ã€‚</li></ul></li><li>åŠ¨æ€èŒè´£ï¼šç”¨æˆ·æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼Œä½†æ˜¯è¿è¡Œæ—¶åªèƒ½æ¿€æ´»ä¸€ä¸ªè§’è‰²ï¼Œæ¯”å¦‚<code>sassç³»ç»Ÿ</code>ï¼Œåªèƒ½é€‰æ‹©ä¸€ä¸ªç§Ÿæˆ·è¿›è¡Œæ“ä½œã€‚</li></ul><ol start="3"><li>ç›¸å½“äº<code>RBAC3 = RBAC1 + RBAC2</code>ï¼Œå¹¶å¢åŠ äº†æƒé™å®¡æŸ¥ã€‚</li></ol><h5 id="ç”¨æˆ·ç»„" tabindex="-1">ç”¨æˆ·ç»„ <a class="header-anchor" href="#ç”¨æˆ·ç»„" aria-label="Permalink to &quot;ç”¨æˆ·ç»„&quot;">â€‹</a></h5><p>åœ¨æ¨¡å‹ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç”¨æˆ·ç»„çš„æ¦‚å¿µï¼Œç”¨æˆ·ç»„æŒ‡çš„æ˜¯ä¸€ç³»åˆ—æ‹¥æœ‰ç›¸åŒè§’è‰²çš„ç”¨æˆ·é›†åˆï¼Œåœ¨0çº§çš„<code>RBACæ¨¡å‹</code>ï¼Œç”¨æˆ·æ˜¯ç›´æ¥ä¸è§’è‰²è¿›è¡Œå…³è”ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”¨æˆ·ç»„æ‰æ˜¯ä¸è§’è‰²è¿›è¡Œç»‘å®šï¼Œè¿™æ ·å°±æ‘†è„±äº†ç”¨æˆ·ä¸è§’è‰²çš„ç›´æ¥å¯¹åº”å…³ç³»ï¼Œå°±ä¸éœ€è¦ç”¨æˆ·æ˜¯å¦å­˜åœ¨çš„å…ˆå†³æ¡ä»¶ï¼Œåªè¦åˆ†é…åˆ°ç”¨æˆ·ç»„çš„ç”¨æˆ·ï¼Œä»–å°±æ‹¥æœ‰å¯¹åº”æƒé™ã€‚</p><h5 id="äº”è¡¨è®¾è®¡" tabindex="-1">äº”è¡¨è®¾è®¡ <a class="header-anchor" href="#äº”è¡¨è®¾è®¡" aria-label="Permalink to &quot;äº”è¡¨è®¾è®¡&quot;">â€‹</a></h5><p>ç»å…¸çš„<code>RBAC</code> æ¨¡å‹ï¼Œåœ¨æ•°æ®åº“è®¾è®¡é‡Œé¢é€šå¸¸æœ‰äº”ç±»è¡¨ï¼Œç”¨æˆ·è¡¨ã€è§’è‰²è¡¨ã€ç”¨æˆ·è§’è‰²å…³è”è¡¨ã€æƒé™è¡¨ã€è§’è‰²æƒé™å…³è”è¡¨ï¼Œè¿™é‡Œçš„æƒé™è¡¨æŒ‡çš„æ˜¯å¤šç§æƒé™ç±»å‹çš„ç»Ÿç§°ï¼Œå¯èƒ½è¿˜ä¼šåŒ…å«æ“ä½œæƒé™ã€åŠŸèƒ½æƒé™ã€æ•°æ®è®¿é—®æ§åˆ¶æƒé™ã€‚</p><p><img src="`+W+`" alt="image-20231014232241708"></p><h3 id="_9-5-interceptor-æ‹¦æˆªå™¨" tabindex="-1">9.5. interceptor æ‹¦æˆªå™¨ <a class="header-anchor" href="#_9-5-interceptor-æ‹¦æˆªå™¨" aria-label="Permalink to &quot;9.5. interceptor æ‹¦æˆªå™¨&quot;">â€‹</a></h3><p>æ‹¦æˆªå™¨æ˜¯å®ç° <code>NestInterceptor</code> æ¥å£çš„ç±»ã€‚</p><p>æ‹¦æˆªå™¨è·Ÿå®ˆå«å¹²ç€åŒæ ·çš„æ´»ï¼Œä½†æ˜¯æ‹¦æˆªå™¨å´å¯ä»¥åœ¨æ–¹æ³•ã€æ§åˆ¶å™¨ã€å“åº”ç»“æœçš„å‰åç»‘å®šé¢å¤–çš„é€»è¾‘ï¼Œæ¯”å¦‚ç­›é€‰å…¥å‚ã€ç»Ÿä¸€æŠ›å‡ºå¼‚å¸¸ã€è½¬æ¢å‚æ•°ã€ç»Ÿä¸€å“åº”ç»“æœç­‰ç­‰ä¾‹å­ã€‚</p><p>æ‹¦æˆªå™¨çš„æ‰§è¡Œæ—¶æœºæ˜¯æ ¹æ® <code>next.handle()</code> æ˜¯å¦è¢«è°ƒç”¨æ¥å†³å®šçš„ï¼Œåœ¨è°ƒç”¨ä¹‹å‰ï¼Œä¼šåœ¨è·¯ç”±æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼›åœ¨è°ƒç”¨ä¹‹åï¼Œåœ¨è·¯ç”±æ–¹æ³•ä¹‹åæ‰§è¡Œã€‚</p><p>å­¦ä¹ æ‹¦æˆªå™¨éœ€è¦ä½ å¯¹ <code>rxjs</code> æœ‰ä¸€å®šçš„äº†è§£ï¼ˆç„è¿‡æ–‡æ¡£çš„ç¨‹åº¦ï¼‰ã€‚</p><h4 id="_9-5-1-åˆ‡é¢-aop" tabindex="-1">9.5.1. åˆ‡é¢ï¼ˆAOPï¼‰ <a class="header-anchor" href="#_9-5-1-åˆ‡é¢-aop" aria-label="Permalink to &quot;9.5.1. åˆ‡é¢ï¼ˆAOPï¼‰&quot;">â€‹</a></h4><p>æ‹¦æˆªå™¨å¯ä»¥åœ¨æ§åˆ¶å™¨ã€è·¯ç”±æ–¹æ³•ã€æ¨¡å—ã€å“åº”å‰åæ·»åŠ é¢å¤–çš„é€»è¾‘ï¼Œç§°ä¹‹ä¸º <code>AOP</code> åˆ‡é¢ç¼–ç¨‹ã€‚å½“æˆ‘ä»¬éœ€è¦è®°å½•ä¸åº”ç”¨çš„äº¤äº’æ—¶ï¼Œæ‹¦æˆªå™¨å°±æ˜¾å¾—å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•ï¼Œèº«ä»½æˆæƒå’ŒéªŒè¯ï¼Œç¼“å­˜ï¼Œå¼‚å¸¸å¤„ç†ï¼Œæ€§èƒ½ç›‘æ§ï¼Œè¯·æ±‚é‡è¯•è¶…æ—¶å¤„ç†ï¼Œå“åº”ç»“æœå°è£…ç­‰ç­‰å¸¸ç”¨çš„åœºæ™¯ã€‚</p><p>åˆ›å»ºä¸€ä¸ªç®€å•çš„æ—¥å¿—è®°å½•ä¾‹å­ <code>logging.interceptor.ts</code></p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">CallHandler</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">ExecutionContext</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">Injectable</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">Logger</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">NestInterceptor</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Observable</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">tap</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rxjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> dayjs </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dayjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">LoggerInterceptor</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestInterceptor</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">logger</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Logger</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">intercept</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">context</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ExecutionContext</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">next</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CallHandler</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Observable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">start</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">dayjs</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">handle</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">tap</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">response</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">host</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">context</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">switchToHttp</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// è·å–è¯·æ±‚çš„ä¸»æœº</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">host</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRequest</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// è·å–è¯·æ±‚å‚æ•°</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">responseTime</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">dayjs</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">diff</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">start</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å“åº”æ—¶é—´ï¼Œè¯·æ±‚æ—¶é—´ - å½“å‰æ—¶é—´ = å“åº”æ—¶é—´</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// æ—¥å¿—è¾“å‡º è¯·æ±‚æ–¹æ³• è¯·æ±‚è·¯å¾„ å“åº”æ—¶é—´ms å“åº”æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">logger</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">\`\${</span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">method</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">responseTime</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">ms </span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">response</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œæ‹¦æˆªå™¨çš„ä½œç”¨åŸŸåˆ†ä¸ºä¸‰ç§ï¼šæ–¹æ³•ã€æ§åˆ¶å™¨ã€å…¨å±€</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 1. æ–¹æ³•ä½œç”¨åŸŸ</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">logger</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">LoggerController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UseInterceptors</span><span style="color:#BABED8;">(LoggerInterceptor) </span><span style="color:#676E95;font-style:italic;">// æ³¨å†Œæ‹¦æˆªå™¨</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">findAll</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">loggerService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">findAll</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 2. æ§åˆ¶å™¨ä½œç”¨åŸŸ</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [LoggerController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [LoggerService</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> Logger]</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// ä¾èµ–æ³¨å…¥</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">LoggerModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 3.1. å…¨å±€ä½œç”¨åŸŸ-æ— ä¾èµ–æ³¨å…¥</span></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">useGlobalInterceptors</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">LoggerInterceptor</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Logger</span><span style="color:#BABED8;">()))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 3.2. å…¨å±€ä½œç”¨åŸŸ-ä¾èµ–æ³¨å…¥ï¼šæ³¨å†Œæ–¹æ³•éœ€è¦åœ¨æ ¹æ¨¡å—ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼å…¨å±€æ³¨å†Œ</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [LoggerModule]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    AppService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">provide</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> APP_INTERCEPTOR</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">useClass</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> LoggerInterceptor</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p><img src="`+Z+'" alt="image-20231018114148973"></p><h4 id="_9-5-2-å“åº”æ‹¦æˆª-å°è£…å“åº”ç»“æœ" tabindex="-1">9.5.2. å“åº”æ‹¦æˆªï¼ˆå°è£…å“åº”ç»“æœï¼‰ <a class="header-anchor" href="#_9-5-2-å“åº”æ‹¦æˆª-å°è£…å“åº”ç»“æœ" aria-label="Permalink to &quot;9.5.2. å“åº”æ‹¦æˆªï¼ˆå°è£…å“åº”ç»“æœï¼‰&quot;">â€‹</a></h4><p>å¯¹å“åº”ç»“æœç»Ÿä¸€å°è£…ï¼Œç¬¦åˆ <code>REST</code> çš„é£æ ¼ã€‚å‰ç«¯æ¥å£è¯·æ±‚åç«¯ï¼Œåç«¯å°†è¿”å›ç»“æœ<strong>ç»Ÿä¸€å°è£…</strong>ã€‚æé«˜äº¤äº’çš„<strong>è§„èŒƒæ€§</strong>åŠ<strong>é€šç”¨æ€§</strong>ï¼Œä¹Ÿæé«˜äº†å‰åç«¯<strong>è”è°ƒæ•ˆç‡</strong>ã€‚</p><p>å‰ç«¯æ ¹æ®è§„èŒƒæ ¼å¼è¿”å›ç»“æ„ä½“è¿›è¡Œç»Ÿä¸€æ˜ å°„å¤„ç†ï¼Œå°±é¿å…ä¸€ä¸ªæ¥å£ä¸€ä¸ªè¿”å›æ ¼å¼çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨äº† <code>TypeScript</code> åï¼Œå‰ç«¯å¯ä»¥ç»™å“åº”ç»“æœå¥—ä¸Šæ³›å‹ï¼Œåªéœ€è¦è·å– <strong>fetch api</strong> çš„ç±»å‹ä½œä¸ºæ³›å‹ä¼ é€’ï¼Œå¤§å¤§æ–¹ä¾¿å¼€å‘ã€‚</p><p><img src="'+$+`" alt="image-20231025120416451"></p><p>æ‰€ä»¥å°è£…å“åº”ç»“æœéœ€è¦åœ¨è°ƒç”¨ <code>next.handle()</code> åï¼Œé€šè¿‡ <code>rxjs</code> çš„ <code>pipe</code> ç®¡é“æ‹¿åˆ°å“åº”åçš„æ•°æ®è¿›è¡Œç»Ÿä¸€å°è£…ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">enum</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">HttpStatusEnum</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  SUCCESS </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  NOT_CONTENT </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">204</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  SEE_OTHER </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">303</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  BAD_REQUEST </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">400</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  UNAUTHORIZED </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">401</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  FORBIDDEN </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">403</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  NOT_FOUND </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">404</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  INTERNAL_SERVER_ERROR </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">500</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">message</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯æ—¶å‡ºç°</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">PUT</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DELETE</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">PATCH</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯æ—¶å‡ºç°</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">failed</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯æ—¶å‡ºç°</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ResultPackagingInterceptor</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestInterceptor</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">intercept</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">context</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ExecutionContext</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">next</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CallHandler</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Observable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ‹¦æˆªå™¨å‰</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">handle</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">):</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ‹¦æˆªå™¨å</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">message</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">message</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ“ä½œæˆåŠŸ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          status</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpStatusEnum</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">SUCCESS</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#BABED8;">message</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>æ³¨å†Œæ‹¦æˆªå™¨ï¼Œå®šä¹‰è·¯ç”±æ–¹æ³•</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ResultPackagingInterceptor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./result-packaging.interceptor</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">result-packaging</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UseInterceptors</span><span style="color:#BABED8;">(ResultPackagingInterceptor)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ResultPackagingController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">resultPackagingService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ResultPackagingService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">findAll</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">è·¯ç”±æ–¹æ³•</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¼ ä¸‰</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      age</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">18</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>ç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img src="`+ss+`" alt="image-20231018162032890"></p><h4 id="_9-5-3-è¶…æ—¶å¤„ç†" tabindex="-1">9.5.3. è¶…æ—¶å¤„ç† <a class="header-anchor" href="#_9-5-3-è¶…æ—¶å¤„ç†" aria-label="Permalink to &quot;9.5.3. è¶…æ—¶å¤„ç†&quot;">â€‹</a></h4><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">TimeoutInterceptor</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestInterceptor</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">intercept</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">context</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ExecutionContext</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">next</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CallHandler</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Observable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">timeoutVal</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">context</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">switchToHttp</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRequest</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">timeout</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">3000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">handle</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">timeout</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">timeoutVal</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">catchError</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">err</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">instanceof</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">TimeoutError</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">RequestTimeoutException</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">è¯·æ±‚è¶…æ—¶</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">throwError</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>æ³¨å†Œæ‹¦æˆªå™¨ï¼Œä¼ªä»£ç å®ç°è¯·æ±‚è¶…æ—¶</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">timeout</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UseInterceptors</span><span style="color:#BABED8;">(TimeoutInterceptor)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">TimeoutController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">timeoutService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">TimeoutService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">findAll</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">resolve</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">4000</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 6 seconds</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      user</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¼ ä¸‰</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      age</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">18</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img src="`+ns+`" alt="image-20231018164333693"></p><h4 id="_9-5-4-ç¼“å­˜" tabindex="-1">9.5.4. ç¼“å­˜ <a class="header-anchor" href="#_9-5-4-ç¼“å­˜" aria-label="Permalink to &quot;9.5.4. ç¼“å­˜&quot;">â€‹</a></h4><p>ç”¨é»˜è®¤ä½œç”¨åŸŸçš„æœåŠ¡æ¥æ¨¡æ‹Ÿ <code>redis</code> ç¼“å­˜ï¼Œå®šä¹‰ä¸€ä¸ªç¼“å­˜æœåŠ¡ï¼š<code>cache.service.ts</code>æ¨¡æ‹Ÿå­˜å–è¡Œä¸º</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CacheService</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">cacheData</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Record</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">getCache</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">cacheData</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">getCacheItem</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">cacheData</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">public</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">setCache</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">cacheData</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­æŸ¥æ‰¾æ•°æ®</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">findOne</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¼ ä¸‰</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æå››</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç‹äº”</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    ]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">item</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">id</span><span style="color:#F07178;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>è‡ªå®šä¹‰è£…é¥°å™¨ï¼Œä½œç”¨äºè·¯ç”±æ–¹æ³•ä¸Šï¼Œæ ‡è¯†è¯¥æ–¹æ³•æ˜¯å¦éœ€è¦å¼€å¯ç¼“å­˜é€»è¾‘ï¼š<code>decorators.ts</code></p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> IsCanCache </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">canCache</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">SetMetadata</span><span style="color:#BABED8;">(CACHE_KEY</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> canCache)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è·¯ç”±æ–¹æ³•ï¼Œæ¨¡æ‹Ÿè¯·æ±‚æœåŠ¡ï¼Œå¹¶è¿”å›æ¨¡æ‹Ÿæ•°æ®ï¼ˆæ¨¡æ‹Ÿä»æ•°æ®åº“æŸ¥å‡ºï¼‰</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cache</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">UseInterceptors</span><span style="color:#BABED8;">(CacheInterceptor)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CacheController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">cacheService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CacheService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">IsCanCache</span><span style="color:#BABED8;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">cacheData</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#BABED8;font-style:italic;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">cacheService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">findOne</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">+</span><span style="color:#BABED8;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>æ‹¦æˆªå™¨å®ç°æœ€å°ç¼“å­˜æ¡ˆä¾‹ï¼ˆå®é™…å¼€å‘ä¼šæ¯”è¿™æ›´å¤æ‚ï¼‰ï¼š<code>cache.interceptor.ts</code></p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> CACHE_KEY </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Symbol</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">CACHE_KEY</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Injectable</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CacheInterceptor</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">NestInterceptor</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">cacheService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CacheService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">intercept</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">context</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ExecutionContext</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">next</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CallHandler</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Observable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">isCanCache</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#BABED8;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getMetadata</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">CACHE_KEY</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">context</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getHandler</span><span style="color:#F07178;">()) </span><span style="color:#89DDFF;">||</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#BABED8;">Reflect</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getMetadata</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">CACHE_KEY</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">context</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getClass</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// åˆ¤æ–­æ¥å£æ–¹æ³•æ˜¯å¦éœ€è¦èµ°ç¼“å­˜é€»è¾‘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">context</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">switchToHttp</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRequest</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">isCanCache</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// éœ€è¦èµ°ç¼“å­˜</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">cacheKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">redisCacheKey</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">method</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">cacheData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">cacheService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getCacheItem</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">cacheKey</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">cacheData</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œå¦‚æœè¿™æ¡æ‰“å°äº†ï¼Œè¯æ˜æ˜¯æœ‰ç¼“å­˜çš„å­˜åœ¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">cacheData</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// æ— ç¼“å­˜æ—¶ï¼ŒæŠŠæ•°æ®è®¾ç½®ä¸ºç¼“å­˜</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">handle</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">cacheService</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCache</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">cacheKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// å–å‡ºç¼“å­˜ï¼Œç›´æ¥è¿”å›</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">of</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">cacheData</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">next</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">handle</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">redisCacheKey</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">method</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">url</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`\${</span><span style="color:#BABED8;">method</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">url</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>ç»“æœå¦‚ä¸‹å›¾ï¼š</p><p><img src="`+as+`" alt="image-20231018181527028"></p><p>å‚è€ƒï¼š<a href="https://github.com/kuangshp/nest-api-cache" target="_blank" rel="noreferrer">kuangshp/nest-api-cache: nestä¸­å€Ÿç”¨rediså®ç°apiæ¥å£ç¼“å­˜ (github.com)</a></p><h3 id="_9-6-pipe-ç®¡é“" tabindex="-1">9.6. pipe ç®¡é“ <a class="header-anchor" href="#_9-6-pipe-ç®¡é“" aria-label="Permalink to &quot;9.6. pipe ç®¡é“&quot;">â€‹</a></h3><p>ç®¡é“ï¼ˆPipesï¼‰æ˜¯ä¸€ç§ç”¨äºå¤„ç†è¾“å…¥æ•°æ®çš„æœºåˆ¶ã€‚ç®¡é“å…è®¸ä½ å¯¹è¿›å…¥åº”ç”¨ç¨‹åºçš„æ•°æ®è¿›è¡Œè½¬æ¢ã€éªŒè¯å’Œè½¬å˜ã€‚å®ƒå°±åƒä¸€æ ¹æ°´ç®¡ï¼Œæ•°æ®ä»å¼€ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰å¤„æµå…¥ï¼Œç»è¿‡ç®¡é“å¤„ç†ä¹‹åï¼Œä»ç®¡é“çš„æœ«ç«¯æµå‡ºä¾›ç»™ <code>nest</code> ç¨‹åºä½¿ç”¨ã€‚</p><p>å®ƒä»¬æ˜¯NestJSä¸­çš„ä¸€ç§é‡è¦æ¦‚å¿µï¼Œç”¨äºå¸®åŠ©ä¿è¯è¾“å…¥æ•°æ®çš„æœ‰æ•ˆæ€§å’Œä¸€è‡´æ€§ã€‚</p><p>ç®¡é“æœ‰ä¸¤ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯ï¼š</p><ul><li>è½¬æ¢ï¼šç®¡é“å°†è¾“å…¥æ•°æ®è½¬æ¢ä¸ºä½ æ‰€éœ€è¦çš„æ•°æ®è¾“å‡ºï¼Œæ¯”å¦‚æ•°å­—è½¬å­—ç¬¦ã€‚</li><li>éªŒè¯ï¼šå¯¹è¾“å…¥çš„æ•°æ®è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯æˆåŠŸç»§ç»­ä¼ é€’ï¼ŒéªŒè¯å¤±è´¥åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><p>è¿™äº›æ•°æ®æ˜¯ç”±æ§åˆ¶å™¨çš„è·¯ç”±æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œ<code>nest</code> åœ¨è°ƒç”¨è¿™äº›è·¯ç”±æ–¹æ³•ä¹‹å‰æ’å…¥ç®¡é“ï¼Œç®¡é“ä¼šæ‹¦æˆªæ–¹æ³•çš„è°ƒç”¨ï¼Œç„¶åè¿›è¡Œå¤„ç†åï¼Œå°†å¤„ç†åçš„æ•°æ®è°ƒç”¨åŸæ–¹æ³•ã€‚</p><p>å®é™…ä¸Šå°±æ˜¯é€šè¿‡å‚æ•°è£…é¥°å™¨ï¼Œåœ¨è·¯ç”±æ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼Œå¯¹ç®¡é“ä½¿ç”¨ <code>Reflect.metadata</code> å‚¨å­˜èµ·æ¥ï¼Œç„¶ååœ¨æ•°æ®ä¼ è¾“ï¼ˆå¦‚ï¼š<code>@Query</code>ï¼‰æ—¶è¿›è¡Œå¤„ç†ã€‚</p><h4 id="_9-6-1-å†…ç½®ç®¡é“" tabindex="-1">9.6.1. å†…ç½®ç®¡é“ <a class="header-anchor" href="#_9-6-1-å†…ç½®ç®¡é“" aria-label="Permalink to &quot;9.6.1. å†…ç½®ç®¡é“&quot;">â€‹</a></h4><p><code>nest</code> å†…ç½®äº†å‡ ä¸ªå¼€ç®±å³ç”¨çš„ç®¡é“ï¼Œåˆ†åˆ«ä¸ºï¼š</p><ul><li><code>ValidationPipe</code>ï¼šç»“æ„éªŒè¯ï¼Œæœ‰ç±»ç»“æ„å’Œå¯¹è±¡ç»“æ„çš„éªŒè¯ï¼Œå¯å¯¹ <code>DTO</code> è¿›è¡Œå±æ€§é™åˆ¶éªŒè¯ã€‚</li><li><code>ParseIntPipe</code>ï¼šå°†æ•°æ®è½¬æ¢ä¸º <code>Number</code> ç±»å‹ã€‚</li><li><code>ParseFloatPipe</code>ï¼šå°†æ•°æ®è½¬æ¢ä¸º <code>Float</code> æµ®ç‚¹ç±»å‹ã€‚</li><li><code>ParseBoolPipe</code>ï¼šå°†æ•°æ®è½¬æ¢ä¸º <code>Boolean</code> å¸ƒå°”ç±»å‹ï¼Œç¬¦åˆ <code>ES</code> çš„éšå¼è½¬æ¢ã€‚</li><li><code>ParseArrayPipe</code>ï¼šå°†æ•°æ®è½¬æ¢ä¸º <code>Array</code> æ•°ç»„ç±»å‹ã€‚</li><li><code>ParseUUIDPipe</code>ï¼šå°†æ•°æ®è½¬æ¢ä¸º <code>UUID</code> ç±»å‹ã€‚</li><li><code>ParseEnumPipe</code>ï¼šå°†æ•°æ®è½¬æ¢ä¸º <code>Enum</code> æšä¸¾ç±»å‹ã€‚</li><li><code>DefaultValuePipe</code>ï¼šæä¾›é»˜è®¤å€¼ï¼Œå½“æ¥æ”¶åˆ°<code>null</code> æˆ– <code>undefined</code> æ—¶ï¼Œç¨‹åºå¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä¸ºäº†ç¨‹åºæ­£å¸¸è¿è¡Œï¼Œå¯ä»¥ç»™å‚æ•°æä¾›é»˜è®¤å€¼ã€‚</li></ul><p>å¦‚æœè½¬æ¢å¤±è´¥ï¼Œåˆ™ä¼šæŠ›å‡ºç±»å‹ä¸ç¬¦çš„å¼‚å¸¸ã€‚</p><h4 id="_9-6-2-åŸºæœ¬ä½¿ç”¨" tabindex="-1">9.6.2. åŸºæœ¬ä½¿ç”¨ <a class="header-anchor" href="#_9-6-2-åŸºæœ¬ä½¿ç”¨" aria-label="Permalink to &quot;9.6.2. åŸºæœ¬ä½¿ç”¨&quot;">â€‹</a></h4><p>ç®¡é“å¯ä»¥æ˜¯å‚æ•°ä½œç”¨åŸŸã€æ–¹æ³•ä½œç”¨åŸŸã€æ§åˆ¶å™¨ä½œç”¨åŸŸæˆ–æ˜¯å…¨å±€ä½œç”¨åŸŸï¼ˆå¦‚æœè¦ç”¨åˆ°ä¾èµ–æ³¨å…¥æ—¶ï¼Œè¦åœ¨ <code>app.module</code> ä¸­ä½¿ç”¨è‡ªå®šä¹‰ä¾èµ–æ³¨å…¥ï¼‰ï¼Œä¸å‚æ•°ä½œç”¨åŸŸè¿›è¡Œæ­é…æ—¶ï¼Œç›´æ¥ä½œä¸ºå‚æ•°ä¼ é€’å³å¯ï¼Œå…¶ä»–ä½œç”¨åŸŸåˆ™éœ€è¦ <code>@UsePipe</code> è£…é¥°å™¨ã€‚</p><p>å…¨å±€å±‚é¢æœ‰ä¸¤ç§æ³¨å†Œæ–¹æ³•ï¼šä¾èµ–æ³¨å…¥å’Œå…¨å±€ä½¿ç”¨</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æ ¹æ¨¡å—ä¾èµ–æ³¨å…¥æ³¨å†Œ</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Module</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">imports</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [PipesModule]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">controllers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [AppController]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">providers</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">    AppService</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">      </span><span style="color:#F07178;">provide</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> APP_PIPE</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">useClass</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> xxx</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">AppModule</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å…¨å±€æ³¨å†Œ</span></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">useGlobalPipes</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">xxx</span><span style="color:#BABED8;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>ä¾‹å­ä»‹ç»å¸¸ç”¨çš„ <code>ParseIntPipe</code> å’Œç‰¹æ®Šçš„ <code>ParseArrayPipeã€ParseEnumPipeã€DefaultValuePipe</code> çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ã€‚</p><details class="details custom-block"><summary>å±•å¼€æŸ¥çœ‹æ¨¡æ‹Ÿæ•°æ®</summary><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">enum</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Gender</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  male </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">male</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  female </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">female</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> users </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç‹æ´‹</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">gender</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Gender</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">male</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æç§€è‹±</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">gender</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Gender</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">female</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ¨æ•</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">gender</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Gender</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">female</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å´é™</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">gender</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Gender</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">female</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">é»„æ•</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">gender</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Gender</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">female</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></details><h5 id="parseintpipe" tabindex="-1">ParseIntPipe <a class="header-anchor" href="#parseintpipe" aria-label="Permalink to &quot;ParseIntPipe&quot;">â€‹</a></h5><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Gender</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">users</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./pipe.contant</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pipes</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipesController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">pipesService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipesService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">int</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">testIntPipe</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#BABED8;font-style:italic;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">users</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">item</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// httpä¼ è¾“é»˜è®¤ä»¥stringä¼ é€’ï¼Œæ¥å£ä¼ é€’çš„idç±»å‹å³ä¸ºstring</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">user</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">HttpException</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç”¨æˆ·ä¸å­˜åœ¨</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">BAD_REQUEST</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>åœ¨è¿˜æ²¡æœ‰ä½¿ç”¨ç®¡é“æ—¶ï¼Œå‘é€è¯·æ±‚ä¼šæŠ¥æ‰¾ä¸åˆ°ç”¨æˆ·çš„é”™è¯¯ï¼š</p><p><img src="`+ls+`" alt="image-20231025221934828"></p><p>å½“æˆ‘ä»¬åœ¨å‚æ•°ä½œç”¨åŸŸä¸Šæ·»åŠ ä¸Šç®¡é“å‡½æ•°</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">int</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line highlighted"><span style="color:#82AAFF;">testIntPipe</span><span style="color:#BABED8;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> ParseIntPipe) id: number) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">users</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">item</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">user</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">HttpException</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç”¨æˆ·ä¸å­˜åœ¨</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">BAD_REQUEST</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>è¿›è¡ŒéªŒè¯ä»¥åŠè½¬æ¢æ—¶ï¼Œå°±ä¼šæ­£å¸¸è¿”å›ç”¨æˆ·ï¼š</p><p><img src="`+ps+`" alt="image-20231025222131864"></p><p>å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨è¿™ç§æ‰‹åŠ¨æŠ›é”™çš„åšæ³•ï¼Œä¹Ÿæƒ³æ ¡éªŒå‚æ•°å‘¢ï¼Ÿå°±éœ€è¦å®ä¾‹åŒ–ç®¡é“å‡½æ•°ï¼Œå¹¶å°†å…¶ä»–å‚æ•°ä½œä¸º <code>options</code> ä¼ é€’</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">int</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#82AAFF;">testIntPipe</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">  @</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ParseIntPipe</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æŒ‡å®šçŠ¶æ€ç </span></span>
<span class="line diff add"><span style="color:#BABED8;">      </span><span style="color:#F07178;">errorHttpStatusCode</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">BAD_GATEWAY</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æŒ‡å®šçŠ¶æ€ç åŒæ—¶æŒ‡å®šé”™è¯¯ä¿¡æ¯</span></span>
<span class="line diff add"><span style="color:#BABED8;">      </span><span style="color:#82AAFF;">exceptionFactory</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span></span>
<span class="line diff add"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">HttpException</span><span style="color:#BABED8;">( </span></span>
<span class="line diff add"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">è‡ªå®šä¹‰è¿”å›å“åº”é”™è¯¯ä¿¡æ¯â€”â€”ç”¨æˆ·ä¸å­˜åœ¨</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line diff add"><span style="color:#BABED8;">        HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">BAD_GATEWAY</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line diff add"><span style="color:#BABED8;">      )</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  )</span></span>
<span class="line"><span style="color:#BABED8;">  id: number</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">users</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">item</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line diff remove"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">user</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span></span>
<span class="line diff remove"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">HttpException</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç”¨æˆ·ä¸å­˜åœ¨</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">BAD_REQUEST</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line diff remove"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>é‡æ–°è¯·æ±‚ï¼Œè¿”å›ç»“æœä¸ä¹‹å‰ä¸€è‡´ã€‚å…¶ä»–çš„ç®¡é“å‡½æ•°å¦‚æœéœ€è¦è‡ªå®šä¹‰çŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯ï¼Œè·Ÿä¸Šé¢çš„æ“ä½œæ­¥éª¤ä¸€è‡´ã€‚</p><h5 id="parsearraypipe" tabindex="-1">ParseArrayPipe <a class="header-anchor" href="#parsearraypipe" aria-label="Permalink to &quot;ParseArrayPipe&quot;">â€‹</a></h5><p>è¯¥ç®¡é“éœ€è¦å®‰è£…ä¸¤ä¸ªä¾èµ–ï¼Œ<code>class-validator</code>ã€<code>class-transformer</code>ã€‚</p><p>è¯¥ç®¡é“å¯ä»¥æ¥å—è·¯ç”±å‚æ•°ä¼ é€’ä»¥ç‰¹å®šæ ¼å¼ä¼ é€’çš„å‚æ•°ï¼š <code>/pipes?ids=1,2,3</code> ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶ <code>Body</code> ç±»å‹çš„å‚æ•°ï¼š<code>{ ids:[1,2,3] }</code>ï¼Œåœ¨ç®¡é“å‡½æ•°ä¸­éƒ½èƒ½å¯¹è¿™äº›å‚æ•°è¿›è¡ŒéªŒè¯å’Œè½¬æ¢</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="`+os+`" alt="image-20231022171508939"></p><p>æˆ‘ä»¬è¿˜å¯ä»¥ä¸ä¼ é€’æ•°ç»„æ ¼å¼ï¼Œè€Œæ˜¯è®©å‚æ•°ä»¥ç‰¹å®šçš„æ–¹å¼è¿›è¡Œæ‹¼æ¥ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ <code>join</code> æ–¹æ³•ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Gender</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">users</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./pipe.contant</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pipes</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipesController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">pipesService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipesService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">arr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">testArrPipe</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ids</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ParseArrayPipe</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">items</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Number</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">separator</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">))</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">ids</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#BABED8;">[]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">users</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">item</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ids</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">id</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>é¦–å…ˆå°è¯•ä¸€ä¸‹é”™è¯¯çš„è¯·æ±‚ï¼Œå‘é€ä¸€ä¸ªå‚æ•°ä¸ä¸º <code>,</code> æ‹¼æ¥çš„æ•°ç»„ï¼Œç„¶åå†å‘é€ä¸€ä¸ªæˆåŠŸçš„è¯·æ±‚ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="`+es+`" alt="image-20231026230137786"></p><h5 id="parseenumpipe" tabindex="-1">ParseEnumPipe <a class="header-anchor" href="#parseenumpipe" aria-label="Permalink to &quot;ParseEnumPipe&quot;">â€‹</a></h5><p>ç”¨æšä¸¾ç®¡é“è½¬æ¢çš„å¥½å¤„ï¼Œé™åˆ¶å‚æ•°çš„èŒƒå›´ã€è½¬æ¢å‚æ•°é™å®šä¸ºæšä¸¾ç±»å‹</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Gender</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">users</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./pipe.contant</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pipes</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipesController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">pipesService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipesService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">enum</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">testEnumPipe</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">gender</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ParseEnumPipe</span><span style="color:#BABED8;">(Gender)) </span><span style="color:#BABED8;font-style:italic;">gender</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Gender</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">users</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">item</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">gender</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">gender</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><img src="`+rs+`" alt="image-20231025223655594"></p><h5 id="defaultvaluepipe" tabindex="-1">DefaultValuePipe <a class="header-anchor" href="#defaultvaluepipe" aria-label="Permalink to &quot;DefaultValuePipe&quot;">â€‹</a></h5><p>å¦‚æœå‰ç«¯ä¸ä¼ é€’å‚æ•°ï¼Œåå°åœ¨å¤„ç†æ—¶ï¼Œä¼šå› ä¸ºè¿™ä¸ª <code>null</code> æˆ– <code>undefined</code> å€¼è¿›è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æœ‰æ—¶ç¨‹åºå¸Œæœ›æ­£å¸¸èµ°ä¸‹å»ï¼Œæ‰€ä»¥éœ€è¦æä¾›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤çš„æƒ…å†µã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">users</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./pipe.contant</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pipes</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipesController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">private</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">readonly</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">pipesService</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipesService</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">default-val</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">testDefaultValPipe</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Query</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">DefaultValuePipe</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">)) </span><span style="color:#BABED8;font-style:italic;">id</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">users</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">item</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>åœ¨æˆ‘ä»¬ä¸ä¼ é€’ <code>id</code> å‚æ•°æ—¶ï¼Œç®¡é“ä¼šä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„é»˜è®¤å‚æ•°ï¼š<code>id=1</code></p><p><img src="`+cs+`" alt="image-20231025223936193"></p><h4 id="_9-6-3-è‡ªå®šä¹‰ç®¡é“" tabindex="-1">9.6.3. è‡ªå®šä¹‰ç®¡é“ <a class="header-anchor" href="#_9-6-3-è‡ªå®šä¹‰ç®¡é“" aria-label="Permalink to &quot;9.6.3. è‡ªå®šä¹‰ç®¡é“&quot;">â€‹</a></h4><p><code>nest</code> æä¾›äº†ä¸€äº›å†…ç½®çš„ç®¡é“ï¼Œæœ¬èŠ‚ä¼šä»å¤´å¼€å§‹æ„å»ºè‡ªå®šä¹‰ç‰ˆæœ¬ï¼Œäº†è§£å¦‚ä½•æ„å»ºç®¡é“å‡½æ•°ã€‚</p><p>åœ¨ä¸Šä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬æåˆ°ç®¡é“çš„ä½œç”¨åŸŸï¼Œä»¥åŠå…¶ä»–ä½œç”¨åŸŸçš„ç®¡é“æ³¨å†Œæ–¹æ³•ï¼Œåœ¨æœ¬å°èŠ‚ä¸­ï¼Œå°†ä½œç”¨åŸŸæå‡åˆ°å…¨å±€ä¸Šï¼ˆä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼‰</p><p>é¦–å…ˆå®ç°è‡ªå®šä¹‰ç®¡é“å‡½æ•°ï¼Œæ‰€æœ‰çš„ç®¡é“å‡½æ•°éƒ½éœ€è¦å®ç° <code>PipeTransform</code> æ¥å£ï¼šå…ˆä¸å®ç°ç®¡é“å‡½æ•°çš„é€»è¾‘</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UserPipe</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipeTransform</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">transform</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">metadata</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ArgumentMetadata</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>value</code> å‚æ•°æ˜¯å½“å‰å¤„ç†çš„æ–¹æ³•å‚æ•°(åœ¨è¢«è·¯ç”±å¤„ç†ç¨‹åºæ–¹æ³•æ¥æ”¶ä¹‹å‰)ï¼Œ<code>metadata</code> æ˜¯å½“å‰å¤„ç†çš„æ–¹æ³•å‚æ•°çš„å…ƒæ•°æ®ã€‚å…ƒæ•°æ®å¯¹è±¡å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">interface</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ArgumentMetadata</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">body</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">query</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">param</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">metatype</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Type</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">unknown</span><span style="color:#89DDFF;">&gt;;</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>typeï¼šå‘Šè¯‰æˆ‘ä»¬å‚æ•°æ˜¯ä» <code>body-@Bodyã€query-@Queryã€param-@Param</code> æˆ– <code>custom</code> è‡ªå®šä¹‰å‚æ•°ã€</li><li>metatypeï¼šå‚æ•°çš„å…ƒç±»å‹( <code>JS</code> çš„æ•°æ®ç±»å‹)ï¼Œä¹Ÿå°±æ˜¯ <code>bã€qã€p</code> é™å®šçš„ç±»å‹ï¼Œå³ <code>@Query(&quot;id&quot;) id:nubmer</code></li><li>dataï¼šä¼ é€’ç»™ <code>bã€qã€p</code> è£…é¥°å™¨çš„å­—ç¬¦ï¼Œéœ€è¦ä»å‚æ•°ä¸­æå–çš„ç±»å‹ï¼Œå³ <code>@Query(&quot;id&quot;)</code> çš„é‚£ä¸ª <code>id</code>ï¼Œå¦‚æœç•™ç©ºåˆ™æ˜¯ <code>undefined</code></li></ul><p>æ¥ä¸‹æ¥å®ç°ç®¡é“å‡½æ•°çš„æ ¡éªŒé€»è¾‘ï¼šæ ¡éªŒæ·»åŠ ç”¨æˆ·çš„ä¸¤ä¸ªå‚æ•°æ˜¯å¦å­˜åœ¨</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">ArgumentMetadata</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">HttpException</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">PipeTransform</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UserPipe</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipeTransform</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">transform</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">metadata</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ArgumentMetadata</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">HttpException</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç”¨æˆ·åå¹¶ä¸èƒ½ä¸ºç©º</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">BAD_REQUEST</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">password</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">HttpException</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¯†ç å¹¶ä¸èƒ½ä¸ºç©º</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">BAD_REQUEST</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>å¹¶æ³¨å†Œç®¡é“ï¼Œä½¿ç”¨å…¨å±€ä½œç”¨åŸŸï¼šç”±äºæ²¡æœ‰ä½¿ç”¨åˆ°æœåŠ¡æ³¨å…¥ï¼Œæ‰€ä»¥ä½¿ç”¨æ³¨å†Œåˆ° <code>app</code> çš„æ–¹å¼</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">useGlobalPipes</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">UserPipe</span><span style="color:#BABED8;">())</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// è‡ªå®šä¹‰çš„ç®¡é“å‡½æ•°</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>å†å®šä¹‰ä¸€ä¸ª <code>post</code> è¯·æ±‚ï¼Œæ ¡éªŒä¸‹æˆ‘ä»¬çš„è‡ªå®šä¹‰ç®¡é“é€»è¾‘æ˜¯å¦æ­£ç¡®ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Controller</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pipes</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipesController</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Post</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom-pipe</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">testCustomPipe</span><span style="color:#89DDFF;">(@</span><span style="color:#82AAFF;">Body</span><span style="color:#BABED8;">() </span><span style="color:#BABED8;font-style:italic;">body</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Record</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">body</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>æˆ‘ä»¬ä¾æ¬¡å‘é€ä¸€ä¸ªé”™è¯¯çš„è¯·æ±‚ï¼Œå‘é€ <code>name</code> ä¸ºç©ºçš„å‚æ•°ï¼Œç„¶åå†å‘é€ä¸€ä¸ªç¬¦åˆæ ¡éªŒçš„æˆåŠŸè¯·æ±‚ï¼šç”¨ä¾‹éƒ½æ˜¯ç¬¦åˆæœŸæœ›çš„</p><p><img src="`+ts+`" alt="image-20231026230315788"></p><h4 id="_9-6-4-ç±»éªŒè¯å™¨" tabindex="-1">9.6.4. ç±»éªŒè¯å™¨ <a class="header-anchor" href="#_9-6-4-ç±»éªŒè¯å™¨" aria-label="Permalink to &quot;9.6.4. ç±»éªŒè¯å™¨&quot;">â€‹</a></h4><p>åœ¨ä¸Šä¸€ä¸ªå°èŠ‚ä¸­çš„ä¾‹å­ï¼Œè‡ªå®šä¹‰çš„ç®¡é“åªä¸ç”¨æˆ·æ•°æ®è¿›è¡Œå¼ºè€¦åˆï¼Œå¤ç”¨æ€§æå·®ï¼Œä¹Ÿå°±æ˜¯è¯´åé¢è¿˜æœ‰ç›¸ä¼¼ä½†ä¸é‡å¤çš„å‚æ•°éœ€è¦éªŒè¯æ—¶ï¼Œè¿˜è¦å†å®šä¹‰ä¸€éï¼Œè¿™è¿èƒŒäº† <span class="high-light">DRYåŸåˆ™Don&#39;t repeat yourself</span></p><p><code>nest</code> å·²ç»é›†æˆäº†åŸºäºç»“æ„çš„æ ¡éªŒï¼Œä½¿å¾—ç®¡é“æ ¡éªŒæ›´åŠ ç®€å•æ–¹ä¾¿ã€‚</p><p>ç±»éªŒè¯çš„æ–¹æ³•å±äºåŸºäºç»“æ„çš„éªŒè¯ï¼Œ<code>nest</code> ä¸ <code>class-validator</code> é…åˆï¼Œå…è®¸ä½ ä½¿ç”¨åŸºäºè£…é¥°å™¨çš„å¯¹å±æ€§è¿›è¡ŒéªŒè¯ï¼Œè¿™ç§å®ç°çš„æ–¹å¼çªæ˜¾ä¼˜åŠ¿ï¼Œç”±ç®¡é“ä¸å‚æ•°ã€æ–¹æ³•ã€æ§åˆ¶å™¨ç­‰è€¦åˆçš„æƒ…å†µï¼Œå˜ä¸ºäº†åªä¸éªŒè¯ç±»<code>(DTOç±»)</code>ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰éœ€è¦å®‰è£…ä¾èµ–ï¼š<code>npm i class-vaildator class-transformer</code></p><p>æ¥ç€å¯¹ä¸Šé¢çš„ä¾‹å­è¿›è¡Œæ”¹é€ ï¼Œé‡ç‚¹åœ¨è‡ªå®šä¹‰ç®¡é“ä¸Šçš„æ”¹é€ </p><p>é¦–å…ˆå‡†å¤‡ä¸€ä¸ª <code>DTOç±»</code>ï¼ˆä¸èƒ½æ˜¯æ¥å£ï¼‰</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">IsNotEmpty</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">class-validator</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UserDto</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">IsNotEmpty</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">  </span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">IsNotEmpty</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="è‡ªå®šä¹‰ç®¡é“é€»è¾‘" tabindex="-1">è‡ªå®šä¹‰ç®¡é“é€»è¾‘ï¼š <a class="header-anchor" href="#è‡ªå®šä¹‰ç®¡é“é€»è¾‘" aria-label="Permalink to &quot;è‡ªå®šä¹‰ç®¡é“é€»è¾‘ï¼š&quot;">â€‹</a></h5><p>æ”¹é€ ç®¡é“ä¾‹å­ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">ArgumentMetadata</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">HttpException</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">PipeTransform</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">plainToInstance</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">class-transformer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">validate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">class-validator</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UserPipe</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">PipeTransform</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">transform</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">value</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">metadata</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ArgumentMetadata</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    if (!value.name) {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//      throw new HttpException(&#39;ç”¨æˆ·åå¹¶ä¸èƒ½ä¸ºç©º&#39;, HttpStatus.BAD_REQUEST);</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    }</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    if (!value.password) {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//      throw new HttpException(&#39;å¯†ç å¹¶ä¸èƒ½ä¸ºç©º&#39;, HttpStatus.BAD_REQUEST);</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 1. æ ¹æ®DTOç±»,å€ŸåŠ© class-transformer æ’ä»¶å®ä¾‹åŒ–å¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">userDto</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">plainToInstance</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">metadata</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">metatype</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 2. æ ¹æ®DTOç±»å±æ€§çš„ è£…é¥°å™¨éªŒè¯è§„åˆ™rulesï¼Œè·å¾—ä¸€ç»„ç‰¹æ®Šçš„Dtoå¯¹è±¡ï¼Œå®ƒä»¬åŒ…å«éªŒè¯rulesï¼Œç„¶åå¯¹è¿™ç»„æ•°æ®è¿›è¡Œæ ¡éªŒ</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">errors</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">validate</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">userDto</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 3. å¦‚æœerrorsé•¿åº¦ä¸º0ï¼Œè¯´æ˜æ‰€æœ‰éªŒè¯é€šè¿‡ï¼Œå¦åˆ™æ ¡éªŒå¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ç»™å‰ç«¯</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">errors</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">HttpException</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">errors</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">item</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">values</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">constraints</span><span style="color:#F07178;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">])</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">BAD_REQUEST</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p><img src="`+ys+`" alt="image-20231025235310505"></p><p>å…¶å®åœ¨ <code>nest</code> ä¸­è¿˜æœ‰æ›´ç®€å•çš„æ ¡éªŒæ–¹å¼ï¼Œä¸Šé¢çš„è‡ªå®šä¹‰ç®¡é“é€»è¾‘ <code>nest</code> å·²ç»å¸®æˆ‘ä»¬å®ç°äº†ã€‚</p><h5 id="ç³»ç»ŸéªŒè¯ç®¡é“" tabindex="-1">ç³»ç»ŸéªŒè¯ç®¡é“ï¼š <a class="header-anchor" href="#ç³»ç»ŸéªŒè¯ç®¡é“" aria-label="Permalink to &quot;ç³»ç»ŸéªŒè¯ç®¡é“ï¼š&quot;">â€‹</a></h5><p>æˆ‘ä»¬å¯ä»¥åœ¨å‚æ•°ã€æ–¹æ³•ã€æ§åˆ¶å™¨ã€å…¨å±€ä»»æ„ä¸€ä¸ªä½œç”¨åŸŸä¸­ç»‘å®šä¸€ä¸ª <code>ValidationPipe</code> ï¼Œè¿™ä¸ªç®¡é“å‡½æ•°åšçš„äº‹æƒ…ï¼Œå°±è·Ÿæˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­åšçš„äº‹æƒ…æ˜¯ä¸€æ ·çš„ã€‚</p><p>main.ts</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#676E95;font-style:italic;">// è‡ªå®šä¹‰çš„ç®¡é“å‡½æ•°</span></span>
<span class="line diff remove"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">useGlobalPipes</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">UserPipe</span><span style="color:#BABED8;">())</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨ç³»ç»Ÿç®¡é“å‡½æ•°éªŒè¯</span></span>
<span class="line diff add"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">useGlobalPipes</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ValidationPipe</span><span style="color:#BABED8;">())</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å‘é€è¯·æ±‚ï¼Œçœ‹ä¸€ä¸‹æ ¡éªŒå¤±è´¥/æˆåŠŸçš„ç”¨ä¾‹æ˜¯å¦ç¬¦åˆæœŸæœ›ï¼š</p><p><img src="`+Ds+`" alt="image-20231026111416896"></p><p>å¦‚æœå¯¹äºè¿”å›ç»“æœçš„ç»“æ„ä¸æ»¡æ„ï¼Œè¿˜å¯ä»¥ç»§æ‰¿ã€é‡å†™ <code>ValidationPipe</code> ç®¡é“ï¼Œå°†é”™è¯¯ä¿¡æ¯å¤„ç†æˆä¸ºæˆ‘ä»¬æƒ³è¦çš„æ ¼å¼ã€‚</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ValidationPipe</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ValidationError</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Validate</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ValidationPipe</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">protected</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">mapChildrenToValidationErrors</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">error</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ValidationError</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#BABED8;font-style:italic;">parentPath</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ValidationError</span><span style="color:#BABED8;">[] </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">errors</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mapChildrenToValidationErrors</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">error</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">parentPath</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">errors</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">item</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">constraints</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">constraints</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`\${</span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">property</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">constraints[key]</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">errors</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><img src="`+Fs+`" alt="image-20231026113733722"></p><h4 id="_9-6-5-ç»“åˆå¼‚å¸¸è¿‡æ»¤å™¨" tabindex="-1">9.6.5. ç»“åˆå¼‚å¸¸è¿‡æ»¤å™¨ <a class="header-anchor" href="#_9-6-5-ç»“åˆå¼‚å¸¸è¿‡æ»¤å™¨" aria-label="Permalink to &quot;9.6.5. ç»“åˆå¼‚å¸¸è¿‡æ»¤å™¨&quot;">â€‹</a></h4><p>ä¸Šé¢çš„ç®¡é“éªŒè¯å“åº”çš„å¼‚å¸¸ä¿¡æ¯å¹¶ä¸ç¬¦åˆæˆ‘ä»¬ä¹‹å‰çº¦å®šçš„ç±»å‹ï¼š</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">interface</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">message</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯æ—¶å‡ºç°</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">PUT</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DELETE</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">PATCH</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯æ—¶å‡ºç°</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">failed</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯æ—¶å‡ºç°</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æ‰€ä»¥éœ€è¦å¯¹å¼‚å¸¸å“åº”ç»“æœè¿›è¡ŒåŒ…è£…ï¼Œå°±è¦ç»“åˆå¼‚å¸¸è¿‡æ»¤å™¨</p><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªå¼‚å¸¸è¿‡æ»¤å™¨ï¼švalidate-exception.filter.ts</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ArgumentsHost</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Catch</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ExceptionFilter</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Catch</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ValidateExpceptionFilter</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ExceptionFilter</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">catch</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">exception</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">host</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ArgumentsHost</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æˆ‘ä»¬éœ€è¦å¯¹å‚æ•°é”™è¯¯çš„å¼‚å¸¸è¿›è¡Œè¿‡æ»¤ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å°è£…å‚æ•°é”™è¯¯çš„å¼‚å¸¸ç±»ï¼šparameter-exception</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpException</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/common</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ParameterException</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">HttpException</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">response</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Record</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">&gt;)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">super</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">response</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">OK</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ä¸ºä»€ä¹ˆæ˜¯200ï¼Œå› ä¸ºå‚æ•°é”™è¯¯æ˜¯ä¸šåŠ¡é”™è¯¯</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¿®æ”¹ç®¡é“éªŒè¯çš„æ³¨å†Œæ–¹å¼ï¼Œåº”ç”¨ä¸Šæˆ‘ä»¬è‡ªå®šä¹‰çš„å¼‚å¸¸ç±»ï¼šmain.ts</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">useGlobalPipes</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ValidationPipe</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">exceptionFactory</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">errors</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">ParameterException</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">errors</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>åˆ›å»ºå¼‚å¸¸è¿‡æ»¤å™¨ï¼Œè¿”å›é€‚åˆæ ¼å¼çš„å¼‚å¸¸ä¿¡æ¯ï¼švalidate-expception.filter.tsï¼Œåªè¿‡æ»¤æŠ›å‡ºå‚æ•°é”™è¯¯çš„å¼‚å¸¸</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">Catch</span><span style="color:#BABED8;">(ParameterException)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ValidateExpceptionFilter</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">implements</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ExceptionFilter</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">catch</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">exception</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">host</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">ArgumentsHost</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">host</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">switchToHttp</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getResponse</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">req</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRequest</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">exception</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">exception</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">instanceof</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">ParameterException</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">exception</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getStatus</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å‚æ•°é”™è¯¯</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        method</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">method</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        failed</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        data</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨å…¨å±€ç»‘å®šæ³¨å†Œè¿‡æ»¤å™¨ï¼šmain.ts</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">useGlobalFilters</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">ValidateExpceptionFilter</span><span style="color:#BABED8;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>å‘é€è¯·æ±‚æŸ¥çœ‹è¿‡æ»¤åçš„æ•ˆæœï¼š</p><p><img src="`+is+`" alt="image-20231027000259329"></p><p>è™½ç„¶æ²¡æœ‰ä½“ç°æ˜¯ä»€ä¹ˆå‚æ•°é”™è¯¯ï¼ˆæ„Ÿè§‰ä¹Ÿä¸å¤ªéœ€è¦ï¼‰ï¼Œä½†æ˜¯å·²ç»æˆä¸ºäº†å…¨å±€é€šç”¨çš„å‚æ•°å¼‚å¸¸ç»“åˆè¿‡æ»¤çš„ä¾‹å­ã€‚</p><h4 id="_9-6-6-æ˜ å°„ç±»å‹" tabindex="-1">9.6.6. æ˜ å°„ç±»å‹ <a class="header-anchor" href="#_9-6-6-æ˜ å°„ç±»å‹" aria-label="Permalink to &quot;9.6.6. æ˜ å°„ç±»å‹&quot;">â€‹</a></h4><p>åœ¨ç±»éªŒè¯å™¨æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºäº† <code>DTO</code> ç±»è¿›è¡Œç»“æ„éªŒè¯ï¼Œä½†æœ‰æ—¶æœ‰çš„å±æ€§æ˜¯å¯é€‰çš„ï¼Œä¼ äºä¸ä¼ éƒ½å¯ä»¥çš„æƒ…å†µä¸‹ï¼Œå°±éœ€è¦æ˜ å°„ç±»å‹ã€‚</p><p>æ˜ å°„ç±»å‹å’Œ <code>TypeScript</code> çš„ä¸€äº›å†…ç½®ç±»å‹ç”¨æ³•åŸºæœ¬ç›¸ä¼¼ï¼Œæ¯”å¦‚ï¼š<code>PartialType-Partialã€PickType-Pickã€OmitType-Omitã€IntersectionType-&amp;</code></p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">PartialType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@nestjs/swagger</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">CreateCatDto</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">age</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">breed</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UpdateCatDto</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">PartialType</span><span style="color:#BABED8;">(CreateCatDto) </span><span style="color:#89DDFF;">{}</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// ç±»å‹å’ŒCreateCatDtoä¸€æ ·ï¼Œå˜ä¸ºå¯é€‰ç±»å‹</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å…¶ä»–çš„ç”¨æ³•å¤§è‡´ç›¸åŒï¼Œè¿™å‡ ä¸ªç±»å‹æ˜ å°„çš„å‡½æ•°ï¼Œå¯ç»„åˆä½¿ç”¨</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">class</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">UpdateCatDto</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">extends</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">PartialType</span><span style="color:#BABED8;">(</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">OmitType</span><span style="color:#BABED8;">(CreateCatDto</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">] </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">) </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_9-7-å„ä¸ªç»„ä»¶è¯·æ±‚é“¾è·¯" tabindex="-1">9.7. å„ä¸ªç»„ä»¶è¯·æ±‚é“¾è·¯ <a class="header-anchor" href="#_9-7-å„ä¸ªç»„ä»¶è¯·æ±‚é“¾è·¯" aria-label="Permalink to &quot;9.7. å„ä¸ªç»„ä»¶è¯·æ±‚é“¾è·¯&quot;">â€‹</a></h3><p>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ<code>nest</code> å„ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³ä¸ºè¯·æ±‚é“¾è·¯</p><p>å…ˆè¯´ç»“è®ºï¼šï¼ˆå¦‚æœ‰å¤šä¸ªåŒæ ·çš„ç»„ä»¶ï¼Œå°±æŒ‰æ³¨å†Œé¡ºåºæ‰§è¡Œï¼‰</p><ol><li>ä¸­é—´ä»¶ï¼šå…¨å±€ â†’ æ¨¡å—</li><li>å®ˆå«ï¼šå…¨å±€ â†’ æ§åˆ¶å™¨ â†’ è·¯ç”±</li><li>æ‹¦æˆªå™¨ï¼Œæ‰§è¡Œhandleä¹‹å‰ï¼šå…¨å±€ â†’ æ§åˆ¶å™¨ â†’ è·¯ç”±</li><li>ç®¡é“ï¼šå…¨å±€ â†’ æ§åˆ¶å™¨ â†’ è·¯ç”± â†’ å‚æ•°</li><li>æ§åˆ¶å™¨å†…éƒ¨</li><li>æ‹¦æˆªå™¨ï¼Œæ‰§è¡Œhandleä¹‹åï¼š è·¯ç”± â†’ æ§åˆ¶å™¨ â†’ å…¨å±€</li><li>å¼‚å¸¸è¿‡æ»¤ï¼Œç‰¹æ®Šå±‚ç©¿æ’åœ¨æ¯ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåªè¦æœ‰å¼‚å¸¸éƒ½ä¼šè¿›å…¥å¼‚å¸¸å±‚ï¼šè·¯ç”± â†’ æ§åˆ¶å™¨ â†’ å…¨å±€</li></ol><p><img src="`+Bs+'" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="_10-ç»“æŸè¯­" tabindex="-1">10. ç»“æŸè¯­ <a class="header-anchor" href="#_10-ç»“æŸè¯­" aria-label="Permalink to &quot;10. ç»“æŸè¯­&quot;">â€‹</a></h2><p>å†æ—¶ä¸¤æœˆåŠ<span class="high-light">ä¸€å¤æœˆ</span>ï¼Œå·²ç»å®Œæˆäº† <code>nestjs</code> ç›¸å…³çš„åŸºç¡€å†…å®¹çš„å­¦ä¹ ï¼Œæ¶µç›–äº†åŸºæœ¬å¼€å‘æ‰€ä½¿ç”¨çš„æ§åˆ¶å™¨ã€ä¾èµ–æ³¨å…¥ã€æ•°æ®ä¼ è¾“ã€æ¨¡å—ã€å„ç§ç»„ä»¶ç­‰ç­‰ï¼Œç›®å‰æŒæ¡çš„çŸ¥è¯†è¶³å¤Ÿæˆ‘ä»¬å¼€å‘ä¸€ä¸ªå°å‹ <code>demo</code>ã€‚<code>nestjs</code> ç¬¬ä¸€é˜¶æ®µçš„å­¦ä¹ åˆ°æ­¤ç»“æŸï¼</p><p>å¼€å¯ç¬¬äºŒé˜¶æ®µï¼šå®Œæˆä¸€ä¸ªåšå®¢ç³»ç»Ÿï¼Œå¹¶åœ¨å®æ“ä¸­æŒæ¡æ›´å¤šçš„ <code>nestjs</code> é›†æˆçš„ç›¸å…³çŸ¥è¯†ï¼Œæ¯”å¦‚é…ç½®æ¨¡å—ï¼Œæ—¥å¿—æ¨¡å—ï¼Œæ•°æ®åº“æ¨¡å—ï¼ŒRBACæƒé™è®¾è®¡ï¼ŒRedisçš„ä½¿ç”¨ï¼Œæ–‡ä»¶æœåŠ¡ï¼Œå®šæ—¶ä»»åŠ¡ï¼Œéƒ¨ç½²ç­‰ç­‰ä¸€ç³»åˆ—ç”¨æ³•ã€‚</p><h2 id="å‚è€ƒèµ„æ–™" tabindex="-1">å‚è€ƒèµ„æ–™ <a class="header-anchor" href="#å‚è€ƒèµ„æ–™" aria-label="Permalink to &quot;å‚è€ƒèµ„æ–™&quot;">â€‹</a></h2><ul><li><a href="https://static.kancloud.cn/juukee/nestjs" target="_blank" rel="noreferrer">Nest.js ä¸­æ–‡æ–‡æ¡£ Â· çœ‹äº‘ (kancloud.cn)</a></li><li><a href="https://docs.nestjs.cn/" target="_blank" rel="noreferrer">nestjs ä¸­æ–‡æ–‡æ¡£</a></li><li><a href="https://juejin.cn/user/2260251637721351/posts" target="_blank" rel="noreferrer">Django å¼ºå“¥ çš„ä¸ªäººä¸»é¡µ - æ–‡ç«  - æ˜é‡‘ (juejin.cn)</a></li><li><a href="https://juejin.cn/user/870468942308733" target="_blank" rel="noreferrer">æ— åŒ_Joney çš„ä¸ªäººä¸»é¡µ - åŠ¨æ€ - æ˜é‡‘ (juejin.cn)</a></li><li><a href="https://juejin.cn/book/7226988578700525605?enter_from=course_center&amp;utm_source=course_center" target="_blank" rel="noreferrer">Nest é€šå…³ç§˜ç± - zxg_ç¥è¯´è¦æœ‰å…‰ - æ˜é‡‘å°å†Œ (juejin.cn)</a></li><li><a href="https://blog.csdn.net/piggy_0204/article/details/125251939" target="_blank" rel="noreferrer">Nestjs å¾ªç¯ä¾èµ–çš„å®ç°_Cody Tseng çš„åšå®¢-CSDN åšå®¢</a></li><li><a href="https://juejin.cn/user/132380621021742" target="_blank" rel="noreferrer">é“­è¯º çš„ä¸ªäººä¸»é¡µ - åŠ¨æ€ - æ˜é‡‘ (juejin.cn)</a></li><li><a href="https://docs.nestjs.com/fundamentals/dynamic-modules#custom-options-factory-class" target="_blank" rel="noreferrer">Dynamic modules | NestJS - A progressive Node.js framework --- åŠ¨æ€æ¨¡å—| NestJS - ä¸€ä¸ªæ¸è¿›çš„ Node.js æ¡†æ¶</a></li></ul>',744)]))}const Ts=D(As,[["render",bs]]);export{xs as __pageData,Ts as default};
